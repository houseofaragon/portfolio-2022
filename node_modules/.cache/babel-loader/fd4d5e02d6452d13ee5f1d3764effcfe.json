{"ast":null,"code":"import _classCallCheck from \"/Users/jak/repos/karen/bestservedbold-christmas-baubles/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/jak/repos/karen/bestservedbold-christmas-baubles/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _assertThisInitialized from \"/Users/jak/repos/karen/bestservedbold-christmas-baubles/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _inherits from \"/Users/jak/repos/karen/bestservedbold-christmas-baubles/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/jak/repos/karen/bestservedbold-christmas-baubles/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _defineProperty from '@babel/runtime/helpers/esm/defineProperty';\nimport { Matrix4, EventDispatcher, EllipseCurve, BufferGeometry, Mesh, PerspectiveCamera, MathUtils, OrthographicCamera, Vector3, GridHelper, LineBasicMaterial, Line, Raycaster, Vector2, Quaternion, Group, Box3, Sphere } from 'three'; //trackball state\n\nvar STATE = {\n  IDLE: Symbol(),\n  ROTATE: Symbol(),\n  PAN: Symbol(),\n  SCALE: Symbol(),\n  FOV: Symbol(),\n  FOCUS: Symbol(),\n  ZROTATE: Symbol(),\n  TOUCH_MULTI: Symbol(),\n  ANIMATION_FOCUS: Symbol(),\n  ANIMATION_ROTATE: Symbol()\n};\nvar INPUT = {\n  NONE: Symbol(),\n  ONE_FINGER: Symbol(),\n  ONE_FINGER_SWITCHED: Symbol(),\n  TWO_FINGER: Symbol(),\n  MULT_FINGER: Symbol(),\n  CURSOR: Symbol()\n}; //cursor center coordinates\n\nvar _center = {\n  x: 0,\n  y: 0\n}; //transformation matrices for gizmos and camera\n\nvar _transformation = {\n  camera: new Matrix4(),\n  gizmos: new Matrix4()\n}; //events\n\nvar _changeEvent = {\n  type: 'change'\n};\nvar _startEvent = {\n  type: 'start'\n};\nvar _endEvent = {\n  type: 'end'\n};\n/**\n *\n * @param {Camera} camera Virtual camera used in the scene\n * @param {HTMLElement} domElement Renderer's dom element\n * @param {Scene} scene The scene to be rendered\n */\n\nvar ArcballControls = /*#__PURE__*/function (_EventDispatcher) {\n  _inherits(ArcballControls, _EventDispatcher);\n\n  var _super = _createSuper(ArcballControls);\n\n  function ArcballControls(_camera, domElement) {\n    var _this;\n\n    var scene = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n    _classCallCheck(this, ArcballControls);\n\n    _this = _super.call(this);\n\n    _defineProperty(_assertThisInitialized(_this), \"camera\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"domElement\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"scene\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"mouseActions\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_mouseOp\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_v2_1\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_v3_1\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_v3_2\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_m4_1\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_m4_2\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_quat\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_translationMatrix\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_rotationMatrix\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_scaleMatrix\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_rotationAxis\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_cameraMatrixState\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_cameraProjectionState\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_fovState\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_upState\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_zoomState\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_nearPos\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_farPos\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_gizmoMatrixState\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_up0\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_zoom0\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_fov0\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_initialNear\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_nearPos0\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_initialFar\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_farPos0\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_cameraMatrixState0\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_gizmoMatrixState0\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_button\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_touchStart\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_touchCurrent\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_input\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_switchSensibility\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_startFingerDistance\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_currentFingerDistance\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_startFingerRotation\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_currentFingerRotation\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_devPxRatio\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_downValid\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_nclicks\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_downEvents\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_downStart\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_clickStart\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_maxDownTime\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_maxInterval\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_posThreshold\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_movementThreshold\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_currentCursorPosition\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_startCursorPosition\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_grid\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_gridPosition\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_gizmos\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_curvePts\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_timeStart\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_animationId\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"focusAnimationTime\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_timePrev\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_timeCurrent\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_anglePrev\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_angleCurrent\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_cursorPosPrev\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_cursorPosCurr\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_wPrev\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_wCurr\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"adjustNearFar\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"scaleFactor\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"dampingFactor\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"wMax\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"enableAnimations\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"enableGrid\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"cursorZoom\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"minFov\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"maxFov\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"enabled\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"enablePan\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"enableRotate\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"enableZoom\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"enableGizmos\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"minDistance\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"maxDistance\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"minZoom\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"maxZoom\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"target\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_currentTarget\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_tbRadius\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_state\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"onWindowResize\", function () {\n      var scale = (_this._gizmos.scale.x + _this._gizmos.scale.y + _this._gizmos.scale.z) / 3;\n\n      if (_this.camera !== null) {\n        var tbRadius = _this.calculateTbRadius(_this.camera);\n\n        if (tbRadius !== undefined) {\n          _this._tbRadius = tbRadius;\n        }\n      }\n\n      var newRadius = _this._tbRadius / scale; // @ts-expect-error\n\n      var curve = new EllipseCurve(0, 0, newRadius, newRadius);\n      var points = curve.getPoints(_this._curvePts);\n      var curveGeometry = new BufferGeometry().setFromPoints(points);\n\n      for (var gizmo in _this._gizmos.children) {\n        var child = _this._gizmos.children[gizmo];\n\n        if (child instanceof Mesh) {\n          child.geometry = curveGeometry;\n        }\n      }\n\n      _this.dispatchEvent(_changeEvent);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onContextMenu\", function (event) {\n      if (!_this.enabled) {\n        return;\n      }\n\n      for (var i = 0; i < _this.mouseActions.length; i++) {\n        if (_this.mouseActions[i].mouse == 2) {\n          //prevent only if button 2 is actually used\n          event.preventDefault();\n          break;\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onPointerCancel\", function () {\n      _this._touchStart.splice(0, _this._touchStart.length);\n\n      _this._touchCurrent.splice(0, _this._touchCurrent.length);\n\n      _this._input = INPUT.NONE;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onPointerDown\", function (event) {\n      if (event.button == 0 && event.isPrimary) {\n        _this._downValid = true;\n\n        _this._downEvents.push(event);\n\n        _this._downStart = performance.now();\n      } else {\n        _this._downValid = false;\n      }\n\n      if (event.pointerType == 'touch' && _this._input != INPUT.CURSOR) {\n        _this._touchStart.push(event);\n\n        _this._touchCurrent.push(event);\n\n        switch (_this._input) {\n          case INPUT.NONE:\n            //singleStart\n            _this._input = INPUT.ONE_FINGER;\n\n            _this.onSinglePanStart(event, 'ROTATE');\n\n            window.addEventListener('pointermove', _this.onPointerMove);\n            window.addEventListener('pointerup', _this.onPointerUp);\n            break;\n\n          case INPUT.ONE_FINGER:\n          case INPUT.ONE_FINGER_SWITCHED:\n            //doubleStart\n            _this._input = INPUT.TWO_FINGER;\n\n            _this.onRotateStart();\n\n            _this.onPinchStart();\n\n            _this.onDoublePanStart();\n\n            break;\n\n          case INPUT.TWO_FINGER:\n            //multipleStart\n            _this._input = INPUT.MULT_FINGER;\n\n            _this.onTriplePanStart();\n\n            break;\n        }\n      } else if (event.pointerType != 'touch' && _this._input == INPUT.NONE) {\n        var modifier = null;\n\n        if (event.ctrlKey || event.metaKey) {\n          modifier = 'CTRL';\n        } else if (event.shiftKey) {\n          modifier = 'SHIFT';\n        }\n\n        _this._mouseOp = _this.getOpFromAction(event.button, modifier);\n\n        if (_this._mouseOp != null) {\n          window.addEventListener('pointermove', _this.onPointerMove);\n          window.addEventListener('pointerup', _this.onPointerUp); //singleStart\n\n          _this._input = INPUT.CURSOR;\n          _this._button = event.button;\n\n          _this.onSinglePanStart(event, _this._mouseOp);\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onPointerMove\", function (event) {\n      if (event.pointerType == 'touch' && _this._input != INPUT.CURSOR) {\n        switch (_this._input) {\n          case INPUT.ONE_FINGER:\n            //singleMove\n            _this.updateTouchEvent(event);\n\n            _this.onSinglePanMove(event, STATE.ROTATE);\n\n            break;\n\n          case INPUT.ONE_FINGER_SWITCHED:\n            var movement = _this.calculatePointersDistance(_this._touchCurrent[0], event) * _this._devPxRatio;\n\n            if (movement >= _this._switchSensibility) {\n              //singleMove\n              _this._input = INPUT.ONE_FINGER;\n\n              _this.updateTouchEvent(event);\n\n              _this.onSinglePanStart(event, 'ROTATE');\n\n              break;\n            }\n\n            break;\n\n          case INPUT.TWO_FINGER:\n            //rotate/pan/pinchMove\n            _this.updateTouchEvent(event);\n\n            _this.onRotateMove();\n\n            _this.onPinchMove();\n\n            _this.onDoublePanMove();\n\n            break;\n\n          case INPUT.MULT_FINGER:\n            //multMove\n            _this.updateTouchEvent(event);\n\n            _this.onTriplePanMove();\n\n            break;\n        }\n      } else if (event.pointerType != 'touch' && _this._input == INPUT.CURSOR) {\n        var modifier = null;\n\n        if (event.ctrlKey || event.metaKey) {\n          modifier = 'CTRL';\n        } else if (event.shiftKey) {\n          modifier = 'SHIFT';\n        }\n\n        var mouseOpState = _this.getOpStateFromAction(_this._button, modifier);\n\n        if (mouseOpState != null) {\n          _this.onSinglePanMove(event, mouseOpState);\n        }\n      } //checkDistance\n\n\n      if (_this._downValid) {\n        var _movement = _this.calculatePointersDistance(_this._downEvents[_this._downEvents.length - 1], event) * _this._devPxRatio;\n\n        if (_movement > _this._movementThreshold) {\n          _this._downValid = false;\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onPointerUp\", function (event) {\n      if (event.pointerType == 'touch' && _this._input != INPUT.CURSOR) {\n        var nTouch = _this._touchCurrent.length;\n\n        for (var i = 0; i < nTouch; i++) {\n          if (_this._touchCurrent[i].pointerId == event.pointerId) {\n            _this._touchCurrent.splice(i, 1);\n\n            _this._touchStart.splice(i, 1);\n\n            break;\n          }\n        }\n\n        switch (_this._input) {\n          case INPUT.ONE_FINGER:\n          case INPUT.ONE_FINGER_SWITCHED:\n            //singleEnd\n            window.removeEventListener('pointermove', _this.onPointerMove);\n            window.removeEventListener('pointerup', _this.onPointerUp);\n            _this._input = INPUT.NONE;\n\n            _this.onSinglePanEnd();\n\n            break;\n\n          case INPUT.TWO_FINGER:\n            //doubleEnd\n            _this.onDoublePanEnd();\n\n            _this.onPinchEnd();\n\n            _this.onRotateEnd(); //switching to singleStart\n\n\n            _this._input = INPUT.ONE_FINGER_SWITCHED;\n            break;\n\n          case INPUT.MULT_FINGER:\n            if (_this._touchCurrent.length == 0) {\n              window.removeEventListener('pointermove', _this.onPointerMove);\n              window.removeEventListener('pointerup', _this.onPointerUp); //multCancel\n\n              _this._input = INPUT.NONE;\n\n              _this.onTriplePanEnd();\n            }\n\n            break;\n        }\n      } else if (event.pointerType != 'touch' && _this._input == INPUT.CURSOR) {\n        window.removeEventListener('pointermove', _this.onPointerMove);\n        window.removeEventListener('pointerup', _this.onPointerUp);\n        _this._input = INPUT.NONE;\n\n        _this.onSinglePanEnd();\n\n        _this._button = -1;\n      }\n\n      if (event.isPrimary) {\n        if (_this._downValid) {\n          var downTime = event.timeStamp - _this._downEvents[_this._downEvents.length - 1].timeStamp;\n\n          if (downTime <= _this._maxDownTime) {\n            if (_this._nclicks == 0) {\n              //first valid click detected\n              _this._nclicks = 1;\n              _this._clickStart = performance.now();\n            } else {\n              var clickInterval = event.timeStamp - _this._clickStart;\n\n              var movement = _this.calculatePointersDistance(_this._downEvents[1], _this._downEvents[0]) * _this._devPxRatio;\n\n              if (clickInterval <= _this._maxInterval && movement <= _this._posThreshold) {\n                //second valid click detected\n                //fire double tap and reset values\n                _this._nclicks = 0;\n\n                _this._downEvents.splice(0, _this._downEvents.length);\n\n                _this.onDoubleTap(event);\n              } else {\n                //new 'first click'\n                _this._nclicks = 1;\n\n                _this._downEvents.shift();\n\n                _this._clickStart = performance.now();\n              }\n            }\n          } else {\n            _this._downValid = false;\n            _this._nclicks = 0;\n\n            _this._downEvents.splice(0, _this._downEvents.length);\n          }\n        } else {\n          _this._nclicks = 0;\n\n          _this._downEvents.splice(0, _this._downEvents.length);\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onWheel\", function (event) {\n      if (_this.enabled && _this.enableZoom) {\n        var modifier = null;\n\n        if (event.ctrlKey || event.metaKey) {\n          modifier = 'CTRL';\n        } else if (event.shiftKey) {\n          modifier = 'SHIFT';\n        }\n\n        var mouseOp = _this.getOpFromAction('WHEEL', modifier);\n\n        if (mouseOp != null) {\n          event.preventDefault();\n\n          _this.dispatchEvent(_startEvent);\n\n          var notchDeltaY = 125; //distance of one notch of mouse wheel\n\n          var sgn = event.deltaY / notchDeltaY;\n          var size = 1;\n\n          if (sgn > 0) {\n            size = 1 / _this.scaleFactor;\n          } else if (sgn < 0) {\n            size = _this.scaleFactor;\n          }\n\n          switch (mouseOp) {\n            case 'ZOOM':\n              _this.updateTbState(STATE.SCALE, true);\n\n              if (sgn > 0) {\n                size = 1 / Math.pow(_this.scaleFactor, sgn);\n              } else if (sgn < 0) {\n                size = Math.pow(_this.scaleFactor, -sgn);\n              }\n\n              if (_this.cursorZoom && _this.enablePan) {\n                var scalePoint;\n\n                if (_this.camera instanceof OrthographicCamera && _this.camera.isOrthographicCamera) {\n                  var _this$unprojectOnTbPl;\n\n                  scalePoint = (_this$unprojectOnTbPl = _this.unprojectOnTbPlane(_this.camera, event.clientX, event.clientY, _this.domElement)) === null || _this$unprojectOnTbPl === void 0 ? void 0 : _this$unprojectOnTbPl.applyQuaternion(_this.camera.quaternion).multiplyScalar(1 / _this.camera.zoom).add(_this._gizmos.position);\n                } else if (_this.camera instanceof PerspectiveCamera && _this.camera.isPerspectiveCamera) {\n                  var _this$unprojectOnTbPl2;\n\n                  scalePoint = (_this$unprojectOnTbPl2 = _this.unprojectOnTbPlane(_this.camera, event.clientX, event.clientY, _this.domElement)) === null || _this$unprojectOnTbPl2 === void 0 ? void 0 : _this$unprojectOnTbPl2.applyQuaternion(_this.camera.quaternion).add(_this._gizmos.position);\n                }\n\n                if (scalePoint !== undefined) _this.applyTransformMatrix(_this.applyScale(size, scalePoint));\n              } else {\n                _this.applyTransformMatrix(_this.applyScale(size, _this._gizmos.position));\n              }\n\n              if (_this._grid != null) {\n                _this.disposeGrid();\n\n                _this.drawGrid();\n              }\n\n              _this.updateTbState(STATE.IDLE, false);\n\n              _this.dispatchEvent(_changeEvent);\n\n              _this.dispatchEvent(_endEvent);\n\n              break;\n\n            case 'FOV':\n              if (_this.camera instanceof PerspectiveCamera && _this.camera.isPerspectiveCamera) {\n                _this.updateTbState(STATE.FOV, true); //Vertigo effect\n                //\t  fov / 2\n                //\t\t|\\\n                //\t\t| \\\n                //\t\t|  \\\n                //\tx\t|\t\\\n                //\t\t| \t \\\n                //\t\t| \t  \\\n                //\t\t| _ _ _\\\n                //\t\t\ty\n                //check for iOs shift shortcut\n\n\n                if (event.deltaX != 0) {\n                  sgn = event.deltaX / notchDeltaY;\n                  size = 1;\n\n                  if (sgn > 0) {\n                    size = 1 / Math.pow(_this.scaleFactor, sgn);\n                  } else if (sgn < 0) {\n                    size = Math.pow(_this.scaleFactor, -sgn);\n                  }\n                }\n\n                _this._v3_1.setFromMatrixPosition(_this._cameraMatrixState);\n\n                var x = _this._v3_1.distanceTo(_this._gizmos.position);\n\n                var xNew = x / size; //distance between camera and gizmos if scale(size, scalepoint) would be performed\n                //check min and max distance\n\n                xNew = MathUtils.clamp(xNew, _this.minDistance, _this.maxDistance);\n                var y = x * Math.tan(MathUtils.DEG2RAD * _this.camera.fov * 0.5); //calculate new fov\n\n                var newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2); //check min and max fov\n\n                if (newFov > _this.maxFov) {\n                  newFov = _this.maxFov;\n                } else if (newFov < _this.minFov) {\n                  newFov = _this.minFov;\n                }\n\n                var newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n                size = x / newDistance;\n\n                _this.setFov(newFov);\n\n                _this.applyTransformMatrix(_this.applyScale(size, _this._gizmos.position, false));\n              }\n\n              if (_this._grid != null) {\n                _this.disposeGrid();\n\n                _this.drawGrid();\n              }\n\n              _this.updateTbState(STATE.IDLE, false);\n\n              _this.dispatchEvent(_changeEvent);\n\n              _this.dispatchEvent(_endEvent);\n\n              break;\n          }\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onKeyDown\", function (event) {\n      if (event.key == 'c') {\n        if (event.ctrlKey || event.metaKey) {\n          _this.copyState();\n        }\n      } else if (event.key == 'v') {\n        if (event.ctrlKey || event.metaKey) {\n          _this.pasteState();\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSinglePanStart\", function (event, operation) {\n      if (_this.enabled) {\n        _this.dispatchEvent(_startEvent);\n\n        _this.setCenter(event.clientX, event.clientY);\n\n        switch (operation) {\n          case 'PAN':\n            if (!_this.enablePan) {\n              return;\n            }\n\n            if (_this._animationId != -1) {\n              cancelAnimationFrame(_this._animationId);\n              _this._animationId = -1;\n              _this._timeStart = -1;\n\n              _this.activateGizmos(false);\n\n              _this.dispatchEvent(_changeEvent);\n            }\n\n            if (_this.camera !== null) {\n              _this.updateTbState(STATE.PAN, true);\n\n              var rayDir = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement);\n\n              if (rayDir !== undefined) {\n                _this._startCursorPosition.copy(rayDir);\n              }\n\n              if (_this.enableGrid) {\n                _this.drawGrid();\n\n                _this.dispatchEvent(_changeEvent);\n              }\n            }\n\n            break;\n\n          case 'ROTATE':\n            if (!_this.enableRotate) {\n              return;\n            }\n\n            if (_this._animationId != -1) {\n              cancelAnimationFrame(_this._animationId);\n              _this._animationId = -1;\n              _this._timeStart = -1;\n            }\n\n            if (_this.camera !== null) {\n              _this.updateTbState(STATE.ROTATE, true);\n\n              var _rayDir = _this.unprojectOnTbSurface(_this.camera, _center.x, _center.y, _this.domElement, _this._tbRadius);\n\n              if (_rayDir !== undefined) {\n                _this._startCursorPosition.copy(_rayDir);\n              }\n\n              _this.activateGizmos(true);\n\n              if (_this.enableAnimations) {\n                _this._timePrev = _this._timeCurrent = performance.now();\n                _this._angleCurrent = _this._anglePrev = 0;\n\n                _this._cursorPosPrev.copy(_this._startCursorPosition);\n\n                _this._cursorPosCurr.copy(_this._cursorPosPrev);\n\n                _this._wCurr = 0;\n                _this._wPrev = _this._wCurr;\n              }\n            }\n\n            _this.dispatchEvent(_changeEvent);\n\n            break;\n\n          case 'FOV':\n            if (!(_this.camera instanceof PerspectiveCamera && _this.camera.isPerspectiveCamera) || !_this.enableZoom) {\n              return;\n            }\n\n            if (_this._animationId != -1) {\n              cancelAnimationFrame(_this._animationId);\n              _this._animationId = -1;\n              _this._timeStart = -1;\n\n              _this.activateGizmos(false);\n\n              _this.dispatchEvent(_changeEvent);\n            }\n\n            _this.updateTbState(STATE.FOV, true);\n\n            _this._startCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n\n            _this._currentCursorPosition.copy(_this._startCursorPosition);\n\n            break;\n\n          case 'ZOOM':\n            if (!_this.enableZoom) {\n              return;\n            }\n\n            if (_this._animationId != -1) {\n              cancelAnimationFrame(_this._animationId);\n              _this._animationId = -1;\n              _this._timeStart = -1;\n\n              _this.activateGizmos(false);\n\n              _this.dispatchEvent(_changeEvent);\n            }\n\n            _this.updateTbState(STATE.SCALE, true);\n\n            _this._startCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n\n            _this._currentCursorPosition.copy(_this._startCursorPosition);\n\n            break;\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSinglePanMove\", function (event, opState) {\n      if (_this.enabled) {\n        var restart = opState != _this._state;\n\n        _this.setCenter(event.clientX, event.clientY);\n\n        switch (opState) {\n          case STATE.PAN:\n            if (_this.enablePan && _this.camera !== null) {\n              if (restart) {\n                //switch to pan operation\n                _this.dispatchEvent(_endEvent);\n\n                _this.dispatchEvent(_startEvent);\n\n                _this.updateTbState(opState, true);\n\n                var rayDir = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement);\n\n                if (rayDir !== undefined) {\n                  _this._startCursorPosition.copy(rayDir);\n                }\n\n                if (_this.enableGrid) {\n                  _this.drawGrid();\n                }\n\n                _this.activateGizmos(false);\n              } else {\n                //continue with pan operation\n                var _rayDir2 = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement);\n\n                if (_rayDir2 !== undefined) {\n                  _this._currentCursorPosition.copy(_rayDir2);\n                }\n\n                _this.applyTransformMatrix(_this.pan(_this._startCursorPosition, _this._currentCursorPosition));\n              }\n            }\n\n            break;\n\n          case STATE.ROTATE:\n            if (_this.enableRotate && _this.camera !== null) {\n              if (restart) {\n                //switch to rotate operation\n                _this.dispatchEvent(_endEvent);\n\n                _this.dispatchEvent(_startEvent);\n\n                _this.updateTbState(opState, true);\n\n                var _rayDir3 = _this.unprojectOnTbSurface(_this.camera, _center.x, _center.y, _this.domElement, _this._tbRadius);\n\n                if (_rayDir3 !== undefined) {\n                  _this._startCursorPosition.copy(_rayDir3);\n                }\n\n                if (_this.enableGrid) {\n                  _this.disposeGrid();\n                }\n\n                _this.activateGizmos(true);\n              } else {\n                //continue with rotate operation\n                var _rayDir4 = _this.unprojectOnTbSurface(_this.camera, _center.x, _center.y, _this.domElement, _this._tbRadius);\n\n                if (_rayDir4 !== undefined) {\n                  _this._currentCursorPosition.copy(_rayDir4);\n                }\n\n                var distance = _this._startCursorPosition.distanceTo(_this._currentCursorPosition);\n\n                var angle = _this._startCursorPosition.angleTo(_this._currentCursorPosition);\n\n                var amount = Math.max(distance / _this._tbRadius, angle); //effective rotation angle\n\n                _this.applyTransformMatrix(_this.rotate(_this.calculateRotationAxis(_this._startCursorPosition, _this._currentCursorPosition), amount));\n\n                if (_this.enableAnimations) {\n                  _this._timePrev = _this._timeCurrent;\n                  _this._timeCurrent = performance.now();\n                  _this._anglePrev = _this._angleCurrent;\n                  _this._angleCurrent = amount;\n\n                  _this._cursorPosPrev.copy(_this._cursorPosCurr);\n\n                  _this._cursorPosCurr.copy(_this._currentCursorPosition);\n\n                  _this._wPrev = _this._wCurr;\n                  _this._wCurr = _this.calculateAngularSpeed(_this._anglePrev, _this._angleCurrent, _this._timePrev, _this._timeCurrent);\n                }\n              }\n            }\n\n            break;\n\n          case STATE.SCALE:\n            if (_this.enableZoom) {\n              if (restart) {\n                //switch to zoom operation\n                _this.dispatchEvent(_endEvent);\n\n                _this.dispatchEvent(_startEvent);\n\n                _this.updateTbState(opState, true);\n\n                _this._startCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n\n                _this._currentCursorPosition.copy(_this._startCursorPosition);\n\n                if (_this.enableGrid) {\n                  _this.disposeGrid();\n                }\n\n                _this.activateGizmos(false);\n              } else {\n                //continue with zoom operation\n                var screenNotches = 8; //how many wheel notches corresponds to a full screen pan\n\n                _this._currentCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n\n                var movement = _this._currentCursorPosition.y - _this._startCursorPosition.y;\n                var size = 1;\n\n                if (movement < 0) {\n                  size = 1 / Math.pow(_this.scaleFactor, -movement * screenNotches);\n                } else if (movement > 0) {\n                  size = Math.pow(_this.scaleFactor, movement * screenNotches);\n                }\n\n                _this.applyTransformMatrix(_this.applyScale(size, _this._gizmos.position));\n              }\n            }\n\n            break;\n\n          case STATE.FOV:\n            if (_this.enableZoom && _this.camera instanceof PerspectiveCamera && _this.camera.isPerspectiveCamera) {\n              if (restart) {\n                //switch to fov operation\n                _this.dispatchEvent(_endEvent);\n\n                _this.dispatchEvent(_startEvent);\n\n                _this.updateTbState(opState, true);\n\n                _this._startCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n\n                _this._currentCursorPosition.copy(_this._startCursorPosition);\n\n                if (_this.enableGrid) {\n                  _this.disposeGrid();\n                }\n\n                _this.activateGizmos(false);\n              } else {\n                //continue with fov operation\n                var _screenNotches = 8; //how many wheel notches corresponds to a full screen pan\n\n                _this._currentCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n\n                var _movement2 = _this._currentCursorPosition.y - _this._startCursorPosition.y;\n\n                var _size = 1;\n\n                if (_movement2 < 0) {\n                  _size = 1 / Math.pow(_this.scaleFactor, -_movement2 * _screenNotches);\n                } else if (_movement2 > 0) {\n                  _size = Math.pow(_this.scaleFactor, _movement2 * _screenNotches);\n                }\n\n                _this._v3_1.setFromMatrixPosition(_this._cameraMatrixState);\n\n                var x = _this._v3_1.distanceTo(_this._gizmos.position);\n\n                var xNew = x / _size; //distance between camera and gizmos if scale(size, scalepoint) would be performed\n                //check min and max distance\n\n                xNew = MathUtils.clamp(xNew, _this.minDistance, _this.maxDistance);\n                var y = x * Math.tan(MathUtils.DEG2RAD * _this._fovState * 0.5); //calculate new fov\n\n                var newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2); //check min and max fov\n\n                newFov = MathUtils.clamp(newFov, _this.minFov, _this.maxFov);\n                var newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n                _size = x / newDistance;\n\n                _this._v3_2.setFromMatrixPosition(_this._gizmoMatrixState);\n\n                _this.setFov(newFov);\n\n                _this.applyTransformMatrix(_this.applyScale(_size, _this._v3_2, false)); //adjusting distance\n\n\n                var direction = _this._gizmos.position.clone().sub(_this.camera.position).normalize().multiplyScalar(newDistance / x);\n\n                _this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n              }\n            }\n\n            break;\n        }\n\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSinglePanEnd\", function () {\n      if (_this._state == STATE.ROTATE) {\n        if (!_this.enableRotate) {\n          return;\n        }\n\n        if (_this.enableAnimations) {\n          //perform rotation animation\n          var deltaTime = performance.now() - _this._timeCurrent;\n\n          if (deltaTime < 120) {\n            var w = Math.abs((_this._wPrev + _this._wCurr) / 2);\n\n            var self = _assertThisInitialized(_this);\n\n            _this._animationId = window.requestAnimationFrame(function (t) {\n              self.updateTbState(STATE.ANIMATION_ROTATE, true);\n              var rotationAxis = self.calculateRotationAxis(self._cursorPosPrev, self._cursorPosCurr);\n              self.onRotationAnim(t, rotationAxis, Math.min(w, self.wMax));\n            });\n          } else {\n            //cursor has been standing still for over 120 ms since last movement\n            _this.updateTbState(STATE.IDLE, false);\n\n            _this.activateGizmos(false);\n\n            _this.dispatchEvent(_changeEvent);\n          }\n        } else {\n          _this.updateTbState(STATE.IDLE, false);\n\n          _this.activateGizmos(false);\n\n          _this.dispatchEvent(_changeEvent);\n        }\n      } else if (_this._state == STATE.PAN || _this._state == STATE.IDLE) {\n        _this.updateTbState(STATE.IDLE, false);\n\n        if (_this.enableGrid) {\n          _this.disposeGrid();\n        }\n\n        _this.activateGizmos(false);\n\n        _this.dispatchEvent(_changeEvent);\n      }\n\n      _this.dispatchEvent(_endEvent);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onDoubleTap\", function (event) {\n      if (_this.enabled && _this.enablePan && _this.scene != null && _this.camera !== null) {\n        _this.dispatchEvent(_startEvent);\n\n        _this.setCenter(event.clientX, event.clientY);\n\n        var hitP = _this.unprojectOnObj(_this.getCursorNDC(_center.x, _center.y, _this.domElement), _this.camera);\n\n        if (hitP != null && _this.enableAnimations) {\n          var self = _assertThisInitialized(_this);\n\n          if (_this._animationId != -1) {\n            window.cancelAnimationFrame(_this._animationId);\n          }\n\n          _this._timeStart = -1;\n          _this._animationId = window.requestAnimationFrame(function (t) {\n            self.updateTbState(STATE.ANIMATION_FOCUS, true);\n            self.onFocusAnim(t, hitP, self._cameraMatrixState, self._gizmoMatrixState);\n          });\n        } else if (hitP != null && !_this.enableAnimations) {\n          _this.updateTbState(STATE.FOCUS, true);\n\n          _this.focus(hitP, _this.scaleFactor);\n\n          _this.updateTbState(STATE.IDLE, false);\n\n          _this.dispatchEvent(_changeEvent);\n        }\n      }\n\n      _this.dispatchEvent(_endEvent);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onDoublePanStart\", function () {\n      if (_this.enabled && _this.enablePan && _this.camera !== null) {\n        _this.dispatchEvent(_startEvent);\n\n        _this.updateTbState(STATE.PAN, true);\n\n        _this.setCenter((_this._touchCurrent[0].clientX + _this._touchCurrent[1].clientX) / 2, (_this._touchCurrent[0].clientY + _this._touchCurrent[1].clientY) / 2);\n\n        var rayDir = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement, true);\n\n        if (rayDir !== undefined) {\n          _this._startCursorPosition.copy(rayDir);\n        }\n\n        _this._currentCursorPosition.copy(_this._startCursorPosition);\n\n        _this.activateGizmos(false);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onDoublePanMove\", function () {\n      if (_this.enabled && _this.enablePan && _this.camera !== null) {\n        _this.setCenter((_this._touchCurrent[0].clientX + _this._touchCurrent[1].clientX) / 2, (_this._touchCurrent[0].clientY + _this._touchCurrent[1].clientY) / 2);\n\n        if (_this._state != STATE.PAN) {\n          _this.updateTbState(STATE.PAN, true);\n\n          _this._startCursorPosition.copy(_this._currentCursorPosition);\n        }\n\n        var rayDir = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement, true);\n\n        if (rayDir !== undefined) _this._currentCursorPosition.copy(rayDir);\n\n        _this.applyTransformMatrix(_this.pan(_this._startCursorPosition, _this._currentCursorPosition, true));\n\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onDoublePanEnd\", function () {\n      _this.updateTbState(STATE.IDLE, false);\n\n      _this.dispatchEvent(_endEvent);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onRotateStart\", function () {\n      if (_this.enabled && _this.enableRotate) {\n        var _this$camera;\n\n        _this.dispatchEvent(_startEvent);\n\n        _this.updateTbState(STATE.ZROTATE, true); //this._startFingerRotation = event.rotation;\n\n\n        _this._startFingerRotation = _this.getAngle(_this._touchCurrent[1], _this._touchCurrent[0]) + _this.getAngle(_this._touchStart[1], _this._touchStart[0]);\n        _this._currentFingerRotation = _this._startFingerRotation;\n        (_this$camera = _this.camera) === null || _this$camera === void 0 ? void 0 : _this$camera.getWorldDirection(_this._rotationAxis); //rotation axis\n\n        if (!_this.enablePan && !_this.enableZoom) {\n          _this.activateGizmos(true);\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onRotateMove\", function () {\n      if (_this.enabled && _this.enableRotate && _this.camera !== null) {\n        _this.setCenter((_this._touchCurrent[0].clientX + _this._touchCurrent[1].clientX) / 2, (_this._touchCurrent[0].clientY + _this._touchCurrent[1].clientY) / 2);\n\n        var rotationPoint;\n\n        if (_this._state != STATE.ZROTATE) {\n          _this.updateTbState(STATE.ZROTATE, true);\n\n          _this._startFingerRotation = _this._currentFingerRotation;\n        } //this._currentFingerRotation = event.rotation;\n\n\n        _this._currentFingerRotation = _this.getAngle(_this._touchCurrent[1], _this._touchCurrent[0]) + _this.getAngle(_this._touchStart[1], _this._touchStart[0]);\n\n        if (!_this.enablePan) {\n          rotationPoint = new Vector3().setFromMatrixPosition(_this._gizmoMatrixState);\n        } else if (_this.camera instanceof PerspectiveCamera || _this.camera instanceof OrthographicCamera) {\n          var _this$unprojectOnTbPl3;\n\n          _this._v3_2.setFromMatrixPosition(_this._gizmoMatrixState);\n\n          rotationPoint = (_this$unprojectOnTbPl3 = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement)) === null || _this$unprojectOnTbPl3 === void 0 ? void 0 : _this$unprojectOnTbPl3.applyQuaternion(_this.camera.quaternion).multiplyScalar(1 / _this.camera.zoom).add(_this._v3_2);\n        }\n\n        var amount = MathUtils.DEG2RAD * (_this._startFingerRotation - _this._currentFingerRotation);\n\n        if (rotationPoint !== undefined) {\n          _this.applyTransformMatrix(_this.zRotate(rotationPoint, amount));\n        }\n\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onRotateEnd\", function () {\n      _this.updateTbState(STATE.IDLE, false);\n\n      _this.activateGizmos(false);\n\n      _this.dispatchEvent(_endEvent);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onPinchStart\", function () {\n      if (_this.enabled && _this.enableZoom) {\n        _this.dispatchEvent(_startEvent);\n\n        _this.updateTbState(STATE.SCALE, true);\n\n        _this._startFingerDistance = _this.calculatePointersDistance(_this._touchCurrent[0], _this._touchCurrent[1]);\n        _this._currentFingerDistance = _this._startFingerDistance;\n\n        _this.activateGizmos(false);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onPinchMove\", function () {\n      if (_this.enabled && _this.enableZoom) {\n        _this.setCenter((_this._touchCurrent[0].clientX + _this._touchCurrent[1].clientX) / 2, (_this._touchCurrent[0].clientY + _this._touchCurrent[1].clientY) / 2);\n\n        var minDistance = 12; //minimum distance between fingers (in css pixels)\n\n        if (_this._state != STATE.SCALE) {\n          _this._startFingerDistance = _this._currentFingerDistance;\n\n          _this.updateTbState(STATE.SCALE, true);\n        }\n\n        _this._currentFingerDistance = Math.max(_this.calculatePointersDistance(_this._touchCurrent[0], _this._touchCurrent[1]), minDistance * _this._devPxRatio);\n        var amount = _this._currentFingerDistance / _this._startFingerDistance;\n        var scalePoint;\n\n        if (!_this.enablePan) {\n          scalePoint = _this._gizmos.position;\n        } else {\n          if (_this.camera instanceof OrthographicCamera && _this.camera.isOrthographicCamera) {\n            var _this$unprojectOnTbPl4;\n\n            scalePoint = (_this$unprojectOnTbPl4 = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement)) === null || _this$unprojectOnTbPl4 === void 0 ? void 0 : _this$unprojectOnTbPl4.applyQuaternion(_this.camera.quaternion).multiplyScalar(1 / _this.camera.zoom).add(_this._gizmos.position);\n          } else if (_this.camera instanceof PerspectiveCamera && _this.camera.isPerspectiveCamera) {\n            var _this$unprojectOnTbPl5;\n\n            scalePoint = (_this$unprojectOnTbPl5 = _this.unprojectOnTbPlane(_this.camera, _center.x, _center.y, _this.domElement)) === null || _this$unprojectOnTbPl5 === void 0 ? void 0 : _this$unprojectOnTbPl5.applyQuaternion(_this.camera.quaternion).add(_this._gizmos.position);\n          }\n        }\n\n        if (scalePoint !== undefined) {\n          _this.applyTransformMatrix(_this.applyScale(amount, scalePoint));\n        }\n\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onPinchEnd\", function () {\n      _this.updateTbState(STATE.IDLE, false);\n\n      _this.dispatchEvent(_endEvent);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onTriplePanStart\", function () {\n      if (_this.enabled && _this.enableZoom) {\n        _this.dispatchEvent(_startEvent);\n\n        _this.updateTbState(STATE.SCALE, true); //const center = event.center;\n\n\n        var clientX = 0;\n        var clientY = 0;\n        var nFingers = _this._touchCurrent.length;\n\n        for (var i = 0; i < nFingers; i++) {\n          clientX += _this._touchCurrent[i].clientX;\n          clientY += _this._touchCurrent[i].clientY;\n        }\n\n        _this.setCenter(clientX / nFingers, clientY / nFingers);\n\n        _this._startCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n\n        _this._currentCursorPosition.copy(_this._startCursorPosition);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onTriplePanMove\", function () {\n      if (_this.enabled && _this.enableZoom && _this.camera !== null) {\n        //\t  fov / 2\n        //\t\t|\\\n        //\t\t| \\\n        //\t\t|  \\\n        //\tx\t|\t\\\n        //\t\t| \t \\\n        //\t\t| \t  \\\n        //\t\t| _ _ _\\\n        //\t\t\ty\n        //const center = event.center;\n        var clientX = 0;\n        var clientY = 0;\n        var nFingers = _this._touchCurrent.length;\n\n        for (var i = 0; i < nFingers; i++) {\n          clientX += _this._touchCurrent[i].clientX;\n          clientY += _this._touchCurrent[i].clientY;\n        }\n\n        _this.setCenter(clientX / nFingers, clientY / nFingers);\n\n        var screenNotches = 8; //how many wheel notches corresponds to a full screen pan\n\n        _this._currentCursorPosition.setY(_this.getCursorNDC(_center.x, _center.y, _this.domElement).y * 0.5);\n\n        var movement = _this._currentCursorPosition.y - _this._startCursorPosition.y;\n        var size = 1;\n\n        if (movement < 0) {\n          size = 1 / Math.pow(_this.scaleFactor, -movement * screenNotches);\n        } else if (movement > 0) {\n          size = Math.pow(_this.scaleFactor, movement * screenNotches);\n        }\n\n        _this._v3_1.setFromMatrixPosition(_this._cameraMatrixState);\n\n        var x = _this._v3_1.distanceTo(_this._gizmos.position);\n\n        var xNew = x / size; //distance between camera and gizmos if scale(size, scalepoint) would be performed\n        //check min and max distance\n\n        xNew = MathUtils.clamp(xNew, _this.minDistance, _this.maxDistance);\n        var y = x * Math.tan(MathUtils.DEG2RAD * _this._fovState * 0.5); //calculate new fov\n\n        var newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2); //check min and max fov\n\n        newFov = MathUtils.clamp(newFov, _this.minFov, _this.maxFov);\n        var newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n        size = x / newDistance;\n\n        _this._v3_2.setFromMatrixPosition(_this._gizmoMatrixState);\n\n        _this.setFov(newFov);\n\n        _this.applyTransformMatrix(_this.applyScale(size, _this._v3_2, false)); //adjusting distance\n\n\n        var direction = _this._gizmos.position.clone().sub(_this.camera.position).normalize().multiplyScalar(newDistance / x);\n\n        _this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onTriplePanEnd\", function () {\n      _this.updateTbState(STATE.IDLE, false);\n\n      _this.dispatchEvent(_endEvent); //this.dispatchEvent( _changeEvent );\n\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"setCenter\", function (clientX, clientY) {\n      _center.x = clientX;\n      _center.y = clientY;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"initializeMouseActions\", function () {\n      _this.setMouseAction('PAN', 0, 'CTRL');\n\n      _this.setMouseAction('PAN', 2);\n\n      _this.setMouseAction('ROTATE', 0);\n\n      _this.setMouseAction('ZOOM', 'WHEEL');\n\n      _this.setMouseAction('ZOOM', 1);\n\n      _this.setMouseAction('FOV', 'WHEEL', 'SHIFT');\n\n      _this.setMouseAction('FOV', 1, 'SHIFT');\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"compareMouseAction\", function (action1, action2) {\n      if (action1.operation == action2.operation) {\n        if (action1.mouse == action2.mouse && action1.key == action2.key) {\n          return true;\n        } else {\n          return false;\n        }\n      } else {\n        return false;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"setMouseAction\", function (operation, mouse) {\n      var key = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var operationInput = ['PAN', 'ROTATE', 'ZOOM', 'FOV'];\n      var mouseInput = [0, 1, 2, 'WHEEL'];\n      var keyInput = ['CTRL', 'SHIFT', null];\n      var state;\n\n      if (!operationInput.includes(operation) || !mouseInput.includes(mouse) || !keyInput.includes(key)) {\n        //invalid parameters\n        return false;\n      }\n\n      if (mouse == 'WHEEL') {\n        if (operation != 'ZOOM' && operation != 'FOV') {\n          //cannot associate 2D operation to 1D input\n          return false;\n        }\n      }\n\n      switch (operation) {\n        case 'PAN':\n          state = STATE.PAN;\n          break;\n\n        case 'ROTATE':\n          state = STATE.ROTATE;\n          break;\n\n        case 'ZOOM':\n          state = STATE.SCALE;\n          break;\n\n        case 'FOV':\n          state = STATE.FOV;\n          break;\n      }\n\n      var action = {\n        operation: operation,\n        mouse: mouse,\n        key: key,\n        state: state\n      };\n\n      for (var i = 0; i < _this.mouseActions.length; i++) {\n        if (_this.mouseActions[i].mouse == action.mouse && _this.mouseActions[i].key == action.key) {\n          _this.mouseActions.splice(i, 1, action);\n\n          return true;\n        }\n      }\n\n      _this.mouseActions.push(action);\n\n      return true;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"unsetMouseAction\", function (mouse) {\n      var key = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n      for (var i = 0; i < _this.mouseActions.length; i++) {\n        if (_this.mouseActions[i].mouse == mouse && _this.mouseActions[i].key == key) {\n          _this.mouseActions.splice(i, 1);\n\n          return true;\n        }\n      }\n\n      return false;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getOpFromAction\", function (mouse, key) {\n      var action;\n\n      for (var i = 0; i < _this.mouseActions.length; i++) {\n        action = _this.mouseActions[i];\n\n        if (action.mouse == mouse && action.key == key) {\n          return action.operation;\n        }\n      }\n\n      if (key != null) {\n        for (var _i = 0; _i < _this.mouseActions.length; _i++) {\n          action = _this.mouseActions[_i];\n\n          if (action.mouse == mouse && action.key == null) {\n            return action.operation;\n          }\n        }\n      }\n\n      return null;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getOpStateFromAction\", function (mouse, key) {\n      var action;\n\n      for (var i = 0; i < _this.mouseActions.length; i++) {\n        action = _this.mouseActions[i];\n\n        if (action.mouse == mouse && action.key == key) {\n          return action.state;\n        }\n      }\n\n      if (key != null) {\n        for (var _i2 = 0; _i2 < _this.mouseActions.length; _i2++) {\n          action = _this.mouseActions[_i2];\n\n          if (action.mouse == mouse && action.key == null) {\n            return action.state;\n          }\n        }\n      }\n\n      return null;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getAngle\", function (p1, p2) {\n      return Math.atan2(p2.clientY - p1.clientY, p2.clientX - p1.clientX) * 180 / Math.PI;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"updateTouchEvent\", function (event) {\n      for (var i = 0; i < _this._touchCurrent.length; i++) {\n        if (_this._touchCurrent[i].pointerId == event.pointerId) {\n          _this._touchCurrent.splice(i, 1, event);\n\n          break;\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"calculateAngularSpeed\", function (p0, p1, t0, t1) {\n      var s = p1 - p0;\n      var t = (t1 - t0) / 1000;\n\n      if (t == 0) {\n        return 0;\n      }\n\n      return s / t;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"calculatePointersDistance\", function (p0, p1) {\n      return Math.sqrt(Math.pow(p1.clientX - p0.clientX, 2) + Math.pow(p1.clientY - p0.clientY, 2));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"calculateRotationAxis\", function (vec1, vec2) {\n      _this._rotationMatrix.extractRotation(_this._cameraMatrixState);\n\n      _this._quat.setFromRotationMatrix(_this._rotationMatrix);\n\n      _this._rotationAxis.crossVectors(vec1, vec2).applyQuaternion(_this._quat);\n\n      return _this._rotationAxis.normalize().clone();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"calculateTbRadius\", function (camera) {\n      var factor = 0.67;\n      var distance = camera.position.distanceTo(_this._gizmos.position);\n\n      if (camera.type == 'PerspectiveCamera' && camera instanceof PerspectiveCamera) {\n        var halfFovV = MathUtils.DEG2RAD * camera.fov * 0.5; //vertical fov/2 in radians\n\n        var halfFovH = Math.atan(camera.aspect * Math.tan(halfFovV)); //horizontal fov/2 in radians\n\n        return Math.tan(Math.min(halfFovV, halfFovH)) * distance * factor;\n      } else if (camera.type == 'OrthographicCamera' && camera instanceof OrthographicCamera) {\n        return Math.min(camera.top, camera.right) * factor;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"focus\", function (point, size) {\n      var amount = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n\n      if (_this.camera !== null) {\n        var focusPoint = point.clone(); //move center of camera (along with gizmos) towards point of interest\n\n        focusPoint.sub(_this._gizmos.position).multiplyScalar(amount);\n\n        _this._translationMatrix.makeTranslation(focusPoint.x, focusPoint.y, focusPoint.z);\n\n        var gizmoStateTemp = _this._gizmoMatrixState.clone();\n\n        _this._gizmoMatrixState.premultiply(_this._translationMatrix);\n\n        _this._gizmoMatrixState.decompose(_this._gizmos.position, _this._gizmos.quaternion, _this._gizmos.scale);\n\n        var cameraStateTemp = _this._cameraMatrixState.clone();\n\n        _this._cameraMatrixState.premultiply(_this._translationMatrix);\n\n        _this._cameraMatrixState.decompose(_this.camera.position, _this.camera.quaternion, _this.camera.scale); //apply zoom\n\n\n        if (_this.enableZoom) {\n          _this.applyTransformMatrix(_this.applyScale(size, _this._gizmos.position));\n        }\n\n        _this._gizmoMatrixState.copy(gizmoStateTemp);\n\n        _this._cameraMatrixState.copy(cameraStateTemp);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"drawGrid\", function () {\n      if (_this.scene != null) {\n        var color = 0x888888;\n        var multiplier = 3;\n        var size, divisions, maxLength, tick;\n\n        if (_this.camera instanceof OrthographicCamera && _this.camera.isOrthographicCamera) {\n          var width = _this.camera.right - _this.camera.left;\n          var height = _this.camera.bottom - _this.camera.top;\n          maxLength = Math.max(width, height);\n          tick = maxLength / 20;\n          size = maxLength / _this.camera.zoom * multiplier;\n          divisions = size / tick * _this.camera.zoom;\n        } else if (_this.camera instanceof PerspectiveCamera && _this.camera.isPerspectiveCamera) {\n          var distance = _this.camera.position.distanceTo(_this._gizmos.position);\n\n          var halfFovV = MathUtils.DEG2RAD * _this.camera.fov * 0.5;\n          var halfFovH = Math.atan(_this.camera.aspect * Math.tan(halfFovV));\n          maxLength = Math.tan(Math.max(halfFovV, halfFovH)) * distance * 2;\n          tick = maxLength / 20;\n          size = maxLength * multiplier;\n          divisions = size / tick;\n        }\n\n        if (_this._grid == null && _this.camera !== null) {\n          _this._grid = new GridHelper(size, divisions, color, color);\n\n          _this._grid.position.copy(_this._gizmos.position);\n\n          _this._gridPosition.copy(_this._grid.position);\n\n          _this._grid.quaternion.copy(_this.camera.quaternion);\n\n          _this._grid.rotateX(Math.PI * 0.5);\n\n          _this.scene.add(_this._grid);\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"dispose\", function () {\n      var _this$scene;\n\n      if (_this._animationId != -1) {\n        window.cancelAnimationFrame(_this._animationId);\n      }\n\n      _this.domElement.removeEventListener('pointerdown', _this.onPointerDown);\n\n      _this.domElement.removeEventListener('pointercancel', _this.onPointerCancel);\n\n      _this.domElement.removeEventListener('wheel', _this.onWheel);\n\n      _this.domElement.removeEventListener('contextmenu', _this.onContextMenu);\n\n      window.removeEventListener('pointermove', _this.onPointerMove);\n      window.removeEventListener('pointerup', _this.onPointerUp);\n      window.removeEventListener('resize', _this.onWindowResize);\n      window.addEventListener('keydown', _this.onKeyDown);\n      (_this$scene = _this.scene) === null || _this$scene === void 0 ? void 0 : _this$scene.remove(_this._gizmos);\n\n      _this.disposeGrid();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"disposeGrid\", function () {\n      if (_this._grid != null && _this.scene != null) {\n        _this.scene.remove(_this._grid);\n\n        _this._grid = null;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"easeOutCubic\", function (t) {\n      return 1 - Math.pow(1 - t, 3);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"activateGizmos\", function (isActive) {\n      var gizmoX = _this._gizmos.children[0];\n      var gizmoY = _this._gizmos.children[1];\n      var gizmoZ = _this._gizmos.children[2];\n\n      if (isActive) {\n        gizmoX.material.setValues({\n          opacity: 1\n        });\n        gizmoY.material.setValues({\n          opacity: 1\n        });\n        gizmoZ.material.setValues({\n          opacity: 1\n        });\n      } else {\n        gizmoX.material.setValues({\n          opacity: 0.6\n        });\n        gizmoY.material.setValues({\n          opacity: 0.6\n        });\n        gizmoZ.material.setValues({\n          opacity: 0.6\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getCursorNDC\", function (cursorX, cursorY, canvas) {\n      var canvasRect = canvas.getBoundingClientRect();\n\n      _this._v2_1.setX((cursorX - canvasRect.left) / canvasRect.width * 2 - 1);\n\n      _this._v2_1.setY((canvasRect.bottom - cursorY) / canvasRect.height * 2 - 1);\n\n      return _this._v2_1.clone();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getCursorPosition\", function (cursorX, cursorY, canvas) {\n      _this._v2_1.copy(_this.getCursorNDC(cursorX, cursorY, canvas));\n\n      if (_this.camera instanceof OrthographicCamera) {\n        _this._v2_1.x *= (_this.camera.right - _this.camera.left) * 0.5;\n        _this._v2_1.y *= (_this.camera.top - _this.camera.bottom) * 0.5;\n      }\n\n      return _this._v2_1.clone();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"setCamera\", function (camera) {\n      if (camera instanceof PerspectiveCamera || camera instanceof OrthographicCamera) {\n        camera.lookAt(_this.target);\n        camera.updateMatrix(); //setting state\n\n        if ((camera === null || camera === void 0 ? void 0 : camera.type) == 'PerspectiveCamera' && camera instanceof PerspectiveCamera) {\n          _this._fov0 = camera.fov;\n          _this._fovState = camera.fov;\n        }\n\n        _this._cameraMatrixState0.copy(camera.matrix);\n\n        _this._cameraMatrixState.copy(_this._cameraMatrixState0);\n\n        _this._cameraProjectionState.copy(camera.projectionMatrix);\n\n        _this._zoom0 = camera.zoom;\n        _this._zoomState = _this._zoom0;\n        _this._initialNear = camera.near;\n        _this._nearPos0 = camera.position.distanceTo(_this.target) - camera.near;\n        _this._nearPos = _this._initialNear;\n        _this._initialFar = camera.far;\n        _this._farPos0 = camera.position.distanceTo(_this.target) - camera.far;\n        _this._farPos = _this._initialFar;\n\n        _this._up0.copy(camera.up);\n\n        _this._upState.copy(camera.up);\n\n        _this.camera = camera;\n\n        if (_this.camera instanceof PerspectiveCamera || _this.camera instanceof OrthographicCamera) {\n          _this.camera.updateProjectionMatrix();\n        } //making gizmos\n\n\n        var tbRadius = _this.calculateTbRadius(camera);\n\n        if (tbRadius !== undefined) {\n          _this._tbRadius = tbRadius;\n        }\n\n        _this.makeGizmos(_this.target, _this._tbRadius);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"makeGizmos\", function (tbCenter, tbRadius) {\n      // @ts-expect-error\n      var curve = new EllipseCurve(0, 0, tbRadius, tbRadius);\n      var points = curve.getPoints(_this._curvePts); //geometry\n\n      var curveGeometry = new BufferGeometry().setFromPoints(points); //material\n\n      var curveMaterialX = new LineBasicMaterial({\n        color: 0xff8080,\n        fog: false,\n        transparent: true,\n        opacity: 0.6\n      });\n      var curveMaterialY = new LineBasicMaterial({\n        color: 0x80ff80,\n        fog: false,\n        transparent: true,\n        opacity: 0.6\n      });\n      var curveMaterialZ = new LineBasicMaterial({\n        color: 0x8080ff,\n        fog: false,\n        transparent: true,\n        opacity: 0.6\n      }); //line\n\n      var gizmoX = new Line(curveGeometry, curveMaterialX);\n      var gizmoY = new Line(curveGeometry, curveMaterialY);\n      var gizmoZ = new Line(curveGeometry, curveMaterialZ);\n      var rotation = Math.PI * 0.5;\n      gizmoX.rotation.x = rotation;\n      gizmoY.rotation.y = rotation; //setting state\n\n      _this._gizmoMatrixState0.identity().setPosition(tbCenter);\n\n      _this._gizmoMatrixState.copy(_this._gizmoMatrixState0);\n\n      if ((_this.camera instanceof PerspectiveCamera || _this.camera instanceof OrthographicCamera) && _this.camera.zoom != 1) {\n        //adapt gizmos size to camera zoom\n        var size = 1 / _this.camera.zoom;\n\n        _this._scaleMatrix.makeScale(size, size, size);\n\n        _this._translationMatrix.makeTranslation(-tbCenter.x, -tbCenter.y, -tbCenter.z);\n\n        _this._gizmoMatrixState.premultiply(_this._translationMatrix).premultiply(_this._scaleMatrix);\n\n        _this._translationMatrix.makeTranslation(tbCenter.x, tbCenter.y, tbCenter.z);\n\n        _this._gizmoMatrixState.premultiply(_this._translationMatrix);\n      }\n\n      _this._gizmoMatrixState.decompose(_this._gizmos.position, _this._gizmos.quaternion, _this._gizmos.scale);\n\n      _this._gizmos.clear();\n\n      _this._gizmos.add(gizmoX);\n\n      _this._gizmos.add(gizmoY);\n\n      _this._gizmos.add(gizmoZ);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onFocusAnim\", function (time, point, cameraMatrix, gizmoMatrix) {\n      if (_this._timeStart == -1) {\n        //animation start\n        _this._timeStart = time;\n      }\n\n      if (_this._state == STATE.ANIMATION_FOCUS) {\n        var deltaTime = time - _this._timeStart;\n        var animTime = deltaTime / _this.focusAnimationTime;\n\n        _this._gizmoMatrixState.copy(gizmoMatrix);\n\n        if (animTime >= 1) {\n          //animation end\n          _this._gizmoMatrixState.decompose(_this._gizmos.position, _this._gizmos.quaternion, _this._gizmos.scale);\n\n          _this.focus(point, _this.scaleFactor);\n\n          _this._timeStart = -1;\n\n          _this.updateTbState(STATE.IDLE, false);\n\n          _this.activateGizmos(false);\n\n          _this.dispatchEvent(_changeEvent);\n        } else {\n          var amount = _this.easeOutCubic(animTime);\n\n          var size = 1 - amount + _this.scaleFactor * amount;\n\n          _this._gizmoMatrixState.decompose(_this._gizmos.position, _this._gizmos.quaternion, _this._gizmos.scale);\n\n          _this.focus(point, size, amount);\n\n          _this.dispatchEvent(_changeEvent);\n\n          var self = _assertThisInitialized(_this);\n\n          _this._animationId = window.requestAnimationFrame(function (t) {\n            self.onFocusAnim(t, point, cameraMatrix, gizmoMatrix.clone());\n          });\n        }\n      } else {\n        //interrupt animation\n        _this._animationId = -1;\n        _this._timeStart = -1;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onRotationAnim\", function (time, rotationAxis, w0) {\n      if (_this._timeStart == -1) {\n        //animation start\n        _this._anglePrev = 0;\n        _this._angleCurrent = 0;\n        _this._timeStart = time;\n      }\n\n      if (_this._state == STATE.ANIMATION_ROTATE) {\n        //w = w0 + alpha * t\n        var deltaTime = (time - _this._timeStart) / 1000;\n        var w = w0 + -_this.dampingFactor * deltaTime;\n\n        if (w > 0) {\n          //tetha = 0.5 * alpha * t^2 + w0 * t + tetha0\n          _this._angleCurrent = 0.5 * -_this.dampingFactor * Math.pow(deltaTime, 2) + w0 * deltaTime + 0;\n\n          _this.applyTransformMatrix(_this.rotate(rotationAxis, _this._angleCurrent));\n\n          _this.dispatchEvent(_changeEvent);\n\n          var self = _assertThisInitialized(_this);\n\n          _this._animationId = window.requestAnimationFrame(function (t) {\n            self.onRotationAnim(t, rotationAxis, w0);\n          });\n        } else {\n          _this._animationId = -1;\n          _this._timeStart = -1;\n\n          _this.updateTbState(STATE.IDLE, false);\n\n          _this.activateGizmos(false);\n\n          _this.dispatchEvent(_changeEvent);\n        }\n      } else {\n        //interrupt animation\n        _this._animationId = -1;\n        _this._timeStart = -1;\n\n        if (_this._state != STATE.ROTATE) {\n          _this.activateGizmos(false);\n\n          _this.dispatchEvent(_changeEvent);\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"pan\", function (p0, p1) {\n      var adjust = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n      if (_this.camera !== null) {\n        var movement = p0.clone().sub(p1);\n\n        if (_this.camera instanceof OrthographicCamera && _this.camera.isOrthographicCamera) {\n          //adjust movement amount\n          movement.multiplyScalar(1 / _this.camera.zoom);\n        } else if (_this.camera instanceof PerspectiveCamera && _this.camera.isPerspectiveCamera && adjust) {\n          //adjust movement amount\n          _this._v3_1.setFromMatrixPosition(_this._cameraMatrixState0); //camera's initial position\n\n\n          _this._v3_2.setFromMatrixPosition(_this._gizmoMatrixState0); //gizmo's initial position\n\n\n          var distanceFactor = _this._v3_1.distanceTo(_this._v3_2) / _this.camera.position.distanceTo(_this._gizmos.position);\n\n          movement.multiplyScalar(1 / distanceFactor);\n        }\n\n        _this._v3_1.set(movement.x, movement.y, 0).applyQuaternion(_this.camera.quaternion);\n\n        _this._m4_1.makeTranslation(_this._v3_1.x, _this._v3_1.y, _this._v3_1.z);\n\n        _this.setTransformationMatrices(_this._m4_1, _this._m4_1);\n      }\n\n      return _transformation;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"reset\", function () {\n      if (_this.camera instanceof PerspectiveCamera || _this.camera instanceof OrthographicCamera) {\n        _this.camera.zoom = _this._zoom0;\n\n        if (_this.camera instanceof PerspectiveCamera && _this.camera.isPerspectiveCamera) {\n          _this.camera.fov = _this._fov0;\n        }\n\n        _this.camera.near = _this._nearPos;\n        _this.camera.far = _this._farPos;\n\n        _this._cameraMatrixState.copy(_this._cameraMatrixState0);\n\n        _this._cameraMatrixState.decompose(_this.camera.position, _this.camera.quaternion, _this.camera.scale);\n\n        _this.camera.up.copy(_this._up0);\n\n        _this.camera.updateMatrix();\n\n        _this.camera.updateProjectionMatrix();\n\n        _this._gizmoMatrixState.copy(_this._gizmoMatrixState0);\n\n        _this._gizmoMatrixState0.decompose(_this._gizmos.position, _this._gizmos.quaternion, _this._gizmos.scale);\n\n        _this._gizmos.updateMatrix();\n\n        var tbRadius = _this.calculateTbRadius(_this.camera);\n\n        if (tbRadius !== undefined) {\n          _this._tbRadius = tbRadius;\n        }\n\n        _this.makeGizmos(_this._gizmos.position, _this._tbRadius);\n\n        _this.camera.lookAt(_this._gizmos.position);\n\n        _this.updateTbState(STATE.IDLE, false);\n\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"rotate\", function (axis, angle) {\n      var point = _this._gizmos.position; //rotation center\n\n      _this._translationMatrix.makeTranslation(-point.x, -point.y, -point.z);\n\n      _this._rotationMatrix.makeRotationAxis(axis, -angle); //rotate camera\n\n\n      _this._m4_1.makeTranslation(point.x, point.y, point.z);\n\n      _this._m4_1.multiply(_this._rotationMatrix);\n\n      _this._m4_1.multiply(_this._translationMatrix);\n\n      _this.setTransformationMatrices(_this._m4_1);\n\n      return _transformation;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"copyState\", function () {\n      var state;\n\n      if (_this.camera instanceof OrthographicCamera && _this.camera.isOrthographicCamera) {\n        state = JSON.stringify({\n          arcballState: {\n            cameraFar: _this.camera.far,\n            cameraMatrix: _this.camera.matrix,\n            cameraNear: _this.camera.near,\n            cameraUp: _this.camera.up,\n            cameraZoom: _this.camera.zoom,\n            gizmoMatrix: _this._gizmos.matrix\n          }\n        });\n      } else if (_this.camera instanceof PerspectiveCamera && _this.camera.isPerspectiveCamera) {\n        state = JSON.stringify({\n          arcballState: {\n            cameraFar: _this.camera.far,\n            cameraFov: _this.camera.fov,\n            cameraMatrix: _this.camera.matrix,\n            cameraNear: _this.camera.near,\n            cameraUp: _this.camera.up,\n            cameraZoom: _this.camera.zoom,\n            gizmoMatrix: _this._gizmos.matrix\n          }\n        });\n      }\n\n      if (state !== undefined) {\n        navigator.clipboard.writeText(state);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"pasteState\", function () {\n      var self = _assertThisInitialized(_this);\n\n      navigator.clipboard.readText().then(function resolved(value) {\n        self.setStateFromJSON(value);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"saveState\", function () {\n      if (_this.camera instanceof PerspectiveCamera || _this.camera instanceof OrthographicCamera) {\n        _this._cameraMatrixState0.copy(_this.camera.matrix);\n\n        _this._gizmoMatrixState0.copy(_this._gizmos.matrix);\n\n        _this._nearPos = _this.camera.near;\n        _this._farPos = _this.camera.far;\n        _this._zoom0 = _this.camera.zoom;\n\n        _this._up0.copy(_this.camera.up);\n\n        if (_this.camera instanceof PerspectiveCamera && _this.camera.isPerspectiveCamera) {\n          _this._fov0 = _this.camera.fov;\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"applyScale\", function (size, point) {\n      var scaleGizmos = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n      var scalePoint = point.clone();\n      var sizeInverse = 1 / size;\n\n      if (_this.camera instanceof OrthographicCamera && _this.camera.isOrthographicCamera) {\n        //camera zoom\n        _this.camera.zoom = _this._zoomState;\n        _this.camera.zoom *= size; //check min and max zoom\n\n        if (_this.camera.zoom > _this.maxZoom) {\n          _this.camera.zoom = _this.maxZoom;\n          sizeInverse = _this._zoomState / _this.maxZoom;\n        } else if (_this.camera.zoom < _this.minZoom) {\n          _this.camera.zoom = _this.minZoom;\n          sizeInverse = _this._zoomState / _this.minZoom;\n        }\n\n        _this.camera.updateProjectionMatrix();\n\n        _this._v3_1.setFromMatrixPosition(_this._gizmoMatrixState); //gizmos position\n        //scale gizmos so they appear in the same spot having the same dimension\n\n\n        _this._scaleMatrix.makeScale(sizeInverse, sizeInverse, sizeInverse);\n\n        _this._translationMatrix.makeTranslation(-_this._v3_1.x, -_this._v3_1.y, -_this._v3_1.z);\n\n        _this._m4_2.makeTranslation(_this._v3_1.x, _this._v3_1.y, _this._v3_1.z).multiply(_this._scaleMatrix);\n\n        _this._m4_2.multiply(_this._translationMatrix); //move camera and gizmos to obtain pinch effect\n\n\n        scalePoint.sub(_this._v3_1);\n        var amount = scalePoint.clone().multiplyScalar(sizeInverse);\n        scalePoint.sub(amount);\n\n        _this._m4_1.makeTranslation(scalePoint.x, scalePoint.y, scalePoint.z);\n\n        _this._m4_2.premultiply(_this._m4_1);\n\n        _this.setTransformationMatrices(_this._m4_1, _this._m4_2);\n\n        return _transformation;\n      } else if (_this.camera instanceof PerspectiveCamera && _this.camera.isPerspectiveCamera) {\n        _this._v3_1.setFromMatrixPosition(_this._cameraMatrixState);\n\n        _this._v3_2.setFromMatrixPosition(_this._gizmoMatrixState); //move camera\n\n\n        var distance = _this._v3_1.distanceTo(scalePoint);\n\n        var _amount = distance - distance * sizeInverse; //check min and max distance\n\n\n        var newDistance = distance - _amount;\n\n        if (newDistance < _this.minDistance) {\n          sizeInverse = _this.minDistance / distance;\n          _amount = distance - distance * sizeInverse;\n        } else if (newDistance > _this.maxDistance) {\n          sizeInverse = _this.maxDistance / distance;\n          _amount = distance - distance * sizeInverse;\n        }\n\n        var direction = scalePoint.clone().sub(_this._v3_1).normalize().multiplyScalar(_amount);\n\n        _this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n\n        if (scaleGizmos) {\n          //scale gizmos so they appear in the same spot having the same dimension\n          var pos = _this._v3_2;\n          distance = pos.distanceTo(scalePoint);\n          _amount = distance - distance * sizeInverse;\n          direction = scalePoint.clone().sub(_this._v3_2).normalize().multiplyScalar(_amount);\n\n          _this._translationMatrix.makeTranslation(pos.x, pos.y, pos.z);\n\n          _this._scaleMatrix.makeScale(sizeInverse, sizeInverse, sizeInverse);\n\n          _this._m4_2.makeTranslation(direction.x, direction.y, direction.z).multiply(_this._translationMatrix);\n\n          _this._m4_2.multiply(_this._scaleMatrix);\n\n          _this._translationMatrix.makeTranslation(-pos.x, -pos.y, -pos.z);\n\n          _this._m4_2.multiply(_this._translationMatrix);\n\n          _this.setTransformationMatrices(_this._m4_1, _this._m4_2);\n        } else {\n          _this.setTransformationMatrices(_this._m4_1);\n        }\n\n        return _transformation;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"setFov\", function (value) {\n      if (_this.camera instanceof PerspectiveCamera && _this.camera.isPerspectiveCamera) {\n        _this.camera.fov = MathUtils.clamp(value, _this.minFov, _this.maxFov);\n\n        _this.camera.updateProjectionMatrix();\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"setTarget\", function (x, y, z) {\n      if (_this.camera !== null) {\n        _this.target.set(x, y, z);\n\n        _this._gizmos.position.set(x, y, z); //for correct radius calculation\n\n\n        var tbRadius = _this.calculateTbRadius(_this.camera);\n\n        if (tbRadius !== undefined) {\n          _this._tbRadius = tbRadius;\n        }\n\n        _this.makeGizmos(_this.target, _this._tbRadius);\n\n        _this.camera.lookAt(_this.target);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"zRotate\", function (point, angle) {\n      _this._rotationMatrix.makeRotationAxis(_this._rotationAxis, angle);\n\n      _this._translationMatrix.makeTranslation(-point.x, -point.y, -point.z);\n\n      _this._m4_1.makeTranslation(point.x, point.y, point.z);\n\n      _this._m4_1.multiply(_this._rotationMatrix);\n\n      _this._m4_1.multiply(_this._translationMatrix);\n\n      _this._v3_1.setFromMatrixPosition(_this._gizmoMatrixState).sub(point); //vector from rotation center to gizmos position\n\n\n      _this._v3_2.copy(_this._v3_1).applyAxisAngle(_this._rotationAxis, angle); //apply rotation\n\n\n      _this._v3_2.sub(_this._v3_1);\n\n      _this._m4_2.makeTranslation(_this._v3_2.x, _this._v3_2.y, _this._v3_2.z);\n\n      _this.setTransformationMatrices(_this._m4_1, _this._m4_2);\n\n      return _transformation;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"unprojectOnObj\", function (cursor, camera) {\n      if ((camera instanceof PerspectiveCamera || camera instanceof OrthographicCamera) && _this.scene != null) {\n        var raycaster = new Raycaster();\n        raycaster.near = camera.near;\n        raycaster.far = camera.far;\n        raycaster.setFromCamera(cursor, camera);\n        var intersect = raycaster.intersectObjects(_this.scene.children, true);\n\n        for (var i = 0; i < intersect.length; i++) {\n          if (intersect[i].object.uuid != _this._gizmos.uuid && intersect[i].face != null) {\n            return intersect[i].point.clone();\n          }\n        }\n      }\n\n      return null;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"unprojectOnTbSurface\", function (camera, cursorX, cursorY, canvas, tbRadius) {\n      if (camera.type == 'OrthographicCamera') {\n        _this._v2_1.copy(_this.getCursorPosition(cursorX, cursorY, canvas));\n\n        _this._v3_1.set(_this._v2_1.x, _this._v2_1.y, 0);\n\n        var x2 = Math.pow(_this._v2_1.x, 2);\n        var y2 = Math.pow(_this._v2_1.y, 2);\n        var r2 = Math.pow(_this._tbRadius, 2);\n\n        if (x2 + y2 <= r2 * 0.5) {\n          //intersection with sphere\n          _this._v3_1.setZ(Math.sqrt(r2 - (x2 + y2)));\n        } else {\n          //intersection with hyperboloid\n          _this._v3_1.setZ(r2 * 0.5 / Math.sqrt(x2 + y2));\n        }\n\n        return _this._v3_1;\n      } else if (camera.type == 'PerspectiveCamera') {\n        //unproject cursor on the near plane\n        _this._v2_1.copy(_this.getCursorNDC(cursorX, cursorY, canvas));\n\n        _this._v3_1.set(_this._v2_1.x, _this._v2_1.y, -1);\n\n        _this._v3_1.applyMatrix4(camera.projectionMatrixInverse);\n\n        var rayDir = _this._v3_1.clone().normalize(); //unprojected ray direction\n\n\n        var cameraGizmoDistance = camera.position.distanceTo(_this._gizmos.position);\n        var radius2 = Math.pow(tbRadius, 2); //\t  camera\n        //\t\t|\\\n        //\t\t| \\\n        //\t\t|  \\\n        //\th\t|\t\\\n        //\t\t| \t \\\n        //\t\t| \t  \\\n        //\t_ _ | _ _ _\\ _ _  near plane\n        //\t\t\tl\n\n        var h = _this._v3_1.z;\n        var l = Math.sqrt(Math.pow(_this._v3_1.x, 2) + Math.pow(_this._v3_1.y, 2));\n\n        if (l == 0) {\n          //ray aligned with camera\n          rayDir.set(_this._v3_1.x, _this._v3_1.y, tbRadius);\n          return rayDir;\n        }\n\n        var m = h / l;\n        var q = cameraGizmoDistance;\n        /*\n         * calculate intersection point between unprojected ray and trackball surface\n         *|y = m * x + q\n         *|x^2 + y^2 = r^2\n         *\n         * (m^2 + 1) * x^2 + (2 * m * q) * x + q^2 - r^2 = 0\n         */\n\n        var a = Math.pow(m, 2) + 1;\n        var b = 2 * m * q;\n        var c = Math.pow(q, 2) - radius2;\n        var delta = Math.pow(b, 2) - 4 * a * c;\n\n        if (delta >= 0) {\n          //intersection with sphere\n          _this._v2_1.setX((-b - Math.sqrt(delta)) / (2 * a));\n\n          _this._v2_1.setY(m * _this._v2_1.x + q);\n\n          var angle = MathUtils.RAD2DEG * _this._v2_1.angle();\n\n          if (angle >= 45) {\n            //if angle between intersection point and X' axis is >= 45, return that point\n            //otherwise, calculate intersection point with hyperboloid\n            var _rayLength = Math.sqrt(Math.pow(_this._v2_1.x, 2) + Math.pow(cameraGizmoDistance - _this._v2_1.y, 2));\n\n            rayDir.multiplyScalar(_rayLength);\n            rayDir.z += cameraGizmoDistance;\n            return rayDir;\n          }\n        } //intersection with hyperboloid\n\n        /*\n         *|y = m * x + q\n         *|y = (1 / x) * (r^2 / 2)\n         *\n         * m * x^2 + q * x - r^2 / 2 = 0\n         */\n\n\n        a = m;\n        b = q;\n        c = -radius2 * 0.5;\n        delta = Math.pow(b, 2) - 4 * a * c;\n\n        _this._v2_1.setX((-b - Math.sqrt(delta)) / (2 * a));\n\n        _this._v2_1.setY(m * _this._v2_1.x + q);\n\n        var rayLength = Math.sqrt(Math.pow(_this._v2_1.x, 2) + Math.pow(cameraGizmoDistance - _this._v2_1.y, 2));\n        rayDir.multiplyScalar(rayLength);\n        rayDir.z += cameraGizmoDistance;\n        return rayDir;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"unprojectOnTbPlane\", function (camera, cursorX, cursorY, canvas) {\n      var initialDistance = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n\n      if (camera.type == 'OrthographicCamera') {\n        _this._v2_1.copy(_this.getCursorPosition(cursorX, cursorY, canvas));\n\n        _this._v3_1.set(_this._v2_1.x, _this._v2_1.y, 0);\n\n        return _this._v3_1.clone();\n      } else if (camera.type == 'PerspectiveCamera') {\n        _this._v2_1.copy(_this.getCursorNDC(cursorX, cursorY, canvas)); //unproject cursor on the near plane\n\n\n        _this._v3_1.set(_this._v2_1.x, _this._v2_1.y, -1);\n\n        _this._v3_1.applyMatrix4(camera.projectionMatrixInverse);\n\n        var rayDir = _this._v3_1.clone().normalize(); //unprojected ray direction\n        //\t  camera\n        //\t\t|\\\n        //\t\t| \\\n        //\t\t|  \\\n        //\th\t|\t\\\n        //\t\t| \t \\\n        //\t\t| \t  \\\n        //\t_ _ | _ _ _\\ _ _  near plane\n        //\t\t\tl\n\n\n        var h = _this._v3_1.z;\n        var l = Math.sqrt(Math.pow(_this._v3_1.x, 2) + Math.pow(_this._v3_1.y, 2));\n        var cameraGizmoDistance;\n\n        if (initialDistance) {\n          cameraGizmoDistance = _this._v3_1.setFromMatrixPosition(_this._cameraMatrixState0).distanceTo(_this._v3_2.setFromMatrixPosition(_this._gizmoMatrixState0));\n        } else {\n          cameraGizmoDistance = camera.position.distanceTo(_this._gizmos.position);\n        }\n        /*\n         * calculate intersection point between unprojected ray and the plane\n         *|y = mx + q\n         *|y = 0\n         *\n         * x = -q/m\n         */\n\n\n        if (l == 0) {\n          //ray aligned with camera\n          rayDir.set(0, 0, 0);\n          return rayDir;\n        }\n\n        var m = h / l;\n        var q = cameraGizmoDistance;\n        var x = -q / m;\n        var rayLength = Math.sqrt(Math.pow(q, 2) + Math.pow(x, 2));\n        rayDir.multiplyScalar(rayLength);\n        rayDir.z = 0;\n        return rayDir;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"updateMatrixState\", function () {\n      if (_this.camera !== null) {\n        //update camera and gizmos state\n        _this._cameraMatrixState.copy(_this.camera.matrix);\n\n        _this._gizmoMatrixState.copy(_this._gizmos.matrix);\n\n        if (_this.camera instanceof OrthographicCamera && _this.camera.isOrthographicCamera) {\n          _this._cameraProjectionState.copy(_this.camera.projectionMatrix);\n\n          _this.camera.updateProjectionMatrix();\n\n          _this._zoomState = _this.camera.zoom;\n        } else if (_this.camera instanceof PerspectiveCamera && _this.camera.isPerspectiveCamera) {\n          _this._fovState = _this.camera.fov;\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"updateTbState\", function (newState, updateMatrices) {\n      _this._state = newState;\n\n      if (updateMatrices) {\n        _this.updateMatrixState();\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"update\", function () {\n      var _this$camera2;\n\n      var EPS = 0.000001; // Update target and gizmos state\n\n      if (!_this.target.equals(_this._currentTarget) && _this.camera !== null) {\n        _this._gizmos.position.set(_this.target.x, _this.target.y, _this.target.z); //for correct radius calculation\n\n\n        var tbRadius = _this.calculateTbRadius(_this.camera);\n\n        if (tbRadius !== undefined) {\n          _this._tbRadius = tbRadius;\n        }\n\n        _this.makeGizmos(_this.target, _this._tbRadius);\n\n        _this._currentTarget.copy(_this.target);\n      } //check min/max parameters\n\n\n      if (_this.camera instanceof OrthographicCamera && _this.camera.isOrthographicCamera) {\n        //check zoom\n        if (_this.camera.zoom > _this.maxZoom || _this.camera.zoom < _this.minZoom) {\n          var newZoom = MathUtils.clamp(_this.camera.zoom, _this.minZoom, _this.maxZoom);\n\n          _this.applyTransformMatrix(_this.applyScale(newZoom / _this.camera.zoom, _this._gizmos.position, true));\n        }\n      } else if (_this.camera instanceof PerspectiveCamera && _this.camera.isPerspectiveCamera) {\n        //check distance\n        var distance = _this.camera.position.distanceTo(_this._gizmos.position);\n\n        if (distance > _this.maxDistance + EPS || distance < _this.minDistance - EPS) {\n          var newDistance = MathUtils.clamp(distance, _this.minDistance, _this.maxDistance);\n\n          _this.applyTransformMatrix(_this.applyScale(newDistance / distance, _this._gizmos.position));\n\n          _this.updateMatrixState();\n        } //check fov\n\n\n        if (_this.camera.fov < _this.minFov || _this.camera.fov > _this.maxFov) {\n          _this.camera.fov = MathUtils.clamp(_this.camera.fov, _this.minFov, _this.maxFov);\n\n          _this.camera.updateProjectionMatrix();\n        }\n\n        var oldRadius = _this._tbRadius;\n\n        var _tbRadius = _this.calculateTbRadius(_this.camera);\n\n        if (_tbRadius !== undefined) {\n          _this._tbRadius = _tbRadius;\n        }\n\n        if (oldRadius < _this._tbRadius - EPS || oldRadius > _this._tbRadius + EPS) {\n          var scale = (_this._gizmos.scale.x + _this._gizmos.scale.y + _this._gizmos.scale.z) / 3;\n          var newRadius = _this._tbRadius / scale; // @ts-expect-error\n\n          var curve = new EllipseCurve(0, 0, newRadius, newRadius);\n          var points = curve.getPoints(_this._curvePts);\n          var curveGeometry = new BufferGeometry().setFromPoints(points);\n\n          for (var gizmo in _this._gizmos.children) {\n            var child = _this._gizmos.children[gizmo];\n\n            if (child instanceof Mesh) {\n              child.geometry = curveGeometry;\n            }\n          }\n        }\n      }\n\n      (_this$camera2 = _this.camera) === null || _this$camera2 === void 0 ? void 0 : _this$camera2.lookAt(_this._gizmos.position);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"setStateFromJSON\", function (json) {\n      var state = JSON.parse(json);\n\n      if (state.arcballState != undefined && (_this.camera instanceof PerspectiveCamera || _this.camera instanceof OrthographicCamera)) {\n        _this._cameraMatrixState.fromArray(state.arcballState.cameraMatrix.elements);\n\n        _this._cameraMatrixState.decompose(_this.camera.position, _this.camera.quaternion, _this.camera.scale);\n\n        _this.camera.up.copy(state.arcballState.cameraUp);\n\n        _this.camera.near = state.arcballState.cameraNear;\n        _this.camera.far = state.arcballState.cameraFar;\n        _this.camera.zoom = state.arcballState.cameraZoom;\n\n        if (_this.camera instanceof PerspectiveCamera && _this.camera.isPerspectiveCamera) {\n          _this.camera.fov = state.arcballState.cameraFov;\n        }\n\n        _this._gizmoMatrixState.fromArray(state.arcballState.gizmoMatrix.elements);\n\n        _this._gizmoMatrixState.decompose(_this._gizmos.position, _this._gizmos.quaternion, _this._gizmos.scale);\n\n        _this.camera.updateMatrix();\n\n        _this.camera.updateProjectionMatrix();\n\n        _this._gizmos.updateMatrix();\n\n        var tbRadius = _this.calculateTbRadius(_this.camera);\n\n        if (tbRadius !== undefined) {\n          _this._tbRadius = tbRadius;\n        }\n\n        var gizmoTmp = new Matrix4().copy(_this._gizmoMatrixState0);\n\n        _this.makeGizmos(_this._gizmos.position, _this._tbRadius);\n\n        _this._gizmoMatrixState0.copy(gizmoTmp);\n\n        _this.camera.lookAt(_this._gizmos.position);\n\n        _this.updateTbState(STATE.IDLE, false);\n\n        _this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _this.camera = null;\n    _this.domElement = domElement;\n    _this.scene = scene;\n    _this.mouseActions = [];\n    _this._mouseOp = null; //global vectors and matrices that are used in some operations to avoid creating new objects every time (e.g. every time cursor moves)\n\n    _this._v2_1 = new Vector2();\n    _this._v3_1 = new Vector3();\n    _this._v3_2 = new Vector3();\n    _this._m4_1 = new Matrix4();\n    _this._m4_2 = new Matrix4();\n    _this._quat = new Quaternion(); //transformation matrices\n\n    _this._translationMatrix = new Matrix4(); //matrix for translation operation\n\n    _this._rotationMatrix = new Matrix4(); //matrix for rotation operation\n\n    _this._scaleMatrix = new Matrix4(); //matrix for scaling operation\n\n    _this._rotationAxis = new Vector3(); //axis for rotate operation\n    //camera state\n\n    _this._cameraMatrixState = new Matrix4();\n    _this._cameraProjectionState = new Matrix4();\n    _this._fovState = 1;\n    _this._upState = new Vector3();\n    _this._zoomState = 1;\n    _this._nearPos = 0;\n    _this._farPos = 0;\n    _this._gizmoMatrixState = new Matrix4(); //initial values\n\n    _this._up0 = new Vector3();\n    _this._zoom0 = 1;\n    _this._fov0 = 0;\n    _this._initialNear = 0;\n    _this._nearPos0 = 0;\n    _this._initialFar = 0;\n    _this._farPos0 = 0;\n    _this._cameraMatrixState0 = new Matrix4();\n    _this._gizmoMatrixState0 = new Matrix4(); //pointers array\n\n    _this._button = -1;\n    _this._touchStart = [];\n    _this._touchCurrent = [];\n    _this._input = INPUT.NONE; //two fingers touch interaction\n\n    _this._switchSensibility = 32; //minimum movement to be performed to fire single pan start after the second finger has been released\n\n    _this._startFingerDistance = 0; //distance between two fingers\n\n    _this._currentFingerDistance = 0;\n    _this._startFingerRotation = 0; //amount of rotation performed with two fingers\n\n    _this._currentFingerRotation = 0; //double tap\n\n    _this._devPxRatio = 0;\n    _this._downValid = true;\n    _this._nclicks = 0;\n    _this._downEvents = [];\n    _this._downStart = 0; //pointerDown time\n\n    _this._clickStart = 0; //first click time\n\n    _this._maxDownTime = 250;\n    _this._maxInterval = 300;\n    _this._posThreshold = 24;\n    _this._movementThreshold = 24; //cursor positions\n\n    _this._currentCursorPosition = new Vector3();\n    _this._startCursorPosition = new Vector3(); //grid\n\n    _this._grid = null; //grid to be visualized during pan operation\n\n    _this._gridPosition = new Vector3(); //gizmos\n\n    _this._gizmos = new Group();\n    _this._curvePts = 128; //animations\n\n    _this._timeStart = -1; //initial time\n\n    _this._animationId = -1; //focus animation\n\n    _this.focusAnimationTime = 500; //duration of focus animation in ms\n    //rotate animation\n\n    _this._timePrev = 0; //time at which previous rotate operation has been detected\n\n    _this._timeCurrent = 0; //time at which current rotate operation has been detected\n\n    _this._anglePrev = 0; //angle of previous rotation\n\n    _this._angleCurrent = 0; //angle of current rotation\n\n    _this._cursorPosPrev = new Vector3(); //cursor position when previous rotate operation has been detected\n\n    _this._cursorPosCurr = new Vector3(); //cursor position when current rotate operation has been detected\n\n    _this._wPrev = 0; //angular velocity of the previous rotate operation\n\n    _this._wCurr = 0; //angular velocity of the current rotate operation\n    //parameters\n\n    _this.adjustNearFar = false;\n    _this.scaleFactor = 1.1; //zoom/distance multiplier\n\n    _this.dampingFactor = 25;\n    _this.wMax = 20; //maximum angular velocity allowed\n\n    _this.enableAnimations = true; //if animations should be performed\n\n    _this.enableGrid = false; //if grid should be showed during pan operation\n\n    _this.cursorZoom = false; //if wheel zoom should be cursor centered\n\n    _this.minFov = 5;\n    _this.maxFov = 90;\n    _this.enabled = true;\n    _this.enablePan = true;\n    _this.enableRotate = true;\n    _this.enableZoom = true;\n    _this.enableGizmos = true;\n    _this.minDistance = 0;\n    _this.maxDistance = Infinity;\n    _this.minZoom = 0;\n    _this.maxZoom = Infinity; //trackball parameters\n\n    _this.target = new Vector3(0, 0, 0);\n    _this._currentTarget = new Vector3(0, 0, 0);\n    _this._tbRadius = 1; //FSA\n\n    _this._state = STATE.IDLE;\n\n    _this.setCamera(_camera);\n\n    if (_this.scene != null) {\n      _this.scene.add(_this._gizmos);\n    }\n\n    _this.domElement.style.touchAction = 'none';\n    _this._devPxRatio = window.devicePixelRatio;\n\n    _this.initializeMouseActions();\n\n    _this.domElement.addEventListener('contextmenu', _this.onContextMenu);\n\n    _this.domElement.addEventListener('wheel', _this.onWheel);\n\n    _this.domElement.addEventListener('pointerdown', _this.onPointerDown);\n\n    _this.domElement.addEventListener('pointercancel', _this.onPointerCancel);\n\n    window.addEventListener('keydown', _this.onKeyDown);\n    window.addEventListener('resize', _this.onWindowResize);\n    return _this;\n  } //listeners\n\n  /**\n   * Apply a transformation matrix, to the camera and gizmos\n   * @param {Object} transformation Object containing matrices to apply to camera and gizmos\n   */\n\n\n  _createClass(ArcballControls, [{\n    key: \"applyTransformMatrix\",\n    value: function applyTransformMatrix(transformation) {\n      if ((transformation === null || transformation === void 0 ? void 0 : transformation.camera) != null && this.camera !== null) {\n        this._m4_1.copy(this._cameraMatrixState).premultiply(transformation.camera);\n\n        this._m4_1.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n\n        this.camera.updateMatrix(); //update camera up vector\n\n        if (this._state == STATE.ROTATE || this._state == STATE.ZROTATE || this._state == STATE.ANIMATION_ROTATE) {\n          this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion);\n        }\n      }\n\n      if ((transformation === null || transformation === void 0 ? void 0 : transformation.gizmos) != null) {\n        this._m4_1.copy(this._gizmoMatrixState).premultiply(transformation.gizmos);\n\n        this._m4_1.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n\n        this._gizmos.updateMatrix();\n      }\n\n      if ((this._state == STATE.SCALE || this._state == STATE.FOCUS || this._state == STATE.ANIMATION_FOCUS) && (this.camera instanceof PerspectiveCamera || this.camera instanceof OrthographicCamera)) {\n        var tbRadius = this.calculateTbRadius(this.camera);\n\n        if (tbRadius !== undefined) {\n          this._tbRadius = tbRadius;\n        }\n\n        if (this.adjustNearFar) {\n          var cameraDistance = this.camera.position.distanceTo(this._gizmos.position);\n          var bb = new Box3();\n          bb.setFromObject(this._gizmos);\n          var sphere = new Sphere();\n          bb.getBoundingSphere(sphere);\n          var adjustedNearPosition = Math.max(this._nearPos0, sphere.radius + sphere.center.length());\n          var regularNearPosition = cameraDistance - this._initialNear;\n          var minNearPos = Math.min(adjustedNearPosition, regularNearPosition);\n          this.camera.near = cameraDistance - minNearPos;\n          var adjustedFarPosition = Math.min(this._farPos0, -sphere.radius + sphere.center.length());\n          var regularFarPosition = cameraDistance - this._initialFar;\n          var minFarPos = Math.min(adjustedFarPosition, regularFarPosition);\n          this.camera.far = cameraDistance - minFarPos;\n          this.camera.updateProjectionMatrix();\n        } else {\n          var update = false;\n\n          if (this.camera.near != this._initialNear) {\n            this.camera.near = this._initialNear;\n            update = true;\n          }\n\n          if (this.camera.far != this._initialFar) {\n            this.camera.far = this._initialFar;\n            update = true;\n          }\n\n          if (update) {\n            this.camera.updateProjectionMatrix();\n          }\n        }\n      }\n    }\n    /**\n     * Calculate the angular speed\n     * @param {Number} p0 Position at t0\n     * @param {Number} p1 Position at t1\n     * @param {Number} t0 Initial time in milliseconds\n     * @param {Number} t1 Ending time in milliseconds\n     */\n\n    /**\n     * Set gizmos visibility\n     * @param {Boolean} value Value of gizmos visibility\n     */\n\n  }, {\n    key: \"setGizmosVisible\",\n    value: function setGizmosVisible(value) {\n      this._gizmos.visible = value;\n      this.dispatchEvent(_changeEvent);\n    }\n    /**\n     * Creates the rotation gizmos matching trackball center and radius\n     * @param {Vector3} tbCenter The trackball center\n     * @param {number} tbRadius The trackball radius\n     */\n\n    /**\n     * Set values in transformation object\n     * @param {Matrix4} camera Transformation to be applied to the camera\n     * @param {Matrix4} gizmos Transformation to be applied to gizmos\n     */\n\n  }, {\n    key: \"setTransformationMatrices\",\n    value: function setTransformationMatrices() {\n      var camera = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      var gizmos = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n      if (camera != null) {\n        if (_transformation.camera != null) {\n          _transformation.camera.copy(camera);\n        } else {\n          _transformation.camera = camera.clone();\n        }\n      } else {\n        _transformation.camera = null;\n      }\n\n      if (gizmos != null) {\n        if (_transformation.gizmos != null) {\n          _transformation.gizmos.copy(gizmos);\n        } else {\n          _transformation.gizmos = gizmos.clone();\n        }\n      } else {\n        _transformation.gizmos = null;\n      }\n    }\n    /**\n     * Rotate camera around its direction axis passing by a given point by a given angle\n     * @param {Vector3} point The point where the rotation axis is passing trough\n     * @param {Number} angle Angle in radians\n     * @returns The computed transormation matix\n     */\n\n  }]);\n\n  return ArcballControls;\n}(EventDispatcher);\n\nexport { ArcballControls };","map":{"version":3,"sources":["/Users/jak/repos/karen/bestservedbold-christmas-baubles/node_modules/three-stdlib/controls/ArcballControls.js"],"names":["_defineProperty","Matrix4","EventDispatcher","EllipseCurve","BufferGeometry","Mesh","PerspectiveCamera","MathUtils","OrthographicCamera","Vector3","GridHelper","LineBasicMaterial","Line","Raycaster","Vector2","Quaternion","Group","Box3","Sphere","STATE","IDLE","Symbol","ROTATE","PAN","SCALE","FOV","FOCUS","ZROTATE","TOUCH_MULTI","ANIMATION_FOCUS","ANIMATION_ROTATE","INPUT","NONE","ONE_FINGER","ONE_FINGER_SWITCHED","TWO_FINGER","MULT_FINGER","CURSOR","_center","x","y","_transformation","camera","gizmos","_changeEvent","type","_startEvent","_endEvent","ArcballControls","_camera","domElement","scene","scale","_gizmos","z","tbRadius","calculateTbRadius","undefined","_tbRadius","newRadius","curve","points","getPoints","_curvePts","curveGeometry","setFromPoints","gizmo","children","child","geometry","dispatchEvent","event","enabled","i","mouseActions","length","mouse","preventDefault","_touchStart","splice","_touchCurrent","_input","button","isPrimary","_downValid","_downEvents","push","_downStart","performance","now","pointerType","onSinglePanStart","window","addEventListener","onPointerMove","onPointerUp","onRotateStart","onPinchStart","onDoublePanStart","onTriplePanStart","modifier","ctrlKey","metaKey","shiftKey","_mouseOp","getOpFromAction","_button","updateTouchEvent","onSinglePanMove","movement","calculatePointersDistance","_devPxRatio","_switchSensibility","onRotateMove","onPinchMove","onDoublePanMove","onTriplePanMove","mouseOpState","getOpStateFromAction","_movementThreshold","nTouch","pointerId","removeEventListener","onSinglePanEnd","onDoublePanEnd","onPinchEnd","onRotateEnd","onTriplePanEnd","downTime","timeStamp","_maxDownTime","_nclicks","_clickStart","clickInterval","_maxInterval","_posThreshold","onDoubleTap","shift","enableZoom","mouseOp","notchDeltaY","sgn","deltaY","size","scaleFactor","updateTbState","Math","pow","cursorZoom","enablePan","scalePoint","isOrthographicCamera","_this$unprojectOnTbPl","unprojectOnTbPlane","clientX","clientY","applyQuaternion","quaternion","multiplyScalar","zoom","add","position","isPerspectiveCamera","_this$unprojectOnTbPl2","applyTransformMatrix","applyScale","_grid","disposeGrid","drawGrid","deltaX","_v3_1","setFromMatrixPosition","_cameraMatrixState","distanceTo","xNew","clamp","minDistance","maxDistance","tan","DEG2RAD","fov","newFov","RAD2DEG","atan","maxFov","minFov","newDistance","setFov","key","copyState","pasteState","operation","setCenter","_animationId","cancelAnimationFrame","_timeStart","activateGizmos","rayDir","_startCursorPosition","copy","enableGrid","enableRotate","unprojectOnTbSurface","enableAnimations","_timePrev","_timeCurrent","_angleCurrent","_anglePrev","_cursorPosPrev","_cursorPosCurr","_wCurr","_wPrev","setY","getCursorNDC","_currentCursorPosition","opState","restart","_state","pan","distance","angle","angleTo","amount","max","rotate","calculateRotationAxis","calculateAngularSpeed","screenNotches","_fovState","_v3_2","_gizmoMatrixState","direction","clone","sub","normalize","_m4_1","makeTranslation","deltaTime","w","abs","self","requestAnimationFrame","t","rotationAxis","onRotationAnim","min","wMax","hitP","unprojectOnObj","onFocusAnim","focus","_this$camera","_startFingerRotation","getAngle","_currentFingerRotation","getWorldDirection","_rotationAxis","rotationPoint","_this$unprojectOnTbPl3","zRotate","_startFingerDistance","_currentFingerDistance","_this$unprojectOnTbPl4","_this$unprojectOnTbPl5","nFingers","setMouseAction","action1","action2","operationInput","mouseInput","keyInput","state","includes","action","p1","p2","atan2","PI","p0","t0","t1","s","sqrt","vec1","vec2","_rotationMatrix","extractRotation","_quat","setFromRotationMatrix","crossVectors","factor","halfFovV","halfFovH","aspect","top","right","point","focusPoint","_translationMatrix","gizmoStateTemp","premultiply","decompose","cameraStateTemp","color","multiplier","divisions","maxLength","tick","width","left","height","bottom","_gridPosition","rotateX","_this$scene","onPointerDown","onPointerCancel","onWheel","onContextMenu","onWindowResize","onKeyDown","remove","isActive","gizmoX","gizmoY","gizmoZ","material","setValues","opacity","cursorX","cursorY","canvas","canvasRect","getBoundingClientRect","_v2_1","setX","lookAt","target","updateMatrix","_fov0","_cameraMatrixState0","matrix","_cameraProjectionState","projectionMatrix","_zoom0","_zoomState","_initialNear","near","_nearPos0","_nearPos","_initialFar","far","_farPos0","_farPos","_up0","up","_upState","updateProjectionMatrix","makeGizmos","tbCenter","curveMaterialX","fog","transparent","curveMaterialY","curveMaterialZ","rotation","_gizmoMatrixState0","identity","setPosition","_scaleMatrix","makeScale","clear","time","cameraMatrix","gizmoMatrix","animTime","focusAnimationTime","easeOutCubic","w0","dampingFactor","adjust","distanceFactor","set","setTransformationMatrices","axis","makeRotationAxis","multiply","JSON","stringify","arcballState","cameraFar","cameraNear","cameraUp","cameraZoom","cameraFov","navigator","clipboard","writeText","readText","then","resolved","value","setStateFromJSON","scaleGizmos","sizeInverse","maxZoom","minZoom","_m4_2","pos","applyAxisAngle","cursor","raycaster","setFromCamera","intersect","intersectObjects","object","uuid","face","getCursorPosition","x2","y2","r2","setZ","applyMatrix4","projectionMatrixInverse","cameraGizmoDistance","radius2","h","l","m","q","a","b","c","delta","rayLength","initialDistance","newState","updateMatrices","updateMatrixState","_this$camera2","EPS","equals","_currentTarget","newZoom","oldRadius","json","parse","fromArray","elements","gizmoTmp","adjustNearFar","enableGizmos","Infinity","setCamera","style","touchAction","devicePixelRatio","initializeMouseActions","transformation","cameraDistance","bb","setFromObject","sphere","getBoundingSphere","adjustedNearPosition","radius","center","regularNearPosition","minNearPos","adjustedFarPosition","regularFarPosition","minFarPos","update","visible"],"mappings":";;;;;AAAA,OAAOA,eAAP,MAA4B,2CAA5B;AACA,SAASC,OAAT,EAAkBC,eAAlB,EAAmCC,YAAnC,EAAiDC,cAAjD,EAAiEC,IAAjE,EAAuEC,iBAAvE,EAA0FC,SAA1F,EAAqGC,kBAArG,EAAyHC,OAAzH,EAAkIC,UAAlI,EAA8IC,iBAA9I,EAAiKC,IAAjK,EAAuKC,SAAvK,EAAkLC,OAAlL,EAA2LC,UAA3L,EAAuMC,KAAvM,EAA8MC,IAA9M,EAAoNC,MAApN,QAAkO,OAAlO,C,CAEA;;AACA,IAAMC,KAAK,GAAG;AACZC,EAAAA,IAAI,EAAEC,MAAM,EADA;AAEZC,EAAAA,MAAM,EAAED,MAAM,EAFF;AAGZE,EAAAA,GAAG,EAAEF,MAAM,EAHC;AAIZG,EAAAA,KAAK,EAAEH,MAAM,EAJD;AAKZI,EAAAA,GAAG,EAAEJ,MAAM,EALC;AAMZK,EAAAA,KAAK,EAAEL,MAAM,EAND;AAOZM,EAAAA,OAAO,EAAEN,MAAM,EAPH;AAQZO,EAAAA,WAAW,EAAEP,MAAM,EARP;AASZQ,EAAAA,eAAe,EAAER,MAAM,EATX;AAUZS,EAAAA,gBAAgB,EAAET,MAAM;AAVZ,CAAd;AAYA,IAAMU,KAAK,GAAG;AACZC,EAAAA,IAAI,EAAEX,MAAM,EADA;AAEZY,EAAAA,UAAU,EAAEZ,MAAM,EAFN;AAGZa,EAAAA,mBAAmB,EAAEb,MAAM,EAHf;AAIZc,EAAAA,UAAU,EAAEd,MAAM,EAJN;AAKZe,EAAAA,WAAW,EAAEf,MAAM,EALP;AAMZgB,EAAAA,MAAM,EAAEhB,MAAM;AANF,CAAd,C,CAOG;;AAEH,IAAMiB,OAAO,GAAG;AACdC,EAAAA,CAAC,EAAE,CADW;AAEdC,EAAAA,CAAC,EAAE;AAFW,CAAhB,C,CAGG;;AAEH,IAAMC,eAAe,GAAG;AACtBC,EAAAA,MAAM,EAAE,IAAIzC,OAAJ,EADc;AAEtB0C,EAAAA,MAAM,EAAE,IAAI1C,OAAJ;AAFc,CAAxB,C,CAGG;;AAEH,IAAM2C,YAAY,GAAG;AACnBC,EAAAA,IAAI,EAAE;AADa,CAArB;AAGA,IAAMC,WAAW,GAAG;AAClBD,EAAAA,IAAI,EAAE;AADY,CAApB;AAGA,IAAME,SAAS,GAAG;AAChBF,EAAAA,IAAI,EAAE;AADU,CAAlB;AAGA;AACA;AACA;AACA;AACA;AACA;;IAEMG,e;;;;;AACJ,2BAAYC,OAAZ,EAAqBC,UAArB,EAA+C;AAAA;;AAAA,QAAdC,KAAc,uEAAN,IAAM;;AAAA;;AAC7C;;AAEAnD,IAAAA,eAAe,gCAAO,QAAP,EAAiB,KAAK,CAAtB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,YAAP,EAAqB,KAAK,CAA1B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,OAAP,EAAgB,KAAK,CAArB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,cAAP,EAAuB,KAAK,CAA5B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,UAAP,EAAmB,KAAK,CAAxB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,OAAP,EAAgB,KAAK,CAArB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,OAAP,EAAgB,KAAK,CAArB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,OAAP,EAAgB,KAAK,CAArB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,OAAP,EAAgB,KAAK,CAArB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,OAAP,EAAgB,KAAK,CAArB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,OAAP,EAAgB,KAAK,CAArB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,oBAAP,EAA6B,KAAK,CAAlC,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,iBAAP,EAA0B,KAAK,CAA/B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,cAAP,EAAuB,KAAK,CAA5B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,eAAP,EAAwB,KAAK,CAA7B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,oBAAP,EAA6B,KAAK,CAAlC,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,wBAAP,EAAiC,KAAK,CAAtC,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,WAAP,EAAoB,KAAK,CAAzB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,UAAP,EAAmB,KAAK,CAAxB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,YAAP,EAAqB,KAAK,CAA1B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,UAAP,EAAmB,KAAK,CAAxB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,SAAP,EAAkB,KAAK,CAAvB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,mBAAP,EAA4B,KAAK,CAAjC,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,MAAP,EAAe,KAAK,CAApB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,QAAP,EAAiB,KAAK,CAAtB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,OAAP,EAAgB,KAAK,CAArB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,cAAP,EAAuB,KAAK,CAA5B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,WAAP,EAAoB,KAAK,CAAzB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,aAAP,EAAsB,KAAK,CAA3B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,UAAP,EAAmB,KAAK,CAAxB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,qBAAP,EAA8B,KAAK,CAAnC,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,oBAAP,EAA6B,KAAK,CAAlC,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,SAAP,EAAkB,KAAK,CAAvB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,aAAP,EAAsB,KAAK,CAA3B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,eAAP,EAAwB,KAAK,CAA7B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,QAAP,EAAiB,KAAK,CAAtB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,oBAAP,EAA6B,KAAK,CAAlC,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,sBAAP,EAA+B,KAAK,CAApC,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,wBAAP,EAAiC,KAAK,CAAtC,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,sBAAP,EAA+B,KAAK,CAApC,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,wBAAP,EAAiC,KAAK,CAAtC,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,aAAP,EAAsB,KAAK,CAA3B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,YAAP,EAAqB,KAAK,CAA1B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,UAAP,EAAmB,KAAK,CAAxB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,aAAP,EAAsB,KAAK,CAA3B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,YAAP,EAAqB,KAAK,CAA1B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,aAAP,EAAsB,KAAK,CAA3B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,cAAP,EAAuB,KAAK,CAA5B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,cAAP,EAAuB,KAAK,CAA5B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,eAAP,EAAwB,KAAK,CAA7B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,oBAAP,EAA6B,KAAK,CAAlC,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,wBAAP,EAAiC,KAAK,CAAtC,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,sBAAP,EAA+B,KAAK,CAApC,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,OAAP,EAAgB,KAAK,CAArB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,eAAP,EAAwB,KAAK,CAA7B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,SAAP,EAAkB,KAAK,CAAvB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,WAAP,EAAoB,KAAK,CAAzB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,YAAP,EAAqB,KAAK,CAA1B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,cAAP,EAAuB,KAAK,CAA5B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,oBAAP,EAA6B,KAAK,CAAlC,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,WAAP,EAAoB,KAAK,CAAzB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,cAAP,EAAuB,KAAK,CAA5B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,YAAP,EAAqB,KAAK,CAA1B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,eAAP,EAAwB,KAAK,CAA7B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,gBAAP,EAAyB,KAAK,CAA9B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,gBAAP,EAAyB,KAAK,CAA9B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,QAAP,EAAiB,KAAK,CAAtB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,QAAP,EAAiB,KAAK,CAAtB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,eAAP,EAAwB,KAAK,CAA7B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,aAAP,EAAsB,KAAK,CAA3B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,eAAP,EAAwB,KAAK,CAA7B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,MAAP,EAAe,KAAK,CAApB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,kBAAP,EAA2B,KAAK,CAAhC,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,YAAP,EAAqB,KAAK,CAA1B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,YAAP,EAAqB,KAAK,CAA1B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,QAAP,EAAiB,KAAK,CAAtB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,QAAP,EAAiB,KAAK,CAAtB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,SAAP,EAAkB,KAAK,CAAvB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,WAAP,EAAoB,KAAK,CAAzB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,cAAP,EAAuB,KAAK,CAA5B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,YAAP,EAAqB,KAAK,CAA1B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,cAAP,EAAuB,KAAK,CAA5B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,aAAP,EAAsB,KAAK,CAA3B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,aAAP,EAAsB,KAAK,CAA3B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,SAAP,EAAkB,KAAK,CAAvB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,SAAP,EAAkB,KAAK,CAAvB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,QAAP,EAAiB,KAAK,CAAtB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,gBAAP,EAAyB,KAAK,CAA9B,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,WAAP,EAAoB,KAAK,CAAzB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,QAAP,EAAiB,KAAK,CAAtB,CAAf;;AAEAA,IAAAA,eAAe,gCAAO,gBAAP,EAAyB,YAAM;AAC5C,UAAMoD,KAAK,GAAG,CAAC,MAAKC,OAAL,CAAaD,KAAb,CAAmBb,CAAnB,GAAuB,MAAKc,OAAL,CAAaD,KAAb,CAAmBZ,CAA1C,GAA8C,MAAKa,OAAL,CAAaD,KAAb,CAAmBE,CAAlE,IAAuE,CAArF;;AAEA,UAAI,MAAKZ,MAAL,KAAgB,IAApB,EAA0B;AACxB,YAAMa,QAAQ,GAAG,MAAKC,iBAAL,CAAuB,MAAKd,MAA5B,CAAjB;;AAEA,YAAIa,QAAQ,KAAKE,SAAjB,EAA4B;AAC1B,gBAAKC,SAAL,GAAiBH,QAAjB;AACD;AACF;;AAED,UAAMI,SAAS,GAAG,MAAKD,SAAL,GAAiBN,KAAnC,CAX4C,CAWF;;AAE1C,UAAMQ,KAAK,GAAG,IAAIzD,YAAJ,CAAiB,CAAjB,EAAoB,CAApB,EAAuBwD,SAAvB,EAAkCA,SAAlC,CAAd;AACA,UAAME,MAAM,GAAGD,KAAK,CAACE,SAAN,CAAgB,MAAKC,SAArB,CAAf;AACA,UAAMC,aAAa,GAAG,IAAI5D,cAAJ,GAAqB6D,aAArB,CAAmCJ,MAAnC,CAAtB;;AAEA,WAAK,IAAMK,KAAX,IAAoB,MAAKb,OAAL,CAAac,QAAjC,EAA2C;AACzC,YAAMC,KAAK,GAAG,MAAKf,OAAL,CAAac,QAAb,CAAsBD,KAAtB,CAAd;;AAEA,YAAIE,KAAK,YAAY/D,IAArB,EAA2B;AACzB+D,UAAAA,KAAK,CAACC,QAAN,GAAiBL,aAAjB;AACD;AACF;;AAED,YAAKM,aAAL,CAAmB1B,YAAnB;AACD,KA1Bc,CAAf;;AA4BA5C,IAAAA,eAAe,gCAAO,eAAP,EAAwB,UAAAuE,KAAK,EAAI;AAC9C,UAAI,CAAC,MAAKC,OAAV,EAAmB;AACjB;AACD;;AAED,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,MAAKC,YAAL,CAAkBC,MAAtC,EAA8CF,CAAC,EAA/C,EAAmD;AACjD,YAAI,MAAKC,YAAL,CAAkBD,CAAlB,EAAqBG,KAArB,IAA8B,CAAlC,EAAqC;AACnC;AACAL,UAAAA,KAAK,CAACM,cAAN;AACA;AACD;AACF;AACF,KAZc,CAAf;;AAcA7E,IAAAA,eAAe,gCAAO,iBAAP,EAA0B,YAAM;AAC7C,YAAK8E,WAAL,CAAiBC,MAAjB,CAAwB,CAAxB,EAA2B,MAAKD,WAAL,CAAiBH,MAA5C;;AAEA,YAAKK,aAAL,CAAmBD,MAAnB,CAA0B,CAA1B,EAA6B,MAAKC,aAAL,CAAmBL,MAAhD;;AAEA,YAAKM,MAAL,GAAclD,KAAK,CAACC,IAApB;AACD,KANc,CAAf;;AAQAhC,IAAAA,eAAe,gCAAO,eAAP,EAAwB,UAAAuE,KAAK,EAAI;AAC9C,UAAIA,KAAK,CAACW,MAAN,IAAgB,CAAhB,IAAqBX,KAAK,CAACY,SAA/B,EAA0C;AACxC,cAAKC,UAAL,GAAkB,IAAlB;;AAEA,cAAKC,WAAL,CAAiBC,IAAjB,CAAsBf,KAAtB;;AAEA,cAAKgB,UAAL,GAAkBC,WAAW,CAACC,GAAZ,EAAlB;AACD,OAND,MAMO;AACL,cAAKL,UAAL,GAAkB,KAAlB;AACD;;AAED,UAAIb,KAAK,CAACmB,WAAN,IAAqB,OAArB,IAAgC,MAAKT,MAAL,IAAelD,KAAK,CAACM,MAAzD,EAAiE;AAC/D,cAAKyC,WAAL,CAAiBQ,IAAjB,CAAsBf,KAAtB;;AAEA,cAAKS,aAAL,CAAmBM,IAAnB,CAAwBf,KAAxB;;AAEA,gBAAQ,MAAKU,MAAb;AACE,eAAKlD,KAAK,CAACC,IAAX;AACE;AACA,kBAAKiD,MAAL,GAAclD,KAAK,CAACE,UAApB;;AACA,kBAAK0D,gBAAL,CAAsBpB,KAAtB,EAA6B,QAA7B;;AACAqB,YAAAA,MAAM,CAACC,gBAAP,CAAwB,aAAxB,EAAuC,MAAKC,aAA5C;AACAF,YAAAA,MAAM,CAACC,gBAAP,CAAwB,WAAxB,EAAqC,MAAKE,WAA1C;AACA;;AAEF,eAAKhE,KAAK,CAACE,UAAX;AACA,eAAKF,KAAK,CAACG,mBAAX;AACE;AACA,kBAAK+C,MAAL,GAAclD,KAAK,CAACI,UAApB;;AACA,kBAAK6D,aAAL;;AACA,kBAAKC,YAAL;;AACA,kBAAKC,gBAAL;;AACA;;AAEF,eAAKnE,KAAK,CAACI,UAAX;AACE;AACA,kBAAK8C,MAAL,GAAclD,KAAK,CAACK,WAApB;;AACA,kBAAK+D,gBAAL;;AACA;AAtBJ;AAwBD,OA7BD,MA6BO,IAAI5B,KAAK,CAACmB,WAAN,IAAqB,OAArB,IAAgC,MAAKT,MAAL,IAAelD,KAAK,CAACC,IAAzD,EAA+D;AACpE,YAAIoE,QAAQ,GAAG,IAAf;;AAEA,YAAI7B,KAAK,CAAC8B,OAAN,IAAiB9B,KAAK,CAAC+B,OAA3B,EAAoC;AAClCF,UAAAA,QAAQ,GAAG,MAAX;AACD,SAFD,MAEO,IAAI7B,KAAK,CAACgC,QAAV,EAAoB;AACzBH,UAAAA,QAAQ,GAAG,OAAX;AACD;;AAED,cAAKI,QAAL,GAAgB,MAAKC,eAAL,CAAqBlC,KAAK,CAACW,MAA3B,EAAmCkB,QAAnC,CAAhB;;AAEA,YAAI,MAAKI,QAAL,IAAiB,IAArB,EAA2B;AACzBZ,UAAAA,MAAM,CAACC,gBAAP,CAAwB,aAAxB,EAAuC,MAAKC,aAA5C;AACAF,UAAAA,MAAM,CAACC,gBAAP,CAAwB,WAAxB,EAAqC,MAAKE,WAA1C,EAFyB,CAE+B;;AAExD,gBAAKd,MAAL,GAAclD,KAAK,CAACM,MAApB;AACA,gBAAKqE,OAAL,GAAenC,KAAK,CAACW,MAArB;;AACA,gBAAKS,gBAAL,CAAsBpB,KAAtB,EAA6B,MAAKiC,QAAlC;AACD;AACF;AACF,KA5Dc,CAAf;;AA8DAxG,IAAAA,eAAe,gCAAO,eAAP,EAAwB,UAAAuE,KAAK,EAAI;AAC9C,UAAIA,KAAK,CAACmB,WAAN,IAAqB,OAArB,IAAgC,MAAKT,MAAL,IAAelD,KAAK,CAACM,MAAzD,EAAiE;AAC/D,gBAAQ,MAAK4C,MAAb;AACE,eAAKlD,KAAK,CAACE,UAAX;AACE;AACA,kBAAK0E,gBAAL,CAAsBpC,KAAtB;;AACA,kBAAKqC,eAAL,CAAqBrC,KAArB,EAA4BpD,KAAK,CAACG,MAAlC;;AACA;;AAEF,eAAKS,KAAK,CAACG,mBAAX;AACE,gBAAM2E,QAAQ,GAAG,MAAKC,yBAAL,CAA+B,MAAK9B,aAAL,CAAmB,CAAnB,CAA/B,EAAsDT,KAAtD,IAA+D,MAAKwC,WAArF;;AAEA,gBAAIF,QAAQ,IAAI,MAAKG,kBAArB,EAAyC;AACvC;AACA,oBAAK/B,MAAL,GAAclD,KAAK,CAACE,UAApB;;AACA,oBAAK0E,gBAAL,CAAsBpC,KAAtB;;AACA,oBAAKoB,gBAAL,CAAsBpB,KAAtB,EAA6B,QAA7B;;AACA;AACD;;AAED;;AAEF,eAAKxC,KAAK,CAACI,UAAX;AACE;AACA,kBAAKwE,gBAAL,CAAsBpC,KAAtB;;AACA,kBAAK0C,YAAL;;AACA,kBAAKC,WAAL;;AACA,kBAAKC,eAAL;;AACA;;AAEF,eAAKpF,KAAK,CAACK,WAAX;AACE;AACA,kBAAKuE,gBAAL,CAAsBpC,KAAtB;;AACA,kBAAK6C,eAAL;;AACA;AAhCJ;AAkCD,OAnCD,MAmCO,IAAI7C,KAAK,CAACmB,WAAN,IAAqB,OAArB,IAAgC,MAAKT,MAAL,IAAelD,KAAK,CAACM,MAAzD,EAAiE;AACtE,YAAI+D,QAAQ,GAAG,IAAf;;AAEA,YAAI7B,KAAK,CAAC8B,OAAN,IAAiB9B,KAAK,CAAC+B,OAA3B,EAAoC;AAClCF,UAAAA,QAAQ,GAAG,MAAX;AACD,SAFD,MAEO,IAAI7B,KAAK,CAACgC,QAAV,EAAoB;AACzBH,UAAAA,QAAQ,GAAG,OAAX;AACD;;AAED,YAAMiB,YAAY,GAAG,MAAKC,oBAAL,CAA0B,MAAKZ,OAA/B,EAAwCN,QAAxC,CAArB;;AAEA,YAAIiB,YAAY,IAAI,IAApB,EAA0B;AACxB,gBAAKT,eAAL,CAAqBrC,KAArB,EAA4B8C,YAA5B;AACD;AACF,OAlD6C,CAkD5C;;;AAGF,UAAI,MAAKjC,UAAT,EAAqB;AACnB,YAAMyB,SAAQ,GAAG,MAAKC,yBAAL,CAA+B,MAAKzB,WAAL,CAAiB,MAAKA,WAAL,CAAiBV,MAAjB,GAA0B,CAA3C,CAA/B,EAA8EJ,KAA9E,IAAuF,MAAKwC,WAA7G;;AAEA,YAAIF,SAAQ,GAAG,MAAKU,kBAApB,EAAwC;AACtC,gBAAKnC,UAAL,GAAkB,KAAlB;AACD;AACF;AACF,KA5Dc,CAAf;;AA8DApF,IAAAA,eAAe,gCAAO,aAAP,EAAsB,UAAAuE,KAAK,EAAI;AAC5C,UAAIA,KAAK,CAACmB,WAAN,IAAqB,OAArB,IAAgC,MAAKT,MAAL,IAAelD,KAAK,CAACM,MAAzD,EAAiE;AAC/D,YAAMmF,MAAM,GAAG,MAAKxC,aAAL,CAAmBL,MAAlC;;AAEA,aAAK,IAAIF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+C,MAApB,EAA4B/C,CAAC,EAA7B,EAAiC;AAC/B,cAAI,MAAKO,aAAL,CAAmBP,CAAnB,EAAsBgD,SAAtB,IAAmClD,KAAK,CAACkD,SAA7C,EAAwD;AACtD,kBAAKzC,aAAL,CAAmBD,MAAnB,CAA0BN,CAA1B,EAA6B,CAA7B;;AAEA,kBAAKK,WAAL,CAAiBC,MAAjB,CAAwBN,CAAxB,EAA2B,CAA3B;;AAEA;AACD;AACF;;AAED,gBAAQ,MAAKQ,MAAb;AACE,eAAKlD,KAAK,CAACE,UAAX;AACA,eAAKF,KAAK,CAACG,mBAAX;AACE;AACA0D,YAAAA,MAAM,CAAC8B,mBAAP,CAA2B,aAA3B,EAA0C,MAAK5B,aAA/C;AACAF,YAAAA,MAAM,CAAC8B,mBAAP,CAA2B,WAA3B,EAAwC,MAAK3B,WAA7C;AACA,kBAAKd,MAAL,GAAclD,KAAK,CAACC,IAApB;;AACA,kBAAK2F,cAAL;;AACA;;AAEF,eAAK5F,KAAK,CAACI,UAAX;AACE;AACA,kBAAKyF,cAAL;;AACA,kBAAKC,UAAL;;AACA,kBAAKC,WAAL,GAJF,CAIsB;;;AAEpB,kBAAK7C,MAAL,GAAclD,KAAK,CAACG,mBAApB;AACA;;AAEF,eAAKH,KAAK,CAACK,WAAX;AACE,gBAAI,MAAK4C,aAAL,CAAmBL,MAAnB,IAA6B,CAAjC,EAAoC;AAClCiB,cAAAA,MAAM,CAAC8B,mBAAP,CAA2B,aAA3B,EAA0C,MAAK5B,aAA/C;AACAF,cAAAA,MAAM,CAAC8B,mBAAP,CAA2B,WAA3B,EAAwC,MAAK3B,WAA7C,EAFkC,CAEyB;;AAE3D,oBAAKd,MAAL,GAAclD,KAAK,CAACC,IAApB;;AACA,oBAAK+F,cAAL;AACD;;AAED;AA5BJ;AA8BD,OA3CD,MA2CO,IAAIxD,KAAK,CAACmB,WAAN,IAAqB,OAArB,IAAgC,MAAKT,MAAL,IAAelD,KAAK,CAACM,MAAzD,EAAiE;AACtEuD,QAAAA,MAAM,CAAC8B,mBAAP,CAA2B,aAA3B,EAA0C,MAAK5B,aAA/C;AACAF,QAAAA,MAAM,CAAC8B,mBAAP,CAA2B,WAA3B,EAAwC,MAAK3B,WAA7C;AACA,cAAKd,MAAL,GAAclD,KAAK,CAACC,IAApB;;AACA,cAAK2F,cAAL;;AACA,cAAKjB,OAAL,GAAe,CAAC,CAAhB;AACD;;AAED,UAAInC,KAAK,CAACY,SAAV,EAAqB;AACnB,YAAI,MAAKC,UAAT,EAAqB;AACnB,cAAM4C,QAAQ,GAAGzD,KAAK,CAAC0D,SAAN,GAAkB,MAAK5C,WAAL,CAAiB,MAAKA,WAAL,CAAiBV,MAAjB,GAA0B,CAA3C,EAA8CsD,SAAjF;;AAEA,cAAID,QAAQ,IAAI,MAAKE,YAArB,EAAmC;AACjC,gBAAI,MAAKC,QAAL,IAAiB,CAArB,EAAwB;AACtB;AACA,oBAAKA,QAAL,GAAgB,CAAhB;AACA,oBAAKC,WAAL,GAAmB5C,WAAW,CAACC,GAAZ,EAAnB;AACD,aAJD,MAIO;AACL,kBAAM4C,aAAa,GAAG9D,KAAK,CAAC0D,SAAN,GAAkB,MAAKG,WAA7C;;AAEA,kBAAMvB,QAAQ,GAAG,MAAKC,yBAAL,CAA+B,MAAKzB,WAAL,CAAiB,CAAjB,CAA/B,EAAoD,MAAKA,WAAL,CAAiB,CAAjB,CAApD,IAA2E,MAAK0B,WAAjG;;AAEA,kBAAIsB,aAAa,IAAI,MAAKC,YAAtB,IAAsCzB,QAAQ,IAAI,MAAK0B,aAA3D,EAA0E;AACxE;AACA;AACA,sBAAKJ,QAAL,GAAgB,CAAhB;;AAEA,sBAAK9C,WAAL,CAAiBN,MAAjB,CAAwB,CAAxB,EAA2B,MAAKM,WAAL,CAAiBV,MAA5C;;AAEA,sBAAK6D,WAAL,CAAiBjE,KAAjB;AACD,eARD,MAQO;AACL;AACA,sBAAK4D,QAAL,GAAgB,CAAhB;;AAEA,sBAAK9C,WAAL,CAAiBoD,KAAjB;;AAEA,sBAAKL,WAAL,GAAmB5C,WAAW,CAACC,GAAZ,EAAnB;AACD;AACF;AACF,WA3BD,MA2BO;AACL,kBAAKL,UAAL,GAAkB,KAAlB;AACA,kBAAK+C,QAAL,GAAgB,CAAhB;;AAEA,kBAAK9C,WAAL,CAAiBN,MAAjB,CAAwB,CAAxB,EAA2B,MAAKM,WAAL,CAAiBV,MAA5C;AACD;AACF,SApCD,MAoCO;AACL,gBAAKwD,QAAL,GAAgB,CAAhB;;AAEA,gBAAK9C,WAAL,CAAiBN,MAAjB,CAAwB,CAAxB,EAA2B,MAAKM,WAAL,CAAiBV,MAA5C;AACD;AACF;AACF,KA/Fc,CAAf;;AAiGA3E,IAAAA,eAAe,gCAAO,SAAP,EAAkB,UAAAuE,KAAK,EAAI;AACxC,UAAI,MAAKC,OAAL,IAAgB,MAAKkE,UAAzB,EAAqC;AACnC,YAAItC,QAAQ,GAAG,IAAf;;AAEA,YAAI7B,KAAK,CAAC8B,OAAN,IAAiB9B,KAAK,CAAC+B,OAA3B,EAAoC;AAClCF,UAAAA,QAAQ,GAAG,MAAX;AACD,SAFD,MAEO,IAAI7B,KAAK,CAACgC,QAAV,EAAoB;AACzBH,UAAAA,QAAQ,GAAG,OAAX;AACD;;AAED,YAAMuC,OAAO,GAAG,MAAKlC,eAAL,CAAqB,OAArB,EAA8BL,QAA9B,CAAhB;;AAEA,YAAIuC,OAAO,IAAI,IAAf,EAAqB;AACnBpE,UAAAA,KAAK,CAACM,cAAN;;AACA,gBAAKP,aAAL,CAAmBxB,WAAnB;;AACA,cAAM8F,WAAW,GAAG,GAApB,CAHmB,CAGM;;AAEzB,cAAIC,GAAG,GAAGtE,KAAK,CAACuE,MAAN,GAAeF,WAAzB;AACA,cAAIG,IAAI,GAAG,CAAX;;AAEA,cAAIF,GAAG,GAAG,CAAV,EAAa;AACXE,YAAAA,IAAI,GAAG,IAAI,MAAKC,WAAhB;AACD,WAFD,MAEO,IAAIH,GAAG,GAAG,CAAV,EAAa;AAClBE,YAAAA,IAAI,GAAG,MAAKC,WAAZ;AACD;;AAED,kBAAQL,OAAR;AACE,iBAAK,MAAL;AACE,oBAAKM,aAAL,CAAmB9H,KAAK,CAACK,KAAzB,EAAgC,IAAhC;;AAEA,kBAAIqH,GAAG,GAAG,CAAV,EAAa;AACXE,gBAAAA,IAAI,GAAG,IAAIG,IAAI,CAACC,GAAL,CAAS,MAAKH,WAAd,EAA2BH,GAA3B,CAAX;AACD,eAFD,MAEO,IAAIA,GAAG,GAAG,CAAV,EAAa;AAClBE,gBAAAA,IAAI,GAAGG,IAAI,CAACC,GAAL,CAAS,MAAKH,WAAd,EAA2B,CAACH,GAA5B,CAAP;AACD;;AAED,kBAAI,MAAKO,UAAL,IAAmB,MAAKC,SAA5B,EAAuC;AACrC,oBAAIC,UAAJ;;AAEA,oBAAI,MAAK5G,MAAL,YAAuBlC,kBAAvB,IAA6C,MAAKkC,MAAL,CAAY6G,oBAA7D,EAAmF;AACjF,sBAAIC,qBAAJ;;AAEAF,kBAAAA,UAAU,GAAG,CAACE,qBAAqB,GAAG,MAAKC,kBAAL,CAAwB,MAAK/G,MAA7B,EAAqC6B,KAAK,CAACmF,OAA3C,EAAoDnF,KAAK,CAACoF,OAA1D,EAAmE,MAAKzG,UAAxE,CAAzB,MAAkH,IAAlH,IAA0HsG,qBAAqB,KAAK,KAAK,CAAzJ,GAA6J,KAAK,CAAlK,GAAsKA,qBAAqB,CAACI,eAAtB,CAAsC,MAAKlH,MAAL,CAAYmH,UAAlD,EAA8DC,cAA9D,CAA6E,IAAI,MAAKpH,MAAL,CAAYqH,IAA7F,EAAmGC,GAAnG,CAAuG,MAAK3G,OAAL,CAAa4G,QAApH,CAAnL;AACD,iBAJD,MAIO,IAAI,MAAKvH,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,CAAYwH,mBAA5D,EAAiF;AACtF,sBAAIC,sBAAJ;;AAEAb,kBAAAA,UAAU,GAAG,CAACa,sBAAsB,GAAG,MAAKV,kBAAL,CAAwB,MAAK/G,MAA7B,EAAqC6B,KAAK,CAACmF,OAA3C,EAAoDnF,KAAK,CAACoF,OAA1D,EAAmE,MAAKzG,UAAxE,CAA1B,MAAmH,IAAnH,IAA2HiH,sBAAsB,KAAK,KAAK,CAA3J,GAA+J,KAAK,CAApK,GAAwKA,sBAAsB,CAACP,eAAvB,CAAuC,MAAKlH,MAAL,CAAYmH,UAAnD,EAA+DG,GAA/D,CAAmE,MAAK3G,OAAL,CAAa4G,QAAhF,CAArL;AACD;;AAED,oBAAIX,UAAU,KAAK7F,SAAnB,EAA8B,MAAK2G,oBAAL,CAA0B,MAAKC,UAAL,CAAgBtB,IAAhB,EAAsBO,UAAtB,CAA1B;AAC/B,eAdD,MAcO;AACL,sBAAKc,oBAAL,CAA0B,MAAKC,UAAL,CAAgBtB,IAAhB,EAAsB,MAAK1F,OAAL,CAAa4G,QAAnC,CAA1B;AACD;;AAED,kBAAI,MAAKK,KAAL,IAAc,IAAlB,EAAwB;AACtB,sBAAKC,WAAL;;AACA,sBAAKC,QAAL;AACD;;AAED,oBAAKvB,aAAL,CAAmB9H,KAAK,CAACC,IAAzB,EAA+B,KAA/B;;AACA,oBAAKkD,aAAL,CAAmB1B,YAAnB;;AACA,oBAAK0B,aAAL,CAAmBvB,SAAnB;;AACA;;AAEF,iBAAK,KAAL;AACE,kBAAI,MAAKL,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,CAAYwH,mBAA5D,EAAiF;AAC/E,sBAAKjB,aAAL,CAAmB9H,KAAK,CAACM,GAAzB,EAA8B,IAA9B,EAD+E,CAC1C;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA,oBAAI8C,KAAK,CAACkG,MAAN,IAAgB,CAApB,EAAuB;AACrB5B,kBAAAA,GAAG,GAAGtE,KAAK,CAACkG,MAAN,GAAe7B,WAArB;AACAG,kBAAAA,IAAI,GAAG,CAAP;;AAEA,sBAAIF,GAAG,GAAG,CAAV,EAAa;AACXE,oBAAAA,IAAI,GAAG,IAAIG,IAAI,CAACC,GAAL,CAAS,MAAKH,WAAd,EAA2BH,GAA3B,CAAX;AACD,mBAFD,MAEO,IAAIA,GAAG,GAAG,CAAV,EAAa;AAClBE,oBAAAA,IAAI,GAAGG,IAAI,CAACC,GAAL,CAAS,MAAKH,WAAd,EAA2B,CAACH,GAA5B,CAAP;AACD;AACF;;AAED,sBAAK6B,KAAL,CAAWC,qBAAX,CAAiC,MAAKC,kBAAtC;;AAEA,oBAAMrI,CAAC,GAAG,MAAKmI,KAAL,CAAWG,UAAX,CAAsB,MAAKxH,OAAL,CAAa4G,QAAnC,CAAV;;AAEA,oBAAIa,IAAI,GAAGvI,CAAC,GAAGwG,IAAf,CA5B+E,CA4B1D;AACrB;;AAEA+B,gBAAAA,IAAI,GAAGvK,SAAS,CAACwK,KAAV,CAAgBD,IAAhB,EAAsB,MAAKE,WAA3B,EAAwC,MAAKC,WAA7C,CAAP;AACA,oBAAMzI,CAAC,GAAGD,CAAC,GAAG2G,IAAI,CAACgC,GAAL,CAAS3K,SAAS,CAAC4K,OAAV,GAAoB,MAAKzI,MAAL,CAAY0I,GAAhC,GAAsC,GAA/C,CAAd,CAhC+E,CAgCZ;;AAEnE,oBAAIC,MAAM,GAAG9K,SAAS,CAAC+K,OAAV,IAAqBpC,IAAI,CAACqC,IAAL,CAAU/I,CAAC,GAAGsI,IAAd,IAAsB,CAA3C,CAAb,CAlC+E,CAkCnB;;AAE5D,oBAAIO,MAAM,GAAG,MAAKG,MAAlB,EAA0B;AACxBH,kBAAAA,MAAM,GAAG,MAAKG,MAAd;AACD,iBAFD,MAEO,IAAIH,MAAM,GAAG,MAAKI,MAAlB,EAA0B;AAC/BJ,kBAAAA,MAAM,GAAG,MAAKI,MAAd;AACD;;AAED,oBAAMC,WAAW,GAAGlJ,CAAC,GAAG0G,IAAI,CAACgC,GAAL,CAAS3K,SAAS,CAAC4K,OAAV,IAAqBE,MAAM,GAAG,CAA9B,CAAT,CAAxB;AACAtC,gBAAAA,IAAI,GAAGxG,CAAC,GAAGmJ,WAAX;;AACA,sBAAKC,MAAL,CAAYN,MAAZ;;AACA,sBAAKjB,oBAAL,CAA0B,MAAKC,UAAL,CAAgBtB,IAAhB,EAAsB,MAAK1F,OAAL,CAAa4G,QAAnC,EAA6C,KAA7C,CAA1B;AACD;;AAED,kBAAI,MAAKK,KAAL,IAAc,IAAlB,EAAwB;AACtB,sBAAKC,WAAL;;AACA,sBAAKC,QAAL;AACD;;AAED,oBAAKvB,aAAL,CAAmB9H,KAAK,CAACC,IAAzB,EAA+B,KAA/B;;AACA,oBAAKkD,aAAL,CAAmB1B,YAAnB;;AACA,oBAAK0B,aAAL,CAAmBvB,SAAnB;;AACA;AA/FJ;AAiGD;AACF;AACF,KA7Hc,CAAf;;AA+HA/C,IAAAA,eAAe,gCAAO,WAAP,EAAoB,UAAAuE,KAAK,EAAI;AAC1C,UAAIA,KAAK,CAACqH,GAAN,IAAa,GAAjB,EAAsB;AACpB,YAAIrH,KAAK,CAAC8B,OAAN,IAAiB9B,KAAK,CAAC+B,OAA3B,EAAoC;AAClC,gBAAKuF,SAAL;AACD;AACF,OAJD,MAIO,IAAItH,KAAK,CAACqH,GAAN,IAAa,GAAjB,EAAsB;AAC3B,YAAIrH,KAAK,CAAC8B,OAAN,IAAiB9B,KAAK,CAAC+B,OAA3B,EAAoC;AAClC,gBAAKwF,UAAL;AACD;AACF;AACF,KAVc,CAAf;;AAYA9L,IAAAA,eAAe,gCAAO,kBAAP,EAA2B,UAACuE,KAAD,EAAQwH,SAAR,EAAsB;AAC9D,UAAI,MAAKvH,OAAT,EAAkB;AAChB,cAAKF,aAAL,CAAmBxB,WAAnB;;AACA,cAAKkJ,SAAL,CAAezH,KAAK,CAACmF,OAArB,EAA8BnF,KAAK,CAACoF,OAApC;;AAEA,gBAAQoC,SAAR;AACE,eAAK,KAAL;AACE,gBAAI,CAAC,MAAK1C,SAAV,EAAqB;AACnB;AACD;;AAED,gBAAI,MAAK4C,YAAL,IAAqB,CAAC,CAA1B,EAA6B;AAC3BC,cAAAA,oBAAoB,CAAC,MAAKD,YAAN,CAApB;AACA,oBAAKA,YAAL,GAAoB,CAAC,CAArB;AACA,oBAAKE,UAAL,GAAkB,CAAC,CAAnB;;AACA,oBAAKC,cAAL,CAAoB,KAApB;;AACA,oBAAK9H,aAAL,CAAmB1B,YAAnB;AACD;;AAED,gBAAI,MAAKF,MAAL,KAAgB,IAApB,EAA0B;AACxB,oBAAKuG,aAAL,CAAmB9H,KAAK,CAACI,GAAzB,EAA8B,IAA9B;;AACA,kBAAM8K,MAAM,GAAG,MAAK5C,kBAAL,CAAwB,MAAK/G,MAA7B,EAAqCJ,OAAO,CAACC,CAA7C,EAAgDD,OAAO,CAACE,CAAxD,EAA2D,MAAKU,UAAhE,CAAf;;AAEA,kBAAImJ,MAAM,KAAK5I,SAAf,EAA0B;AACxB,sBAAK6I,oBAAL,CAA0BC,IAA1B,CAA+BF,MAA/B;AACD;;AAED,kBAAI,MAAKG,UAAT,EAAqB;AACnB,sBAAKhC,QAAL;;AACA,sBAAKlG,aAAL,CAAmB1B,YAAnB;AACD;AACF;;AAED;;AAEF,eAAK,QAAL;AACE,gBAAI,CAAC,MAAK6J,YAAV,EAAwB;AACtB;AACD;;AAED,gBAAI,MAAKR,YAAL,IAAqB,CAAC,CAA1B,EAA6B;AAC3BC,cAAAA,oBAAoB,CAAC,MAAKD,YAAN,CAApB;AACA,oBAAKA,YAAL,GAAoB,CAAC,CAArB;AACA,oBAAKE,UAAL,GAAkB,CAAC,CAAnB;AACD;;AAED,gBAAI,MAAKzJ,MAAL,KAAgB,IAApB,EAA0B;AACxB,oBAAKuG,aAAL,CAAmB9H,KAAK,CAACG,MAAzB,EAAiC,IAAjC;;AACA,kBAAM+K,OAAM,GAAG,MAAKK,oBAAL,CAA0B,MAAKhK,MAA/B,EAAuCJ,OAAO,CAACC,CAA/C,EAAkDD,OAAO,CAACE,CAA1D,EAA6D,MAAKU,UAAlE,EAA8E,MAAKQ,SAAnF,CAAf;;AAEA,kBAAI2I,OAAM,KAAK5I,SAAf,EAA0B;AACxB,sBAAK6I,oBAAL,CAA0BC,IAA1B,CAA+BF,OAA/B;AACD;;AAED,oBAAKD,cAAL,CAAoB,IAApB;;AAEA,kBAAI,MAAKO,gBAAT,EAA2B;AACzB,sBAAKC,SAAL,GAAiB,MAAKC,YAAL,GAAoBrH,WAAW,CAACC,GAAZ,EAArC;AACA,sBAAKqH,aAAL,GAAqB,MAAKC,UAAL,GAAkB,CAAvC;;AAEA,sBAAKC,cAAL,CAAoBT,IAApB,CAAyB,MAAKD,oBAA9B;;AAEA,sBAAKW,cAAL,CAAoBV,IAApB,CAAyB,MAAKS,cAA9B;;AAEA,sBAAKE,MAAL,GAAc,CAAd;AACA,sBAAKC,MAAL,GAAc,MAAKD,MAAnB;AACD;AACF;;AAED,kBAAK5I,aAAL,CAAmB1B,YAAnB;;AACA;;AAEF,eAAK,KAAL;AACE,gBAAI,EAAE,MAAKF,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,CAAYwH,mBAA1D,KAAkF,CAAC,MAAKxB,UAA5F,EAAwG;AACtG;AACD;;AAED,gBAAI,MAAKuD,YAAL,IAAqB,CAAC,CAA1B,EAA6B;AAC3BC,cAAAA,oBAAoB,CAAC,MAAKD,YAAN,CAApB;AACA,oBAAKA,YAAL,GAAoB,CAAC,CAArB;AACA,oBAAKE,UAAL,GAAkB,CAAC,CAAnB;;AACA,oBAAKC,cAAL,CAAoB,KAApB;;AACA,oBAAK9H,aAAL,CAAmB1B,YAAnB;AACD;;AAED,kBAAKqG,aAAL,CAAmB9H,KAAK,CAACM,GAAzB,EAA8B,IAA9B;;AAEA,kBAAK6K,oBAAL,CAA0Bc,IAA1B,CAA+B,MAAKC,YAAL,CAAkB/K,OAAO,CAACC,CAA1B,EAA6BD,OAAO,CAACE,CAArC,EAAwC,MAAKU,UAA7C,EAAyDV,CAAzD,GAA6D,GAA5F;;AAEA,kBAAK8K,sBAAL,CAA4Bf,IAA5B,CAAiC,MAAKD,oBAAtC;;AAEA;;AAEF,eAAK,MAAL;AACE,gBAAI,CAAC,MAAK5D,UAAV,EAAsB;AACpB;AACD;;AAED,gBAAI,MAAKuD,YAAL,IAAqB,CAAC,CAA1B,EAA6B;AAC3BC,cAAAA,oBAAoB,CAAC,MAAKD,YAAN,CAApB;AACA,oBAAKA,YAAL,GAAoB,CAAC,CAArB;AACA,oBAAKE,UAAL,GAAkB,CAAC,CAAnB;;AACA,oBAAKC,cAAL,CAAoB,KAApB;;AACA,oBAAK9H,aAAL,CAAmB1B,YAAnB;AACD;;AAED,kBAAKqG,aAAL,CAAmB9H,KAAK,CAACK,KAAzB,EAAgC,IAAhC;;AAEA,kBAAK8K,oBAAL,CAA0Bc,IAA1B,CAA+B,MAAKC,YAAL,CAAkB/K,OAAO,CAACC,CAA1B,EAA6BD,OAAO,CAACE,CAArC,EAAwC,MAAKU,UAA7C,EAAyDV,CAAzD,GAA6D,GAA5F;;AAEA,kBAAK8K,sBAAL,CAA4Bf,IAA5B,CAAiC,MAAKD,oBAAtC;;AAEA;AA3GJ;AA6GD;AACF,KAnHc,CAAf;;AAqHAtM,IAAAA,eAAe,gCAAO,iBAAP,EAA0B,UAACuE,KAAD,EAAQgJ,OAAR,EAAoB;AAC3D,UAAI,MAAK/I,OAAT,EAAkB;AAChB,YAAMgJ,OAAO,GAAGD,OAAO,IAAI,MAAKE,MAAhC;;AACA,cAAKzB,SAAL,CAAezH,KAAK,CAACmF,OAArB,EAA8BnF,KAAK,CAACoF,OAApC;;AAEA,gBAAQ4D,OAAR;AACE,eAAKpM,KAAK,CAACI,GAAX;AACE,gBAAI,MAAK8H,SAAL,IAAkB,MAAK3G,MAAL,KAAgB,IAAtC,EAA4C;AAC1C,kBAAI8K,OAAJ,EAAa;AACX;AACA,sBAAKlJ,aAAL,CAAmBvB,SAAnB;;AACA,sBAAKuB,aAAL,CAAmBxB,WAAnB;;AACA,sBAAKmG,aAAL,CAAmBsE,OAAnB,EAA4B,IAA5B;;AACA,oBAAMlB,MAAM,GAAG,MAAK5C,kBAAL,CAAwB,MAAK/G,MAA7B,EAAqCJ,OAAO,CAACC,CAA7C,EAAgDD,OAAO,CAACE,CAAxD,EAA2D,MAAKU,UAAhE,CAAf;;AAEA,oBAAImJ,MAAM,KAAK5I,SAAf,EAA0B;AACxB,wBAAK6I,oBAAL,CAA0BC,IAA1B,CAA+BF,MAA/B;AACD;;AAED,oBAAI,MAAKG,UAAT,EAAqB;AACnB,wBAAKhC,QAAL;AACD;;AAED,sBAAK4B,cAAL,CAAoB,KAApB;AACD,eAhBD,MAgBO;AACL;AACA,oBAAMC,QAAM,GAAG,MAAK5C,kBAAL,CAAwB,MAAK/G,MAA7B,EAAqCJ,OAAO,CAACC,CAA7C,EAAgDD,OAAO,CAACE,CAAxD,EAA2D,MAAKU,UAAhE,CAAf;;AAEA,oBAAImJ,QAAM,KAAK5I,SAAf,EAA0B;AACxB,wBAAK6J,sBAAL,CAA4Bf,IAA5B,CAAiCF,QAAjC;AACD;;AAED,sBAAKjC,oBAAL,CAA0B,MAAKsD,GAAL,CAAS,MAAKpB,oBAAd,EAAoC,MAAKgB,sBAAzC,CAA1B;AACD;AACF;;AAED;;AAEF,eAAKnM,KAAK,CAACG,MAAX;AACE,gBAAI,MAAKmL,YAAL,IAAqB,MAAK/J,MAAL,KAAgB,IAAzC,EAA+C;AAC7C,kBAAI8K,OAAJ,EAAa;AACX;AACA,sBAAKlJ,aAAL,CAAmBvB,SAAnB;;AACA,sBAAKuB,aAAL,CAAmBxB,WAAnB;;AACA,sBAAKmG,aAAL,CAAmBsE,OAAnB,EAA4B,IAA5B;;AACA,oBAAMlB,QAAM,GAAG,MAAKK,oBAAL,CAA0B,MAAKhK,MAA/B,EAAuCJ,OAAO,CAACC,CAA/C,EAAkDD,OAAO,CAACE,CAA1D,EAA6D,MAAKU,UAAlE,EAA8E,MAAKQ,SAAnF,CAAf;;AAEA,oBAAI2I,QAAM,KAAK5I,SAAf,EAA0B;AACxB,wBAAK6I,oBAAL,CAA0BC,IAA1B,CAA+BF,QAA/B;AACD;;AAED,oBAAI,MAAKG,UAAT,EAAqB;AACnB,wBAAKjC,WAAL;AACD;;AAED,sBAAK6B,cAAL,CAAoB,IAApB;AACD,eAhBD,MAgBO;AACL;AACA,oBAAMC,QAAM,GAAG,MAAKK,oBAAL,CAA0B,MAAKhK,MAA/B,EAAuCJ,OAAO,CAACC,CAA/C,EAAkDD,OAAO,CAACE,CAA1D,EAA6D,MAAKU,UAAlE,EAA8E,MAAKQ,SAAnF,CAAf;;AAEA,oBAAI2I,QAAM,KAAK5I,SAAf,EAA0B;AACxB,wBAAK6J,sBAAL,CAA4Bf,IAA5B,CAAiCF,QAAjC;AACD;;AAED,oBAAMsB,QAAQ,GAAG,MAAKrB,oBAAL,CAA0BzB,UAA1B,CAAqC,MAAKyC,sBAA1C,CAAjB;;AAEA,oBAAMM,KAAK,GAAG,MAAKtB,oBAAL,CAA0BuB,OAA1B,CAAkC,MAAKP,sBAAvC,CAAd;;AAEA,oBAAMQ,MAAM,GAAG5E,IAAI,CAAC6E,GAAL,CAASJ,QAAQ,GAAG,MAAKjK,SAAzB,EAAoCkK,KAApC,CAAf,CAZK,CAYsD;;AAE3D,sBAAKxD,oBAAL,CAA0B,MAAK4D,MAAL,CAAY,MAAKC,qBAAL,CAA2B,MAAK3B,oBAAhC,EAAsD,MAAKgB,sBAA3D,CAAZ,EAAgGQ,MAAhG,CAA1B;;AAEA,oBAAI,MAAKnB,gBAAT,EAA2B;AACzB,wBAAKC,SAAL,GAAiB,MAAKC,YAAtB;AACA,wBAAKA,YAAL,GAAoBrH,WAAW,CAACC,GAAZ,EAApB;AACA,wBAAKsH,UAAL,GAAkB,MAAKD,aAAvB;AACA,wBAAKA,aAAL,GAAqBgB,MAArB;;AAEA,wBAAKd,cAAL,CAAoBT,IAApB,CAAyB,MAAKU,cAA9B;;AAEA,wBAAKA,cAAL,CAAoBV,IAApB,CAAyB,MAAKe,sBAA9B;;AAEA,wBAAKH,MAAL,GAAc,MAAKD,MAAnB;AACA,wBAAKA,MAAL,GAAc,MAAKgB,qBAAL,CAA2B,MAAKnB,UAAhC,EAA4C,MAAKD,aAAjD,EAAgE,MAAKF,SAArE,EAAgF,MAAKC,YAArF,CAAd;AACD;AACF;AACF;;AAED;;AAEF,eAAK1L,KAAK,CAACK,KAAX;AACE,gBAAI,MAAKkH,UAAT,EAAqB;AACnB,kBAAI8E,OAAJ,EAAa;AACX;AACA,sBAAKlJ,aAAL,CAAmBvB,SAAnB;;AACA,sBAAKuB,aAAL,CAAmBxB,WAAnB;;AACA,sBAAKmG,aAAL,CAAmBsE,OAAnB,EAA4B,IAA5B;;AAEA,sBAAKjB,oBAAL,CAA0Bc,IAA1B,CAA+B,MAAKC,YAAL,CAAkB/K,OAAO,CAACC,CAA1B,EAA6BD,OAAO,CAACE,CAArC,EAAwC,MAAKU,UAA7C,EAAyDV,CAAzD,GAA6D,GAA5F;;AAEA,sBAAK8K,sBAAL,CAA4Bf,IAA5B,CAAiC,MAAKD,oBAAtC;;AAEA,oBAAI,MAAKE,UAAT,EAAqB;AACnB,wBAAKjC,WAAL;AACD;;AAED,sBAAK6B,cAAL,CAAoB,KAApB;AACD,eAfD,MAeO;AACL;AACA,oBAAM+B,aAAa,GAAG,CAAtB,CAFK,CAEoB;;AAEzB,sBAAKb,sBAAL,CAA4BF,IAA5B,CAAiC,MAAKC,YAAL,CAAkB/K,OAAO,CAACC,CAA1B,EAA6BD,OAAO,CAACE,CAArC,EAAwC,MAAKU,UAA7C,EAAyDV,CAAzD,GAA6D,GAA9F;;AAEA,oBAAMqE,QAAQ,GAAG,MAAKyG,sBAAL,CAA4B9K,CAA5B,GAAgC,MAAK8J,oBAAL,CAA0B9J,CAA3E;AACA,oBAAIuG,IAAI,GAAG,CAAX;;AAEA,oBAAIlC,QAAQ,GAAG,CAAf,EAAkB;AAChBkC,kBAAAA,IAAI,GAAG,IAAIG,IAAI,CAACC,GAAL,CAAS,MAAKH,WAAd,EAA2B,CAACnC,QAAD,GAAYsH,aAAvC,CAAX;AACD,iBAFD,MAEO,IAAItH,QAAQ,GAAG,CAAf,EAAkB;AACvBkC,kBAAAA,IAAI,GAAGG,IAAI,CAACC,GAAL,CAAS,MAAKH,WAAd,EAA2BnC,QAAQ,GAAGsH,aAAtC,CAAP;AACD;;AAED,sBAAK/D,oBAAL,CAA0B,MAAKC,UAAL,CAAgBtB,IAAhB,EAAsB,MAAK1F,OAAL,CAAa4G,QAAnC,CAA1B;AACD;AACF;;AAED;;AAEF,eAAK9I,KAAK,CAACM,GAAX;AACE,gBAAI,MAAKiH,UAAL,IAAmB,MAAKhG,MAAL,YAAuBpC,iBAA1C,IAA+D,MAAKoC,MAAL,CAAYwH,mBAA/E,EAAoG;AAClG,kBAAIsD,OAAJ,EAAa;AACX;AACA,sBAAKlJ,aAAL,CAAmBvB,SAAnB;;AACA,sBAAKuB,aAAL,CAAmBxB,WAAnB;;AACA,sBAAKmG,aAAL,CAAmBsE,OAAnB,EAA4B,IAA5B;;AAEA,sBAAKjB,oBAAL,CAA0Bc,IAA1B,CAA+B,MAAKC,YAAL,CAAkB/K,OAAO,CAACC,CAA1B,EAA6BD,OAAO,CAACE,CAArC,EAAwC,MAAKU,UAA7C,EAAyDV,CAAzD,GAA6D,GAA5F;;AAEA,sBAAK8K,sBAAL,CAA4Bf,IAA5B,CAAiC,MAAKD,oBAAtC;;AAEA,oBAAI,MAAKE,UAAT,EAAqB;AACnB,wBAAKjC,WAAL;AACD;;AAED,sBAAK6B,cAAL,CAAoB,KAApB;AACD,eAfD,MAeO;AACL;AACA,oBAAM+B,cAAa,GAAG,CAAtB,CAFK,CAEoB;;AAEzB,sBAAKb,sBAAL,CAA4BF,IAA5B,CAAiC,MAAKC,YAAL,CAAkB/K,OAAO,CAACC,CAA1B,EAA6BD,OAAO,CAACE,CAArC,EAAwC,MAAKU,UAA7C,EAAyDV,CAAzD,GAA6D,GAA9F;;AAEA,oBAAMqE,UAAQ,GAAG,MAAKyG,sBAAL,CAA4B9K,CAA5B,GAAgC,MAAK8J,oBAAL,CAA0B9J,CAA3E;;AACA,oBAAIuG,KAAI,GAAG,CAAX;;AAEA,oBAAIlC,UAAQ,GAAG,CAAf,EAAkB;AAChBkC,kBAAAA,KAAI,GAAG,IAAIG,IAAI,CAACC,GAAL,CAAS,MAAKH,WAAd,EAA2B,CAACnC,UAAD,GAAYsH,cAAvC,CAAX;AACD,iBAFD,MAEO,IAAItH,UAAQ,GAAG,CAAf,EAAkB;AACvBkC,kBAAAA,KAAI,GAAGG,IAAI,CAACC,GAAL,CAAS,MAAKH,WAAd,EAA2BnC,UAAQ,GAAGsH,cAAtC,CAAP;AACD;;AAED,sBAAKzD,KAAL,CAAWC,qBAAX,CAAiC,MAAKC,kBAAtC;;AAEA,oBAAMrI,CAAC,GAAG,MAAKmI,KAAL,CAAWG,UAAX,CAAsB,MAAKxH,OAAL,CAAa4G,QAAnC,CAAV;;AAEA,oBAAIa,IAAI,GAAGvI,CAAC,GAAGwG,KAAf,CAnBK,CAmBgB;AACrB;;AAEA+B,gBAAAA,IAAI,GAAGvK,SAAS,CAACwK,KAAV,CAAgBD,IAAhB,EAAsB,MAAKE,WAA3B,EAAwC,MAAKC,WAA7C,CAAP;AACA,oBAAMzI,CAAC,GAAGD,CAAC,GAAG2G,IAAI,CAACgC,GAAL,CAAS3K,SAAS,CAAC4K,OAAV,GAAoB,MAAKiD,SAAzB,GAAqC,GAA9C,CAAd,CAvBK,CAuB6D;;AAElE,oBAAI/C,MAAM,GAAG9K,SAAS,CAAC+K,OAAV,IAAqBpC,IAAI,CAACqC,IAAL,CAAU/I,CAAC,GAAGsI,IAAd,IAAsB,CAA3C,CAAb,CAzBK,CAyBuD;;AAE5DO,gBAAAA,MAAM,GAAG9K,SAAS,CAACwK,KAAV,CAAgBM,MAAhB,EAAwB,MAAKI,MAA7B,EAAqC,MAAKD,MAA1C,CAAT;AACA,oBAAME,WAAW,GAAGlJ,CAAC,GAAG0G,IAAI,CAACgC,GAAL,CAAS3K,SAAS,CAAC4K,OAAV,IAAqBE,MAAM,GAAG,CAA9B,CAAT,CAAxB;AACAtC,gBAAAA,KAAI,GAAGxG,CAAC,GAAGmJ,WAAX;;AAEA,sBAAK2C,KAAL,CAAW1D,qBAAX,CAAiC,MAAK2D,iBAAtC;;AAEA,sBAAK3C,MAAL,CAAYN,MAAZ;;AACA,sBAAKjB,oBAAL,CAA0B,MAAKC,UAAL,CAAgBtB,KAAhB,EAAsB,MAAKsF,KAA3B,EAAkC,KAAlC,CAA1B,EAlCK,CAkCgE;;;AAErE,oBAAME,SAAS,GAAG,MAAKlL,OAAL,CAAa4G,QAAb,CAAsBuE,KAAtB,GAA8BC,GAA9B,CAAkC,MAAK/L,MAAL,CAAYuH,QAA9C,EAAwDyE,SAAxD,GAAoE5E,cAApE,CAAmF4B,WAAW,GAAGnJ,CAAjG,CAAlB;;AAEA,sBAAKoM,KAAL,CAAWC,eAAX,CAA2BL,SAAS,CAAChM,CAArC,EAAwCgM,SAAS,CAAC/L,CAAlD,EAAqD+L,SAAS,CAACjL,CAA/D;AACD;AACF;;AAED;AAtLJ;;AAyLA,cAAKgB,aAAL,CAAmB1B,YAAnB;AACD;AACF,KAhMc,CAAf;;AAkMA5C,IAAAA,eAAe,gCAAO,gBAAP,EAAyB,YAAM;AAC5C,UAAI,MAAKyN,MAAL,IAAetM,KAAK,CAACG,MAAzB,EAAiC;AAC/B,YAAI,CAAC,MAAKmL,YAAV,EAAwB;AACtB;AACD;;AAED,YAAI,MAAKE,gBAAT,EAA2B;AACzB;AACA,cAAMkC,SAAS,GAAGrJ,WAAW,CAACC,GAAZ,KAAoB,MAAKoH,YAA3C;;AAEA,cAAIgC,SAAS,GAAG,GAAhB,EAAqB;AACnB,gBAAMC,CAAC,GAAG5F,IAAI,CAAC6F,GAAL,CAAS,CAAC,MAAK5B,MAAL,GAAc,MAAKD,MAApB,IAA8B,CAAvC,CAAV;;AACA,gBAAM8B,IAAI,gCAAV;;AACA,kBAAK/C,YAAL,GAAoBrG,MAAM,CAACqJ,qBAAP,CAA6B,UAAUC,CAAV,EAAa;AAC5DF,cAAAA,IAAI,CAAC/F,aAAL,CAAmB9H,KAAK,CAACW,gBAAzB,EAA2C,IAA3C;AACA,kBAAMqN,YAAY,GAAGH,IAAI,CAACf,qBAAL,CAA2Be,IAAI,CAAChC,cAAhC,EAAgDgC,IAAI,CAAC/B,cAArD,CAArB;AACA+B,cAAAA,IAAI,CAACI,cAAL,CAAoBF,CAApB,EAAuBC,YAAvB,EAAqCjG,IAAI,CAACmG,GAAL,CAASP,CAAT,EAAYE,IAAI,CAACM,IAAjB,CAArC;AACD,aAJmB,CAApB;AAKD,WARD,MAQO;AACL;AACA,kBAAKrG,aAAL,CAAmB9H,KAAK,CAACC,IAAzB,EAA+B,KAA/B;;AACA,kBAAKgL,cAAL,CAAoB,KAApB;;AACA,kBAAK9H,aAAL,CAAmB1B,YAAnB;AACD;AACF,SAlBD,MAkBO;AACL,gBAAKqG,aAAL,CAAmB9H,KAAK,CAACC,IAAzB,EAA+B,KAA/B;;AACA,gBAAKgL,cAAL,CAAoB,KAApB;;AACA,gBAAK9H,aAAL,CAAmB1B,YAAnB;AACD;AACF,OA5BD,MA4BO,IAAI,MAAK6K,MAAL,IAAetM,KAAK,CAACI,GAArB,IAA4B,MAAKkM,MAAL,IAAetM,KAAK,CAACC,IAArD,EAA2D;AAChE,cAAK6H,aAAL,CAAmB9H,KAAK,CAACC,IAAzB,EAA+B,KAA/B;;AAEA,YAAI,MAAKoL,UAAT,EAAqB;AACnB,gBAAKjC,WAAL;AACD;;AAED,cAAK6B,cAAL,CAAoB,KAApB;;AACA,cAAK9H,aAAL,CAAmB1B,YAAnB;AACD;;AAED,YAAK0B,aAAL,CAAmBvB,SAAnB;AACD,KAzCc,CAAf;;AA2CA/C,IAAAA,eAAe,gCAAO,aAAP,EAAsB,UAAAuE,KAAK,EAAI;AAC5C,UAAI,MAAKC,OAAL,IAAgB,MAAK6E,SAArB,IAAkC,MAAKlG,KAAL,IAAc,IAAhD,IAAwD,MAAKT,MAAL,KAAgB,IAA5E,EAAkF;AAChF,cAAK4B,aAAL,CAAmBxB,WAAnB;;AACA,cAAKkJ,SAAL,CAAezH,KAAK,CAACmF,OAArB,EAA8BnF,KAAK,CAACoF,OAApC;;AACA,YAAM4F,IAAI,GAAG,MAAKC,cAAL,CAAoB,MAAKnC,YAAL,CAAkB/K,OAAO,CAACC,CAA1B,EAA6BD,OAAO,CAACE,CAArC,EAAwC,MAAKU,UAA7C,CAApB,EAA8E,MAAKR,MAAnF,CAAb;;AAEA,YAAI6M,IAAI,IAAI,IAAR,IAAgB,MAAK5C,gBAAzB,EAA2C;AACzC,cAAMqC,IAAI,gCAAV;;AAEA,cAAI,MAAK/C,YAAL,IAAqB,CAAC,CAA1B,EAA6B;AAC3BrG,YAAAA,MAAM,CAACsG,oBAAP,CAA4B,MAAKD,YAAjC;AACD;;AAED,gBAAKE,UAAL,GAAkB,CAAC,CAAnB;AACA,gBAAKF,YAAL,GAAoBrG,MAAM,CAACqJ,qBAAP,CAA6B,UAAUC,CAAV,EAAa;AAC5DF,YAAAA,IAAI,CAAC/F,aAAL,CAAmB9H,KAAK,CAACU,eAAzB,EAA0C,IAA1C;AACAmN,YAAAA,IAAI,CAACS,WAAL,CAAiBP,CAAjB,EAAoBK,IAApB,EAA0BP,IAAI,CAACpE,kBAA/B,EAAmDoE,IAAI,CAACV,iBAAxD;AACD,WAHmB,CAApB;AAID,SAZD,MAYO,IAAIiB,IAAI,IAAI,IAAR,IAAgB,CAAC,MAAK5C,gBAA1B,EAA4C;AACjD,gBAAK1D,aAAL,CAAmB9H,KAAK,CAACO,KAAzB,EAAgC,IAAhC;;AACA,gBAAKgO,KAAL,CAAWH,IAAX,EAAiB,MAAKvG,WAAtB;;AACA,gBAAKC,aAAL,CAAmB9H,KAAK,CAACC,IAAzB,EAA+B,KAA/B;;AACA,gBAAKkD,aAAL,CAAmB1B,YAAnB;AACD;AACF;;AAED,YAAK0B,aAAL,CAAmBvB,SAAnB;AACD,KA3Bc,CAAf;;AA6BA/C,IAAAA,eAAe,gCAAO,kBAAP,EAA2B,YAAM;AAC9C,UAAI,MAAKwE,OAAL,IAAgB,MAAK6E,SAArB,IAAkC,MAAK3G,MAAL,KAAgB,IAAtD,EAA4D;AAC1D,cAAK4B,aAAL,CAAmBxB,WAAnB;;AACA,cAAKmG,aAAL,CAAmB9H,KAAK,CAACI,GAAzB,EAA8B,IAA9B;;AACA,cAAKyK,SAAL,CAAe,CAAC,MAAKhH,aAAL,CAAmB,CAAnB,EAAsB0E,OAAtB,GAAgC,MAAK1E,aAAL,CAAmB,CAAnB,EAAsB0E,OAAvD,IAAkE,CAAjF,EAAoF,CAAC,MAAK1E,aAAL,CAAmB,CAAnB,EAAsB2E,OAAtB,GAAgC,MAAK3E,aAAL,CAAmB,CAAnB,EAAsB2E,OAAvD,IAAkE,CAAtJ;;AACA,YAAM0C,MAAM,GAAG,MAAK5C,kBAAL,CAAwB,MAAK/G,MAA7B,EAAqCJ,OAAO,CAACC,CAA7C,EAAgDD,OAAO,CAACE,CAAxD,EAA2D,MAAKU,UAAhE,EAA4E,IAA5E,CAAf;;AAEA,YAAImJ,MAAM,KAAK5I,SAAf,EAA0B;AACxB,gBAAK6I,oBAAL,CAA0BC,IAA1B,CAA+BF,MAA/B;AACD;;AAED,cAAKiB,sBAAL,CAA4Bf,IAA5B,CAAiC,MAAKD,oBAAtC;;AAEA,cAAKF,cAAL,CAAoB,KAApB;AACD;AACF,KAfc,CAAf;;AAiBApM,IAAAA,eAAe,gCAAO,iBAAP,EAA0B,YAAM;AAC7C,UAAI,MAAKwE,OAAL,IAAgB,MAAK6E,SAArB,IAAkC,MAAK3G,MAAL,KAAgB,IAAtD,EAA4D;AAC1D,cAAKsJ,SAAL,CAAe,CAAC,MAAKhH,aAAL,CAAmB,CAAnB,EAAsB0E,OAAtB,GAAgC,MAAK1E,aAAL,CAAmB,CAAnB,EAAsB0E,OAAvD,IAAkE,CAAjF,EAAoF,CAAC,MAAK1E,aAAL,CAAmB,CAAnB,EAAsB2E,OAAtB,GAAgC,MAAK3E,aAAL,CAAmB,CAAnB,EAAsB2E,OAAvD,IAAkE,CAAtJ;;AAEA,YAAI,MAAK8D,MAAL,IAAetM,KAAK,CAACI,GAAzB,EAA8B;AAC5B,gBAAK0H,aAAL,CAAmB9H,KAAK,CAACI,GAAzB,EAA8B,IAA9B;;AAEA,gBAAK+K,oBAAL,CAA0BC,IAA1B,CAA+B,MAAKe,sBAApC;AACD;;AAED,YAAMjB,MAAM,GAAG,MAAK5C,kBAAL,CAAwB,MAAK/G,MAA7B,EAAqCJ,OAAO,CAACC,CAA7C,EAAgDD,OAAO,CAACE,CAAxD,EAA2D,MAAKU,UAAhE,EAA4E,IAA5E,CAAf;;AACA,YAAImJ,MAAM,KAAK5I,SAAf,EAA0B,MAAK6J,sBAAL,CAA4Bf,IAA5B,CAAiCF,MAAjC;;AAC1B,cAAKjC,oBAAL,CAA0B,MAAKsD,GAAL,CAAS,MAAKpB,oBAAd,EAAoC,MAAKgB,sBAAzC,EAAiE,IAAjE,CAA1B;;AACA,cAAKhJ,aAAL,CAAmB1B,YAAnB;AACD;AACF,KAfc,CAAf;;AAiBA5C,IAAAA,eAAe,gCAAO,gBAAP,EAAyB,YAAM;AAC5C,YAAKiJ,aAAL,CAAmB9H,KAAK,CAACC,IAAzB,EAA+B,KAA/B;;AACA,YAAKkD,aAAL,CAAmBvB,SAAnB;AACD,KAHc,CAAf;;AAKA/C,IAAAA,eAAe,gCAAO,eAAP,EAAwB,YAAM;AAC3C,UAAI,MAAKwE,OAAL,IAAgB,MAAKiI,YAAzB,EAAuC;AACrC,YAAIkD,YAAJ;;AAEA,cAAKrL,aAAL,CAAmBxB,WAAnB;;AACA,cAAKmG,aAAL,CAAmB9H,KAAK,CAACQ,OAAzB,EAAkC,IAAlC,EAJqC,CAII;;;AAEzC,cAAKiO,oBAAL,GAA4B,MAAKC,QAAL,CAAc,MAAK7K,aAAL,CAAmB,CAAnB,CAAd,EAAqC,MAAKA,aAAL,CAAmB,CAAnB,CAArC,IAA8D,MAAK6K,QAAL,CAAc,MAAK/K,WAAL,CAAiB,CAAjB,CAAd,EAAmC,MAAKA,WAAL,CAAiB,CAAjB,CAAnC,CAA1F;AACA,cAAKgL,sBAAL,GAA8B,MAAKF,oBAAnC;AACA,SAACD,YAAY,GAAG,MAAKjN,MAArB,MAAiC,IAAjC,IAAyCiN,YAAY,KAAK,KAAK,CAA/D,GAAmE,KAAK,CAAxE,GAA4EA,YAAY,CAACI,iBAAb,CAA+B,MAAKC,aAApC,CAA5E,CARqC,CAQ2F;;AAEhI,YAAI,CAAC,MAAK3G,SAAN,IAAmB,CAAC,MAAKX,UAA7B,EAAyC;AACvC,gBAAK0D,cAAL,CAAoB,IAApB;AACD;AACF;AACF,KAfc,CAAf;;AAiBApM,IAAAA,eAAe,gCAAO,cAAP,EAAuB,YAAM;AAC1C,UAAI,MAAKwE,OAAL,IAAgB,MAAKiI,YAArB,IAAqC,MAAK/J,MAAL,KAAgB,IAAzD,EAA+D;AAC7D,cAAKsJ,SAAL,CAAe,CAAC,MAAKhH,aAAL,CAAmB,CAAnB,EAAsB0E,OAAtB,GAAgC,MAAK1E,aAAL,CAAmB,CAAnB,EAAsB0E,OAAvD,IAAkE,CAAjF,EAAoF,CAAC,MAAK1E,aAAL,CAAmB,CAAnB,EAAsB2E,OAAtB,GAAgC,MAAK3E,aAAL,CAAmB,CAAnB,EAAsB2E,OAAvD,IAAkE,CAAtJ;;AACA,YAAIsG,aAAJ;;AAEA,YAAI,MAAKxC,MAAL,IAAetM,KAAK,CAACQ,OAAzB,EAAkC;AAChC,gBAAKsH,aAAL,CAAmB9H,KAAK,CAACQ,OAAzB,EAAkC,IAAlC;;AACA,gBAAKiO,oBAAL,GAA4B,MAAKE,sBAAjC;AACD,SAP4D,CAO3D;;;AAGF,cAAKA,sBAAL,GAA8B,MAAKD,QAAL,CAAc,MAAK7K,aAAL,CAAmB,CAAnB,CAAd,EAAqC,MAAKA,aAAL,CAAmB,CAAnB,CAArC,IAA8D,MAAK6K,QAAL,CAAc,MAAK/K,WAAL,CAAiB,CAAjB,CAAd,EAAmC,MAAKA,WAAL,CAAiB,CAAjB,CAAnC,CAA5F;;AAEA,YAAI,CAAC,MAAKuE,SAAV,EAAqB;AACnB4G,UAAAA,aAAa,GAAG,IAAIxP,OAAJ,GAAckK,qBAAd,CAAoC,MAAK2D,iBAAzC,CAAhB;AACD,SAFD,MAEO,IAAI,MAAK5L,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,YAAuBlC,kBAAvE,EAA2F;AAChG,cAAI0P,sBAAJ;;AAEA,gBAAK7B,KAAL,CAAW1D,qBAAX,CAAiC,MAAK2D,iBAAtC;;AAEA2B,UAAAA,aAAa,GAAG,CAACC,sBAAsB,GAAG,MAAKzG,kBAAL,CAAwB,MAAK/G,MAA7B,EAAqCJ,OAAO,CAACC,CAA7C,EAAgDD,OAAO,CAACE,CAAxD,EAA2D,MAAKU,UAAhE,CAA1B,MAA2G,IAA3G,IAAmHgN,sBAAsB,KAAK,KAAK,CAAnJ,GAAuJ,KAAK,CAA5J,GAAgKA,sBAAsB,CAACtG,eAAvB,CAAuC,MAAKlH,MAAL,CAAYmH,UAAnD,EAA+DC,cAA/D,CAA8E,IAAI,MAAKpH,MAAL,CAAYqH,IAA9F,EAAoGC,GAApG,CAAwG,MAAKqE,KAA7G,CAAhL;AACD;;AAED,YAAMP,MAAM,GAAGvN,SAAS,CAAC4K,OAAV,IAAqB,MAAKyE,oBAAL,GAA4B,MAAKE,sBAAtD,CAAf;;AAEA,YAAIG,aAAa,KAAKxM,SAAtB,EAAiC;AAC/B,gBAAK2G,oBAAL,CAA0B,MAAK+F,OAAL,CAAaF,aAAb,EAA4BnC,MAA5B,CAA1B;AACD;;AAED,cAAKxJ,aAAL,CAAmB1B,YAAnB;AACD;AACF,KA/Bc,CAAf;;AAiCA5C,IAAAA,eAAe,gCAAO,aAAP,EAAsB,YAAM;AACzC,YAAKiJ,aAAL,CAAmB9H,KAAK,CAACC,IAAzB,EAA+B,KAA/B;;AACA,YAAKgL,cAAL,CAAoB,KAApB;;AACA,YAAK9H,aAAL,CAAmBvB,SAAnB;AACD,KAJc,CAAf;;AAMA/C,IAAAA,eAAe,gCAAO,cAAP,EAAuB,YAAM;AAC1C,UAAI,MAAKwE,OAAL,IAAgB,MAAKkE,UAAzB,EAAqC;AACnC,cAAKpE,aAAL,CAAmBxB,WAAnB;;AACA,cAAKmG,aAAL,CAAmB9H,KAAK,CAACK,KAAzB,EAAgC,IAAhC;;AACA,cAAK4O,oBAAL,GAA4B,MAAKtJ,yBAAL,CAA+B,MAAK9B,aAAL,CAAmB,CAAnB,CAA/B,EAAsD,MAAKA,aAAL,CAAmB,CAAnB,CAAtD,CAA5B;AACA,cAAKqL,sBAAL,GAA8B,MAAKD,oBAAnC;;AACA,cAAKhE,cAAL,CAAoB,KAApB;AACD;AACF,KARc,CAAf;;AAUApM,IAAAA,eAAe,gCAAO,aAAP,EAAsB,YAAM;AACzC,UAAI,MAAKwE,OAAL,IAAgB,MAAKkE,UAAzB,EAAqC;AACnC,cAAKsD,SAAL,CAAe,CAAC,MAAKhH,aAAL,CAAmB,CAAnB,EAAsB0E,OAAtB,GAAgC,MAAK1E,aAAL,CAAmB,CAAnB,EAAsB0E,OAAvD,IAAkE,CAAjF,EAAoF,CAAC,MAAK1E,aAAL,CAAmB,CAAnB,EAAsB2E,OAAtB,GAAgC,MAAK3E,aAAL,CAAmB,CAAnB,EAAsB2E,OAAvD,IAAkE,CAAtJ;;AACA,YAAMqB,WAAW,GAAG,EAApB,CAFmC,CAEX;;AAExB,YAAI,MAAKyC,MAAL,IAAetM,KAAK,CAACK,KAAzB,EAAgC;AAC9B,gBAAK4O,oBAAL,GAA4B,MAAKC,sBAAjC;;AACA,gBAAKpH,aAAL,CAAmB9H,KAAK,CAACK,KAAzB,EAAgC,IAAhC;AACD;;AAED,cAAK6O,sBAAL,GAA8BnH,IAAI,CAAC6E,GAAL,CAAS,MAAKjH,yBAAL,CAA+B,MAAK9B,aAAL,CAAmB,CAAnB,CAA/B,EAAsD,MAAKA,aAAL,CAAmB,CAAnB,CAAtD,CAAT,EAAuFgG,WAAW,GAAG,MAAKjE,WAA1G,CAA9B;AACA,YAAM+G,MAAM,GAAG,MAAKuC,sBAAL,GAA8B,MAAKD,oBAAlD;AACA,YAAI9G,UAAJ;;AAEA,YAAI,CAAC,MAAKD,SAAV,EAAqB;AACnBC,UAAAA,UAAU,GAAG,MAAKjG,OAAL,CAAa4G,QAA1B;AACD,SAFD,MAEO;AACL,cAAI,MAAKvH,MAAL,YAAuBlC,kBAAvB,IAA6C,MAAKkC,MAAL,CAAY6G,oBAA7D,EAAmF;AACjF,gBAAI+G,sBAAJ;;AAEAhH,YAAAA,UAAU,GAAG,CAACgH,sBAAsB,GAAG,MAAK7G,kBAAL,CAAwB,MAAK/G,MAA7B,EAAqCJ,OAAO,CAACC,CAA7C,EAAgDD,OAAO,CAACE,CAAxD,EAA2D,MAAKU,UAAhE,CAA1B,MAA2G,IAA3G,IAAmHoN,sBAAsB,KAAK,KAAK,CAAnJ,GAAuJ,KAAK,CAA5J,GAAgKA,sBAAsB,CAAC1G,eAAvB,CAAuC,MAAKlH,MAAL,CAAYmH,UAAnD,EAA+DC,cAA/D,CAA8E,IAAI,MAAKpH,MAAL,CAAYqH,IAA9F,EAAoGC,GAApG,CAAwG,MAAK3G,OAAL,CAAa4G,QAArH,CAA7K;AACD,WAJD,MAIO,IAAI,MAAKvH,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,CAAYwH,mBAA5D,EAAiF;AACtF,gBAAIqG,sBAAJ;;AAEAjH,YAAAA,UAAU,GAAG,CAACiH,sBAAsB,GAAG,MAAK9G,kBAAL,CAAwB,MAAK/G,MAA7B,EAAqCJ,OAAO,CAACC,CAA7C,EAAgDD,OAAO,CAACE,CAAxD,EAA2D,MAAKU,UAAhE,CAA1B,MAA2G,IAA3G,IAAmHqN,sBAAsB,KAAK,KAAK,CAAnJ,GAAuJ,KAAK,CAA5J,GAAgKA,sBAAsB,CAAC3G,eAAvB,CAAuC,MAAKlH,MAAL,CAAYmH,UAAnD,EAA+DG,GAA/D,CAAmE,MAAK3G,OAAL,CAAa4G,QAAhF,CAA7K;AACD;AACF;;AAED,YAAIX,UAAU,KAAK7F,SAAnB,EAA8B;AAC5B,gBAAK2G,oBAAL,CAA0B,MAAKC,UAAL,CAAgByD,MAAhB,EAAwBxE,UAAxB,CAA1B;AACD;;AAED,cAAKhF,aAAL,CAAmB1B,YAAnB;AACD;AACF,KAlCc,CAAf;;AAoCA5C,IAAAA,eAAe,gCAAO,YAAP,EAAqB,YAAM;AACxC,YAAKiJ,aAAL,CAAmB9H,KAAK,CAACC,IAAzB,EAA+B,KAA/B;;AACA,YAAKkD,aAAL,CAAmBvB,SAAnB;AACD,KAHc,CAAf;;AAKA/C,IAAAA,eAAe,gCAAO,kBAAP,EAA2B,YAAM;AAC9C,UAAI,MAAKwE,OAAL,IAAgB,MAAKkE,UAAzB,EAAqC;AACnC,cAAKpE,aAAL,CAAmBxB,WAAnB;;AACA,cAAKmG,aAAL,CAAmB9H,KAAK,CAACK,KAAzB,EAAgC,IAAhC,EAFmC,CAEI;;;AAEvC,YAAIkI,OAAO,GAAG,CAAd;AACA,YAAIC,OAAO,GAAG,CAAd;AACA,YAAM6G,QAAQ,GAAG,MAAKxL,aAAL,CAAmBL,MAApC;;AAEA,aAAK,IAAIF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+L,QAApB,EAA8B/L,CAAC,EAA/B,EAAmC;AACjCiF,UAAAA,OAAO,IAAI,MAAK1E,aAAL,CAAmBP,CAAnB,EAAsBiF,OAAjC;AACAC,UAAAA,OAAO,IAAI,MAAK3E,aAAL,CAAmBP,CAAnB,EAAsBkF,OAAjC;AACD;;AAED,cAAKqC,SAAL,CAAetC,OAAO,GAAG8G,QAAzB,EAAmC7G,OAAO,GAAG6G,QAA7C;;AAEA,cAAKlE,oBAAL,CAA0Bc,IAA1B,CAA+B,MAAKC,YAAL,CAAkB/K,OAAO,CAACC,CAA1B,EAA6BD,OAAO,CAACE,CAArC,EAAwC,MAAKU,UAA7C,EAAyDV,CAAzD,GAA6D,GAA5F;;AAEA,cAAK8K,sBAAL,CAA4Bf,IAA5B,CAAiC,MAAKD,oBAAtC;AACD;AACF,KApBc,CAAf;;AAsBAtM,IAAAA,eAAe,gCAAO,iBAAP,EAA0B,YAAM;AAC7C,UAAI,MAAKwE,OAAL,IAAgB,MAAKkE,UAArB,IAAmC,MAAKhG,MAAL,KAAgB,IAAvD,EAA6D;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAIgH,OAAO,GAAG,CAAd;AACA,YAAIC,OAAO,GAAG,CAAd;AACA,YAAM6G,QAAQ,GAAG,MAAKxL,aAAL,CAAmBL,MAApC;;AAEA,aAAK,IAAIF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+L,QAApB,EAA8B/L,CAAC,EAA/B,EAAmC;AACjCiF,UAAAA,OAAO,IAAI,MAAK1E,aAAL,CAAmBP,CAAnB,EAAsBiF,OAAjC;AACAC,UAAAA,OAAO,IAAI,MAAK3E,aAAL,CAAmBP,CAAnB,EAAsBkF,OAAjC;AACD;;AAED,cAAKqC,SAAL,CAAetC,OAAO,GAAG8G,QAAzB,EAAmC7G,OAAO,GAAG6G,QAA7C;;AACA,YAAMrC,aAAa,GAAG,CAAtB,CArB2D,CAqBlC;;AAEzB,cAAKb,sBAAL,CAA4BF,IAA5B,CAAiC,MAAKC,YAAL,CAAkB/K,OAAO,CAACC,CAA1B,EAA6BD,OAAO,CAACE,CAArC,EAAwC,MAAKU,UAA7C,EAAyDV,CAAzD,GAA6D,GAA9F;;AAEA,YAAMqE,QAAQ,GAAG,MAAKyG,sBAAL,CAA4B9K,CAA5B,GAAgC,MAAK8J,oBAAL,CAA0B9J,CAA3E;AACA,YAAIuG,IAAI,GAAG,CAAX;;AAEA,YAAIlC,QAAQ,GAAG,CAAf,EAAkB;AAChBkC,UAAAA,IAAI,GAAG,IAAIG,IAAI,CAACC,GAAL,CAAS,MAAKH,WAAd,EAA2B,CAACnC,QAAD,GAAYsH,aAAvC,CAAX;AACD,SAFD,MAEO,IAAItH,QAAQ,GAAG,CAAf,EAAkB;AACvBkC,UAAAA,IAAI,GAAGG,IAAI,CAACC,GAAL,CAAS,MAAKH,WAAd,EAA2BnC,QAAQ,GAAGsH,aAAtC,CAAP;AACD;;AAED,cAAKzD,KAAL,CAAWC,qBAAX,CAAiC,MAAKC,kBAAtC;;AAEA,YAAMrI,CAAC,GAAG,MAAKmI,KAAL,CAAWG,UAAX,CAAsB,MAAKxH,OAAL,CAAa4G,QAAnC,CAAV;;AAEA,YAAIa,IAAI,GAAGvI,CAAC,GAAGwG,IAAf,CAtC2D,CAsCtC;AACrB;;AAEA+B,QAAAA,IAAI,GAAGvK,SAAS,CAACwK,KAAV,CAAgBD,IAAhB,EAAsB,MAAKE,WAA3B,EAAwC,MAAKC,WAA7C,CAAP;AACA,YAAMzI,CAAC,GAAGD,CAAC,GAAG2G,IAAI,CAACgC,GAAL,CAAS3K,SAAS,CAAC4K,OAAV,GAAoB,MAAKiD,SAAzB,GAAqC,GAA9C,CAAd,CA1C2D,CA0CO;;AAElE,YAAI/C,MAAM,GAAG9K,SAAS,CAAC+K,OAAV,IAAqBpC,IAAI,CAACqC,IAAL,CAAU/I,CAAC,GAAGsI,IAAd,IAAsB,CAA3C,CAAb,CA5C2D,CA4CC;;AAE5DO,QAAAA,MAAM,GAAG9K,SAAS,CAACwK,KAAV,CAAgBM,MAAhB,EAAwB,MAAKI,MAA7B,EAAqC,MAAKD,MAA1C,CAAT;AACA,YAAME,WAAW,GAAGlJ,CAAC,GAAG0G,IAAI,CAACgC,GAAL,CAAS3K,SAAS,CAAC4K,OAAV,IAAqBE,MAAM,GAAG,CAA9B,CAAT,CAAxB;AACAtC,QAAAA,IAAI,GAAGxG,CAAC,GAAGmJ,WAAX;;AAEA,cAAK2C,KAAL,CAAW1D,qBAAX,CAAiC,MAAK2D,iBAAtC;;AAEA,cAAK3C,MAAL,CAAYN,MAAZ;;AACA,cAAKjB,oBAAL,CAA0B,MAAKC,UAAL,CAAgBtB,IAAhB,EAAsB,MAAKsF,KAA3B,EAAkC,KAAlC,CAA1B,EArD2D,CAqDU;;;AAErE,YAAME,SAAS,GAAG,MAAKlL,OAAL,CAAa4G,QAAb,CAAsBuE,KAAtB,GAA8BC,GAA9B,CAAkC,MAAK/L,MAAL,CAAYuH,QAA9C,EAAwDyE,SAAxD,GAAoE5E,cAApE,CAAmF4B,WAAW,GAAGnJ,CAAjG,CAAlB;;AAEA,cAAKoM,KAAL,CAAWC,eAAX,CAA2BL,SAAS,CAAChM,CAArC,EAAwCgM,SAAS,CAAC/L,CAAlD,EAAqD+L,SAAS,CAACjL,CAA/D;;AAEA,cAAKgB,aAAL,CAAmB1B,YAAnB;AACD;AACF,KA9Dc,CAAf;;AAgEA5C,IAAAA,eAAe,gCAAO,gBAAP,EAAyB,YAAM;AAC5C,YAAKiJ,aAAL,CAAmB9H,KAAK,CAACC,IAAzB,EAA+B,KAA/B;;AACA,YAAKkD,aAAL,CAAmBvB,SAAnB,EAF4C,CAEb;;AAChC,KAHc,CAAf;;AAKA/C,IAAAA,eAAe,gCAAO,WAAP,EAAoB,UAAC0J,OAAD,EAAUC,OAAV,EAAsB;AACvDrH,MAAAA,OAAO,CAACC,CAAR,GAAYmH,OAAZ;AACApH,MAAAA,OAAO,CAACE,CAAR,GAAYmH,OAAZ;AACD,KAHc,CAAf;;AAKA3J,IAAAA,eAAe,gCAAO,wBAAP,EAAiC,YAAM;AACpD,YAAKyQ,cAAL,CAAoB,KAApB,EAA2B,CAA3B,EAA8B,MAA9B;;AACA,YAAKA,cAAL,CAAoB,KAApB,EAA2B,CAA3B;;AACA,YAAKA,cAAL,CAAoB,QAApB,EAA8B,CAA9B;;AACA,YAAKA,cAAL,CAAoB,MAApB,EAA4B,OAA5B;;AACA,YAAKA,cAAL,CAAoB,MAApB,EAA4B,CAA5B;;AACA,YAAKA,cAAL,CAAoB,KAApB,EAA2B,OAA3B,EAAoC,OAApC;;AACA,YAAKA,cAAL,CAAoB,KAApB,EAA2B,CAA3B,EAA8B,OAA9B;AACD,KARc,CAAf;;AAUAzQ,IAAAA,eAAe,gCAAO,oBAAP,EAA6B,UAAC0Q,OAAD,EAAUC,OAAV,EAAsB;AAChE,UAAID,OAAO,CAAC3E,SAAR,IAAqB4E,OAAO,CAAC5E,SAAjC,EAA4C;AAC1C,YAAI2E,OAAO,CAAC9L,KAAR,IAAiB+L,OAAO,CAAC/L,KAAzB,IAAkC8L,OAAO,CAAC9E,GAAR,IAAe+E,OAAO,CAAC/E,GAA7D,EAAkE;AAChE,iBAAO,IAAP;AACD,SAFD,MAEO;AACL,iBAAO,KAAP;AACD;AACF,OAND,MAMO;AACL,eAAO,KAAP;AACD;AACF,KAVc,CAAf;;AAYA5L,IAAAA,eAAe,gCAAO,gBAAP,EAAyB,UAAC+L,SAAD,EAAYnH,KAAZ,EAAkC;AAAA,UAAfgH,GAAe,uEAAT,IAAS;AACxE,UAAMgF,cAAc,GAAG,CAAC,KAAD,EAAQ,QAAR,EAAkB,MAAlB,EAA0B,KAA1B,CAAvB;AACA,UAAMC,UAAU,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,OAAV,CAAnB;AACA,UAAMC,QAAQ,GAAG,CAAC,MAAD,EAAS,OAAT,EAAkB,IAAlB,CAAjB;AACA,UAAIC,KAAJ;;AAEA,UAAI,CAACH,cAAc,CAACI,QAAf,CAAwBjF,SAAxB,CAAD,IAAuC,CAAC8E,UAAU,CAACG,QAAX,CAAoBpM,KAApB,CAAxC,IAAsE,CAACkM,QAAQ,CAACE,QAAT,CAAkBpF,GAAlB,CAA3E,EAAmG;AACjG;AACA,eAAO,KAAP;AACD;;AAED,UAAIhH,KAAK,IAAI,OAAb,EAAsB;AACpB,YAAImH,SAAS,IAAI,MAAb,IAAuBA,SAAS,IAAI,KAAxC,EAA+C;AAC7C;AACA,iBAAO,KAAP;AACD;AACF;;AAED,cAAQA,SAAR;AACE,aAAK,KAAL;AACEgF,UAAAA,KAAK,GAAG5P,KAAK,CAACI,GAAd;AACA;;AAEF,aAAK,QAAL;AACEwP,UAAAA,KAAK,GAAG5P,KAAK,CAACG,MAAd;AACA;;AAEF,aAAK,MAAL;AACEyP,UAAAA,KAAK,GAAG5P,KAAK,CAACK,KAAd;AACA;;AAEF,aAAK,KAAL;AACEuP,UAAAA,KAAK,GAAG5P,KAAK,CAACM,GAAd;AACA;AAfJ;;AAkBA,UAAMwP,MAAM,GAAG;AACblF,QAAAA,SAAS,EAAEA,SADE;AAEbnH,QAAAA,KAAK,EAAEA,KAFM;AAGbgH,QAAAA,GAAG,EAAEA,GAHQ;AAIbmF,QAAAA,KAAK,EAAEA;AAJM,OAAf;;AAOA,WAAK,IAAItM,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,MAAKC,YAAL,CAAkBC,MAAtC,EAA8CF,CAAC,EAA/C,EAAmD;AACjD,YAAI,MAAKC,YAAL,CAAkBD,CAAlB,EAAqBG,KAArB,IAA8BqM,MAAM,CAACrM,KAArC,IAA8C,MAAKF,YAAL,CAAkBD,CAAlB,EAAqBmH,GAArB,IAA4BqF,MAAM,CAACrF,GAArF,EAA0F;AACxF,gBAAKlH,YAAL,CAAkBK,MAAlB,CAAyBN,CAAzB,EAA4B,CAA5B,EAA+BwM,MAA/B;;AACA,iBAAO,IAAP;AACD;AACF;;AAED,YAAKvM,YAAL,CAAkBY,IAAlB,CAAuB2L,MAAvB;;AACA,aAAO,IAAP;AACD,KApDc,CAAf;;AAsDAjR,IAAAA,eAAe,gCAAO,kBAAP,EAA2B,UAAC4E,KAAD,EAAuB;AAAA,UAAfgH,GAAe,uEAAT,IAAS;;AAC/D,WAAK,IAAInH,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,MAAKC,YAAL,CAAkBC,MAAtC,EAA8CF,CAAC,EAA/C,EAAmD;AACjD,YAAI,MAAKC,YAAL,CAAkBD,CAAlB,EAAqBG,KAArB,IAA8BA,KAA9B,IAAuC,MAAKF,YAAL,CAAkBD,CAAlB,EAAqBmH,GAArB,IAA4BA,GAAvE,EAA4E;AAC1E,gBAAKlH,YAAL,CAAkBK,MAAlB,CAAyBN,CAAzB,EAA4B,CAA5B;;AACA,iBAAO,IAAP;AACD;AACF;;AAED,aAAO,KAAP;AACD,KATc,CAAf;;AAWAzE,IAAAA,eAAe,gCAAO,iBAAP,EAA0B,UAAC4E,KAAD,EAAQgH,GAAR,EAAgB;AACvD,UAAIqF,MAAJ;;AAEA,WAAK,IAAIxM,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,MAAKC,YAAL,CAAkBC,MAAtC,EAA8CF,CAAC,EAA/C,EAAmD;AACjDwM,QAAAA,MAAM,GAAG,MAAKvM,YAAL,CAAkBD,CAAlB,CAAT;;AAEA,YAAIwM,MAAM,CAACrM,KAAP,IAAgBA,KAAhB,IAAyBqM,MAAM,CAACrF,GAAP,IAAcA,GAA3C,EAAgD;AAC9C,iBAAOqF,MAAM,CAAClF,SAAd;AACD;AACF;;AAED,UAAIH,GAAG,IAAI,IAAX,EAAiB;AACf,aAAK,IAAInH,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAG,MAAKC,YAAL,CAAkBC,MAAtC,EAA8CF,EAAC,EAA/C,EAAmD;AACjDwM,UAAAA,MAAM,GAAG,MAAKvM,YAAL,CAAkBD,EAAlB,CAAT;;AAEA,cAAIwM,MAAM,CAACrM,KAAP,IAAgBA,KAAhB,IAAyBqM,MAAM,CAACrF,GAAP,IAAc,IAA3C,EAAiD;AAC/C,mBAAOqF,MAAM,CAAClF,SAAd;AACD;AACF;AACF;;AAED,aAAO,IAAP;AACD,KAtBc,CAAf;;AAwBA/L,IAAAA,eAAe,gCAAO,sBAAP,EAA+B,UAAC4E,KAAD,EAAQgH,GAAR,EAAgB;AAC5D,UAAIqF,MAAJ;;AAEA,WAAK,IAAIxM,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,MAAKC,YAAL,CAAkBC,MAAtC,EAA8CF,CAAC,EAA/C,EAAmD;AACjDwM,QAAAA,MAAM,GAAG,MAAKvM,YAAL,CAAkBD,CAAlB,CAAT;;AAEA,YAAIwM,MAAM,CAACrM,KAAP,IAAgBA,KAAhB,IAAyBqM,MAAM,CAACrF,GAAP,IAAcA,GAA3C,EAAgD;AAC9C,iBAAOqF,MAAM,CAACF,KAAd;AACD;AACF;;AAED,UAAInF,GAAG,IAAI,IAAX,EAAiB;AACf,aAAK,IAAInH,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAG,MAAKC,YAAL,CAAkBC,MAAtC,EAA8CF,GAAC,EAA/C,EAAmD;AACjDwM,UAAAA,MAAM,GAAG,MAAKvM,YAAL,CAAkBD,GAAlB,CAAT;;AAEA,cAAIwM,MAAM,CAACrM,KAAP,IAAgBA,KAAhB,IAAyBqM,MAAM,CAACrF,GAAP,IAAc,IAA3C,EAAiD;AAC/C,mBAAOqF,MAAM,CAACF,KAAd;AACD;AACF;AACF;;AAED,aAAO,IAAP;AACD,KAtBc,CAAf;;AAwBA/Q,IAAAA,eAAe,gCAAO,UAAP,EAAmB,UAACkR,EAAD,EAAKC,EAAL,EAAY;AAC5C,aAAOjI,IAAI,CAACkI,KAAL,CAAWD,EAAE,CAACxH,OAAH,GAAauH,EAAE,CAACvH,OAA3B,EAAoCwH,EAAE,CAACzH,OAAH,GAAawH,EAAE,CAACxH,OAApD,IAA+D,GAA/D,GAAqER,IAAI,CAACmI,EAAjF;AACD,KAFc,CAAf;;AAIArR,IAAAA,eAAe,gCAAO,kBAAP,EAA2B,UAAAuE,KAAK,EAAI;AACjD,WAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,MAAKO,aAAL,CAAmBL,MAAvC,EAA+CF,CAAC,EAAhD,EAAoD;AAClD,YAAI,MAAKO,aAAL,CAAmBP,CAAnB,EAAsBgD,SAAtB,IAAmClD,KAAK,CAACkD,SAA7C,EAAwD;AACtD,gBAAKzC,aAAL,CAAmBD,MAAnB,CAA0BN,CAA1B,EAA6B,CAA7B,EAAgCF,KAAhC;;AAEA;AACD;AACF;AACF,KARc,CAAf;;AAUAvE,IAAAA,eAAe,gCAAO,uBAAP,EAAgC,UAACsR,EAAD,EAAKJ,EAAL,EAASK,EAAT,EAAaC,EAAb,EAAoB;AACjE,UAAMC,CAAC,GAAGP,EAAE,GAAGI,EAAf;AACA,UAAMpC,CAAC,GAAG,CAACsC,EAAE,GAAGD,EAAN,IAAY,IAAtB;;AAEA,UAAIrC,CAAC,IAAI,CAAT,EAAY;AACV,eAAO,CAAP;AACD;;AAED,aAAOuC,CAAC,GAAGvC,CAAX;AACD,KATc,CAAf;;AAWAlP,IAAAA,eAAe,gCAAO,2BAAP,EAAoC,UAACsR,EAAD,EAAKJ,EAAL,EAAY;AAC7D,aAAOhI,IAAI,CAACwI,IAAL,CAAUxI,IAAI,CAACC,GAAL,CAAS+H,EAAE,CAACxH,OAAH,GAAa4H,EAAE,CAAC5H,OAAzB,EAAkC,CAAlC,IAAuCR,IAAI,CAACC,GAAL,CAAS+H,EAAE,CAACvH,OAAH,GAAa2H,EAAE,CAAC3H,OAAzB,EAAkC,CAAlC,CAAjD,CAAP;AACD,KAFc,CAAf;;AAIA3J,IAAAA,eAAe,gCAAO,uBAAP,EAAgC,UAAC2R,IAAD,EAAOC,IAAP,EAAgB;AAC7D,YAAKC,eAAL,CAAqBC,eAArB,CAAqC,MAAKlH,kBAA1C;;AAEA,YAAKmH,KAAL,CAAWC,qBAAX,CAAiC,MAAKH,eAAtC;;AAEA,YAAK7B,aAAL,CAAmBiC,YAAnB,CAAgCN,IAAhC,EAAsCC,IAAtC,EAA4ChI,eAA5C,CAA4D,MAAKmI,KAAjE;;AAEA,aAAO,MAAK/B,aAAL,CAAmBtB,SAAnB,GAA+BF,KAA/B,EAAP;AACD,KARc,CAAf;;AAUAxO,IAAAA,eAAe,gCAAO,mBAAP,EAA4B,UAAA0C,MAAM,EAAI;AACnD,UAAMwP,MAAM,GAAG,IAAf;AACA,UAAMvE,QAAQ,GAAGjL,MAAM,CAACuH,QAAP,CAAgBY,UAAhB,CAA2B,MAAKxH,OAAL,CAAa4G,QAAxC,CAAjB;;AAEA,UAAIvH,MAAM,CAACG,IAAP,IAAe,mBAAf,IAAsCH,MAAM,YAAYpC,iBAA5D,EAA+E;AAC7E,YAAM6R,QAAQ,GAAG5R,SAAS,CAAC4K,OAAV,GAAoBzI,MAAM,CAAC0I,GAA3B,GAAiC,GAAlD,CAD6E,CACtB;;AAEvD,YAAMgH,QAAQ,GAAGlJ,IAAI,CAACqC,IAAL,CAAU7I,MAAM,CAAC2P,MAAP,GAAgBnJ,IAAI,CAACgC,GAAL,CAASiH,QAAT,CAA1B,CAAjB,CAH6E,CAGb;;AAEhE,eAAOjJ,IAAI,CAACgC,GAAL,CAAShC,IAAI,CAACmG,GAAL,CAAS8C,QAAT,EAAmBC,QAAnB,CAAT,IAAyCzE,QAAzC,GAAoDuE,MAA3D;AACD,OAND,MAMO,IAAIxP,MAAM,CAACG,IAAP,IAAe,oBAAf,IAAuCH,MAAM,YAAYlC,kBAA7D,EAAiF;AACtF,eAAO0I,IAAI,CAACmG,GAAL,CAAS3M,MAAM,CAAC4P,GAAhB,EAAqB5P,MAAM,CAAC6P,KAA5B,IAAqCL,MAA5C;AACD;AACF,KAbc,CAAf;;AAeAlS,IAAAA,eAAe,gCAAO,OAAP,EAAgB,UAACwS,KAAD,EAAQzJ,IAAR,EAA6B;AAAA,UAAf+E,MAAe,uEAAN,CAAM;;AAC1D,UAAI,MAAKpL,MAAL,KAAgB,IAApB,EAA0B;AACxB,YAAM+P,UAAU,GAAGD,KAAK,CAAChE,KAAN,EAAnB,CADwB,CACU;;AAElCiE,QAAAA,UAAU,CAAChE,GAAX,CAAe,MAAKpL,OAAL,CAAa4G,QAA5B,EAAsCH,cAAtC,CAAqDgE,MAArD;;AAEA,cAAK4E,kBAAL,CAAwB9D,eAAxB,CAAwC6D,UAAU,CAAClQ,CAAnD,EAAsDkQ,UAAU,CAACjQ,CAAjE,EAAoEiQ,UAAU,CAACnP,CAA/E;;AAEA,YAAMqP,cAAc,GAAG,MAAKrE,iBAAL,CAAuBE,KAAvB,EAAvB;;AAEA,cAAKF,iBAAL,CAAuBsE,WAAvB,CAAmC,MAAKF,kBAAxC;;AAEA,cAAKpE,iBAAL,CAAuBuE,SAAvB,CAAiC,MAAKxP,OAAL,CAAa4G,QAA9C,EAAwD,MAAK5G,OAAL,CAAawG,UAArE,EAAiF,MAAKxG,OAAL,CAAaD,KAA9F;;AAEA,YAAM0P,eAAe,GAAG,MAAKlI,kBAAL,CAAwB4D,KAAxB,EAAxB;;AAEA,cAAK5D,kBAAL,CAAwBgI,WAAxB,CAAoC,MAAKF,kBAAzC;;AAEA,cAAK9H,kBAAL,CAAwBiI,SAAxB,CAAkC,MAAKnQ,MAAL,CAAYuH,QAA9C,EAAwD,MAAKvH,MAAL,CAAYmH,UAApE,EAAgF,MAAKnH,MAAL,CAAYU,KAA5F,EAjBwB,CAiB4E;;;AAGpG,YAAI,MAAKsF,UAAT,EAAqB;AACnB,gBAAK0B,oBAAL,CAA0B,MAAKC,UAAL,CAAgBtB,IAAhB,EAAsB,MAAK1F,OAAL,CAAa4G,QAAnC,CAA1B;AACD;;AAED,cAAKqE,iBAAL,CAAuB/B,IAAvB,CAA4BoG,cAA5B;;AAEA,cAAK/H,kBAAL,CAAwB2B,IAAxB,CAA6BuG,eAA7B;AACD;AACF,KA7Bc,CAAf;;AA+BA9S,IAAAA,eAAe,gCAAO,UAAP,EAAmB,YAAM;AACtC,UAAI,MAAKmD,KAAL,IAAc,IAAlB,EAAwB;AACtB,YAAM4P,KAAK,GAAG,QAAd;AACA,YAAMC,UAAU,GAAG,CAAnB;AACA,YAAIjK,IAAJ,EAAUkK,SAAV,EAAqBC,SAArB,EAAgCC,IAAhC;;AAEA,YAAI,MAAKzQ,MAAL,YAAuBlC,kBAAvB,IAA6C,MAAKkC,MAAL,CAAY6G,oBAA7D,EAAmF;AACjF,cAAM6J,KAAK,GAAG,MAAK1Q,MAAL,CAAY6P,KAAZ,GAAoB,MAAK7P,MAAL,CAAY2Q,IAA9C;AACA,cAAMC,MAAM,GAAG,MAAK5Q,MAAL,CAAY6Q,MAAZ,GAAqB,MAAK7Q,MAAL,CAAY4P,GAAhD;AACAY,UAAAA,SAAS,GAAGhK,IAAI,CAAC6E,GAAL,CAASqF,KAAT,EAAgBE,MAAhB,CAAZ;AACAH,UAAAA,IAAI,GAAGD,SAAS,GAAG,EAAnB;AACAnK,UAAAA,IAAI,GAAGmK,SAAS,GAAG,MAAKxQ,MAAL,CAAYqH,IAAxB,GAA+BiJ,UAAtC;AACAC,UAAAA,SAAS,GAAGlK,IAAI,GAAGoK,IAAP,GAAc,MAAKzQ,MAAL,CAAYqH,IAAtC;AACD,SAPD,MAOO,IAAI,MAAKrH,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,CAAYwH,mBAA5D,EAAiF;AACtF,cAAMyD,QAAQ,GAAG,MAAKjL,MAAL,CAAYuH,QAAZ,CAAqBY,UAArB,CAAgC,MAAKxH,OAAL,CAAa4G,QAA7C,CAAjB;;AACA,cAAMkI,QAAQ,GAAG5R,SAAS,CAAC4K,OAAV,GAAoB,MAAKzI,MAAL,CAAY0I,GAAhC,GAAsC,GAAvD;AACA,cAAMgH,QAAQ,GAAGlJ,IAAI,CAACqC,IAAL,CAAU,MAAK7I,MAAL,CAAY2P,MAAZ,GAAqBnJ,IAAI,CAACgC,GAAL,CAASiH,QAAT,CAA/B,CAAjB;AACAe,UAAAA,SAAS,GAAGhK,IAAI,CAACgC,GAAL,CAAShC,IAAI,CAAC6E,GAAL,CAASoE,QAAT,EAAmBC,QAAnB,CAAT,IAAyCzE,QAAzC,GAAoD,CAAhE;AACAwF,UAAAA,IAAI,GAAGD,SAAS,GAAG,EAAnB;AACAnK,UAAAA,IAAI,GAAGmK,SAAS,GAAGF,UAAnB;AACAC,UAAAA,SAAS,GAAGlK,IAAI,GAAGoK,IAAnB;AACD;;AAED,YAAI,MAAK7I,KAAL,IAAc,IAAd,IAAsB,MAAK5H,MAAL,KAAgB,IAA1C,EAAgD;AAC9C,gBAAK4H,KAAL,GAAa,IAAI5J,UAAJ,CAAeqI,IAAf,EAAqBkK,SAArB,EAAgCF,KAAhC,EAAuCA,KAAvC,CAAb;;AAEA,gBAAKzI,KAAL,CAAWL,QAAX,CAAoBsC,IAApB,CAAyB,MAAKlJ,OAAL,CAAa4G,QAAtC;;AAEA,gBAAKuJ,aAAL,CAAmBjH,IAAnB,CAAwB,MAAKjC,KAAL,CAAWL,QAAnC;;AAEA,gBAAKK,KAAL,CAAWT,UAAX,CAAsB0C,IAAtB,CAA2B,MAAK7J,MAAL,CAAYmH,UAAvC;;AAEA,gBAAKS,KAAL,CAAWmJ,OAAX,CAAmBvK,IAAI,CAACmI,EAAL,GAAU,GAA7B;;AAEA,gBAAKlO,KAAL,CAAW6G,GAAX,CAAe,MAAKM,KAApB;AACD;AACF;AACF,KArCc,CAAf;;AAuCAtK,IAAAA,eAAe,gCAAO,SAAP,EAAkB,YAAM;AACrC,UAAI0T,WAAJ;;AAEA,UAAI,MAAKzH,YAAL,IAAqB,CAAC,CAA1B,EAA6B;AAC3BrG,QAAAA,MAAM,CAACsG,oBAAP,CAA4B,MAAKD,YAAjC;AACD;;AAED,YAAK/I,UAAL,CAAgBwE,mBAAhB,CAAoC,aAApC,EAAmD,MAAKiM,aAAxD;;AACA,YAAKzQ,UAAL,CAAgBwE,mBAAhB,CAAoC,eAApC,EAAqD,MAAKkM,eAA1D;;AACA,YAAK1Q,UAAL,CAAgBwE,mBAAhB,CAAoC,OAApC,EAA6C,MAAKmM,OAAlD;;AACA,YAAK3Q,UAAL,CAAgBwE,mBAAhB,CAAoC,aAApC,EAAmD,MAAKoM,aAAxD;;AACAlO,MAAAA,MAAM,CAAC8B,mBAAP,CAA2B,aAA3B,EAA0C,MAAK5B,aAA/C;AACAF,MAAAA,MAAM,CAAC8B,mBAAP,CAA2B,WAA3B,EAAwC,MAAK3B,WAA7C;AACAH,MAAAA,MAAM,CAAC8B,mBAAP,CAA2B,QAA3B,EAAqC,MAAKqM,cAA1C;AACAnO,MAAAA,MAAM,CAACC,gBAAP,CAAwB,SAAxB,EAAmC,MAAKmO,SAAxC;AACA,OAACN,WAAW,GAAG,MAAKvQ,KAApB,MAA+B,IAA/B,IAAuCuQ,WAAW,KAAK,KAAK,CAA5D,GAAgE,KAAK,CAArE,GAAyEA,WAAW,CAACO,MAAZ,CAAmB,MAAK5Q,OAAxB,CAAzE;;AACA,YAAKkH,WAAL;AACD,KAjBc,CAAf;;AAmBAvK,IAAAA,eAAe,gCAAO,aAAP,EAAsB,YAAM;AACzC,UAAI,MAAKsK,KAAL,IAAc,IAAd,IAAsB,MAAKnH,KAAL,IAAc,IAAxC,EAA8C;AAC5C,cAAKA,KAAL,CAAW8Q,MAAX,CAAkB,MAAK3J,KAAvB;;AACA,cAAKA,KAAL,GAAa,IAAb;AACD;AACF,KALc,CAAf;;AAOAtK,IAAAA,eAAe,gCAAO,cAAP,EAAuB,UAAAkP,CAAC,EAAI;AACzC,aAAO,IAAIhG,IAAI,CAACC,GAAL,CAAS,IAAI+F,CAAb,EAAgB,CAAhB,CAAX;AACD,KAFc,CAAf;;AAIAlP,IAAAA,eAAe,gCAAO,gBAAP,EAAyB,UAAAkU,QAAQ,EAAI;AAClD,UAAMC,MAAM,GAAG,MAAK9Q,OAAL,CAAac,QAAb,CAAsB,CAAtB,CAAf;AACA,UAAMiQ,MAAM,GAAG,MAAK/Q,OAAL,CAAac,QAAb,CAAsB,CAAtB,CAAf;AACA,UAAMkQ,MAAM,GAAG,MAAKhR,OAAL,CAAac,QAAb,CAAsB,CAAtB,CAAf;;AAEA,UAAI+P,QAAJ,EAAc;AACZC,QAAAA,MAAM,CAACG,QAAP,CAAgBC,SAAhB,CAA0B;AACxBC,UAAAA,OAAO,EAAE;AADe,SAA1B;AAGAJ,QAAAA,MAAM,CAACE,QAAP,CAAgBC,SAAhB,CAA0B;AACxBC,UAAAA,OAAO,EAAE;AADe,SAA1B;AAGAH,QAAAA,MAAM,CAACC,QAAP,CAAgBC,SAAhB,CAA0B;AACxBC,UAAAA,OAAO,EAAE;AADe,SAA1B;AAGD,OAVD,MAUO;AACLL,QAAAA,MAAM,CAACG,QAAP,CAAgBC,SAAhB,CAA0B;AACxBC,UAAAA,OAAO,EAAE;AADe,SAA1B;AAGAJ,QAAAA,MAAM,CAACE,QAAP,CAAgBC,SAAhB,CAA0B;AACxBC,UAAAA,OAAO,EAAE;AADe,SAA1B;AAGAH,QAAAA,MAAM,CAACC,QAAP,CAAgBC,SAAhB,CAA0B;AACxBC,UAAAA,OAAO,EAAE;AADe,SAA1B;AAGD;AACF,KA1Bc,CAAf;;AA4BAxU,IAAAA,eAAe,gCAAO,cAAP,EAAuB,UAACyU,OAAD,EAAUC,OAAV,EAAmBC,MAAnB,EAA8B;AAClE,UAAMC,UAAU,GAAGD,MAAM,CAACE,qBAAP,EAAnB;;AAEA,YAAKC,KAAL,CAAWC,IAAX,CAAgB,CAACN,OAAO,GAAGG,UAAU,CAACvB,IAAtB,IAA8BuB,UAAU,CAACxB,KAAzC,GAAiD,CAAjD,GAAqD,CAArE;;AAEA,YAAK0B,KAAL,CAAW1H,IAAX,CAAgB,CAACwH,UAAU,CAACrB,MAAX,GAAoBmB,OAArB,IAAgCE,UAAU,CAACtB,MAA3C,GAAoD,CAApD,GAAwD,CAAxE;;AAEA,aAAO,MAAKwB,KAAL,CAAWtG,KAAX,EAAP;AACD,KARc,CAAf;;AAUAxO,IAAAA,eAAe,gCAAO,mBAAP,EAA4B,UAACyU,OAAD,EAAUC,OAAV,EAAmBC,MAAnB,EAA8B;AACvE,YAAKG,KAAL,CAAWvI,IAAX,CAAgB,MAAKc,YAAL,CAAkBoH,OAAlB,EAA2BC,OAA3B,EAAoCC,MAApC,CAAhB;;AAEA,UAAI,MAAKjS,MAAL,YAAuBlC,kBAA3B,EAA+C;AAC7C,cAAKsU,KAAL,CAAWvS,CAAX,IAAgB,CAAC,MAAKG,MAAL,CAAY6P,KAAZ,GAAoB,MAAK7P,MAAL,CAAY2Q,IAAjC,IAAyC,GAAzD;AACA,cAAKyB,KAAL,CAAWtS,CAAX,IAAgB,CAAC,MAAKE,MAAL,CAAY4P,GAAZ,GAAkB,MAAK5P,MAAL,CAAY6Q,MAA/B,IAAyC,GAAzD;AACD;;AAED,aAAO,MAAKuB,KAAL,CAAWtG,KAAX,EAAP;AACD,KATc,CAAf;;AAWAxO,IAAAA,eAAe,gCAAO,WAAP,EAAoB,UAAA0C,MAAM,EAAI;AAC3C,UAAIA,MAAM,YAAYpC,iBAAlB,IAAuCoC,MAAM,YAAYlC,kBAA7D,EAAiF;AAC/EkC,QAAAA,MAAM,CAACsS,MAAP,CAAc,MAAKC,MAAnB;AACAvS,QAAAA,MAAM,CAACwS,YAAP,GAF+E,CAExD;;AAEvB,YAAI,CAACxS,MAAM,KAAK,IAAX,IAAmBA,MAAM,KAAK,KAAK,CAAnC,GAAuC,KAAK,CAA5C,GAAgDA,MAAM,CAACG,IAAxD,KAAiE,mBAAjE,IAAwFH,MAAM,YAAYpC,iBAA9G,EAAiI;AAC/H,gBAAK6U,KAAL,GAAazS,MAAM,CAAC0I,GAApB;AACA,gBAAKgD,SAAL,GAAiB1L,MAAM,CAAC0I,GAAxB;AACD;;AAED,cAAKgK,mBAAL,CAAyB7I,IAAzB,CAA8B7J,MAAM,CAAC2S,MAArC;;AAEA,cAAKzK,kBAAL,CAAwB2B,IAAxB,CAA6B,MAAK6I,mBAAlC;;AAEA,cAAKE,sBAAL,CAA4B/I,IAA5B,CAAiC7J,MAAM,CAAC6S,gBAAxC;;AAEA,cAAKC,MAAL,GAAc9S,MAAM,CAACqH,IAArB;AACA,cAAK0L,UAAL,GAAkB,MAAKD,MAAvB;AACA,cAAKE,YAAL,GAAoBhT,MAAM,CAACiT,IAA3B;AACA,cAAKC,SAAL,GAAiBlT,MAAM,CAACuH,QAAP,CAAgBY,UAAhB,CAA2B,MAAKoK,MAAhC,IAA0CvS,MAAM,CAACiT,IAAlE;AACA,cAAKE,QAAL,GAAgB,MAAKH,YAArB;AACA,cAAKI,WAAL,GAAmBpT,MAAM,CAACqT,GAA1B;AACA,cAAKC,QAAL,GAAgBtT,MAAM,CAACuH,QAAP,CAAgBY,UAAhB,CAA2B,MAAKoK,MAAhC,IAA0CvS,MAAM,CAACqT,GAAjE;AACA,cAAKE,OAAL,GAAe,MAAKH,WAApB;;AAEA,cAAKI,IAAL,CAAU3J,IAAV,CAAe7J,MAAM,CAACyT,EAAtB;;AAEA,cAAKC,QAAL,CAAc7J,IAAd,CAAmB7J,MAAM,CAACyT,EAA1B;;AAEA,cAAKzT,MAAL,GAAcA,MAAd;;AAEA,YAAI,MAAKA,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,YAAuBlC,kBAAvE,EAA2F;AACzF,gBAAKkC,MAAL,CAAY2T,sBAAZ;AACD,SAhC8E,CAgC7E;;;AAGF,YAAM9S,QAAQ,GAAG,MAAKC,iBAAL,CAAuBd,MAAvB,CAAjB;;AAEA,YAAIa,QAAQ,KAAKE,SAAjB,EAA4B;AAC1B,gBAAKC,SAAL,GAAiBH,QAAjB;AACD;;AAED,cAAK+S,UAAL,CAAgB,MAAKrB,MAArB,EAA6B,MAAKvR,SAAlC;AACD;AACF,KA5Cc,CAAf;;AA8CA1D,IAAAA,eAAe,gCAAO,YAAP,EAAqB,UAACuW,QAAD,EAAWhT,QAAX,EAAwB;AAC1D;AACA,UAAMK,KAAK,GAAG,IAAIzD,YAAJ,CAAiB,CAAjB,EAAoB,CAApB,EAAuBoD,QAAvB,EAAiCA,QAAjC,CAAd;AACA,UAAMM,MAAM,GAAGD,KAAK,CAACE,SAAN,CAAgB,MAAKC,SAArB,CAAf,CAH0D,CAGV;;AAEhD,UAAMC,aAAa,GAAG,IAAI5D,cAAJ,GAAqB6D,aAArB,CAAmCJ,MAAnC,CAAtB,CAL0D,CAKQ;;AAElE,UAAM2S,cAAc,GAAG,IAAI7V,iBAAJ,CAAsB;AAC3CoS,QAAAA,KAAK,EAAE,QADoC;AAE3C0D,QAAAA,GAAG,EAAE,KAFsC;AAG3CC,QAAAA,WAAW,EAAE,IAH8B;AAI3ClC,QAAAA,OAAO,EAAE;AAJkC,OAAtB,CAAvB;AAMA,UAAMmC,cAAc,GAAG,IAAIhW,iBAAJ,CAAsB;AAC3CoS,QAAAA,KAAK,EAAE,QADoC;AAE3C0D,QAAAA,GAAG,EAAE,KAFsC;AAG3CC,QAAAA,WAAW,EAAE,IAH8B;AAI3ClC,QAAAA,OAAO,EAAE;AAJkC,OAAtB,CAAvB;AAMA,UAAMoC,cAAc,GAAG,IAAIjW,iBAAJ,CAAsB;AAC3CoS,QAAAA,KAAK,EAAE,QADoC;AAE3C0D,QAAAA,GAAG,EAAE,KAFsC;AAG3CC,QAAAA,WAAW,EAAE,IAH8B;AAI3ClC,QAAAA,OAAO,EAAE;AAJkC,OAAtB,CAAvB,CAnB0D,CAwBtD;;AAEJ,UAAML,MAAM,GAAG,IAAIvT,IAAJ,CAASoD,aAAT,EAAwBwS,cAAxB,CAAf;AACA,UAAMpC,MAAM,GAAG,IAAIxT,IAAJ,CAASoD,aAAT,EAAwB2S,cAAxB,CAAf;AACA,UAAMtC,MAAM,GAAG,IAAIzT,IAAJ,CAASoD,aAAT,EAAwB4S,cAAxB,CAAf;AACA,UAAMC,QAAQ,GAAG3N,IAAI,CAACmI,EAAL,GAAU,GAA3B;AACA8C,MAAAA,MAAM,CAAC0C,QAAP,CAAgBtU,CAAhB,GAAoBsU,QAApB;AACAzC,MAAAA,MAAM,CAACyC,QAAP,CAAgBrU,CAAhB,GAAoBqU,QAApB,CA/B0D,CA+B5B;;AAE9B,YAAKC,kBAAL,CAAwBC,QAAxB,GAAmCC,WAAnC,CAA+CT,QAA/C;;AAEA,YAAKjI,iBAAL,CAAuB/B,IAAvB,CAA4B,MAAKuK,kBAAjC;;AAEA,UAAI,CAAC,MAAKpU,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,YAAuBlC,kBAApE,KAA2F,MAAKkC,MAAL,CAAYqH,IAAZ,IAAoB,CAAnH,EAAsH;AACpH;AACA,YAAMhB,IAAI,GAAG,IAAI,MAAKrG,MAAL,CAAYqH,IAA7B;;AAEA,cAAKkN,YAAL,CAAkBC,SAAlB,CAA4BnO,IAA5B,EAAkCA,IAAlC,EAAwCA,IAAxC;;AAEA,cAAK2J,kBAAL,CAAwB9D,eAAxB,CAAwC,CAAC2H,QAAQ,CAAChU,CAAlD,EAAqD,CAACgU,QAAQ,CAAC/T,CAA/D,EAAkE,CAAC+T,QAAQ,CAACjT,CAA5E;;AAEA,cAAKgL,iBAAL,CAAuBsE,WAAvB,CAAmC,MAAKF,kBAAxC,EAA4DE,WAA5D,CAAwE,MAAKqE,YAA7E;;AAEA,cAAKvE,kBAAL,CAAwB9D,eAAxB,CAAwC2H,QAAQ,CAAChU,CAAjD,EAAoDgU,QAAQ,CAAC/T,CAA7D,EAAgE+T,QAAQ,CAACjT,CAAzE;;AAEA,cAAKgL,iBAAL,CAAuBsE,WAAvB,CAAmC,MAAKF,kBAAxC;AACD;;AAED,YAAKpE,iBAAL,CAAuBuE,SAAvB,CAAiC,MAAKxP,OAAL,CAAa4G,QAA9C,EAAwD,MAAK5G,OAAL,CAAawG,UAArE,EAAiF,MAAKxG,OAAL,CAAaD,KAA9F;;AAEA,YAAKC,OAAL,CAAa8T,KAAb;;AAEA,YAAK9T,OAAL,CAAa2G,GAAb,CAAiBmK,MAAjB;;AAEA,YAAK9Q,OAAL,CAAa2G,GAAb,CAAiBoK,MAAjB;;AAEA,YAAK/Q,OAAL,CAAa2G,GAAb,CAAiBqK,MAAjB;AACD,KA7Dc,CAAf;;AA+DArU,IAAAA,eAAe,gCAAO,aAAP,EAAsB,UAACoX,IAAD,EAAO5E,KAAP,EAAc6E,YAAd,EAA4BC,WAA5B,EAA4C;AAC/E,UAAI,MAAKnL,UAAL,IAAmB,CAAC,CAAxB,EAA2B;AACzB;AACA,cAAKA,UAAL,GAAkBiL,IAAlB;AACD;;AAED,UAAI,MAAK3J,MAAL,IAAetM,KAAK,CAACU,eAAzB,EAA0C;AACxC,YAAMgN,SAAS,GAAGuI,IAAI,GAAG,MAAKjL,UAA9B;AACA,YAAMoL,QAAQ,GAAG1I,SAAS,GAAG,MAAK2I,kBAAlC;;AAEA,cAAKlJ,iBAAL,CAAuB/B,IAAvB,CAA4B+K,WAA5B;;AAEA,YAAIC,QAAQ,IAAI,CAAhB,EAAmB;AACjB;AACA,gBAAKjJ,iBAAL,CAAuBuE,SAAvB,CAAiC,MAAKxP,OAAL,CAAa4G,QAA9C,EAAwD,MAAK5G,OAAL,CAAawG,UAArE,EAAiF,MAAKxG,OAAL,CAAaD,KAA9F;;AAEA,gBAAKsM,KAAL,CAAW8C,KAAX,EAAkB,MAAKxJ,WAAvB;;AACA,gBAAKmD,UAAL,GAAkB,CAAC,CAAnB;;AACA,gBAAKlD,aAAL,CAAmB9H,KAAK,CAACC,IAAzB,EAA+B,KAA/B;;AACA,gBAAKgL,cAAL,CAAoB,KAApB;;AACA,gBAAK9H,aAAL,CAAmB1B,YAAnB;AACD,SATD,MASO;AACL,cAAMkL,MAAM,GAAG,MAAK2J,YAAL,CAAkBF,QAAlB,CAAf;;AACA,cAAMxO,IAAI,GAAG,IAAI+E,MAAJ,GAAa,MAAK9E,WAAL,GAAmB8E,MAA7C;;AAEA,gBAAKQ,iBAAL,CAAuBuE,SAAvB,CAAiC,MAAKxP,OAAL,CAAa4G,QAA9C,EAAwD,MAAK5G,OAAL,CAAawG,UAArE,EAAiF,MAAKxG,OAAL,CAAaD,KAA9F;;AAEA,gBAAKsM,KAAL,CAAW8C,KAAX,EAAkBzJ,IAAlB,EAAwB+E,MAAxB;;AACA,gBAAKxJ,aAAL,CAAmB1B,YAAnB;;AACA,cAAMoM,IAAI,gCAAV;;AACA,gBAAK/C,YAAL,GAAoBrG,MAAM,CAACqJ,qBAAP,CAA6B,UAAUC,CAAV,EAAa;AAC5DF,YAAAA,IAAI,CAACS,WAAL,CAAiBP,CAAjB,EAAoBsD,KAApB,EAA2B6E,YAA3B,EAAyCC,WAAW,CAAC9I,KAAZ,EAAzC;AACD,WAFmB,CAApB;AAGD;AACF,OA5BD,MA4BO;AACL;AACA,cAAKvC,YAAL,GAAoB,CAAC,CAArB;AACA,cAAKE,UAAL,GAAkB,CAAC,CAAnB;AACD;AACF,KAvCc,CAAf;;AAyCAnM,IAAAA,eAAe,gCAAO,gBAAP,EAAyB,UAACoX,IAAD,EAAOjI,YAAP,EAAqBuI,EAArB,EAA4B;AAClE,UAAI,MAAKvL,UAAL,IAAmB,CAAC,CAAxB,EAA2B;AACzB;AACA,cAAKY,UAAL,GAAkB,CAAlB;AACA,cAAKD,aAAL,GAAqB,CAArB;AACA,cAAKX,UAAL,GAAkBiL,IAAlB;AACD;;AAED,UAAI,MAAK3J,MAAL,IAAetM,KAAK,CAACW,gBAAzB,EAA2C;AACzC;AACA,YAAM+M,SAAS,GAAG,CAACuI,IAAI,GAAG,MAAKjL,UAAb,IAA2B,IAA7C;AACA,YAAM2C,CAAC,GAAG4I,EAAE,GAAG,CAAC,MAAKC,aAAN,GAAsB9I,SAArC;;AAEA,YAAIC,CAAC,GAAG,CAAR,EAAW;AACT;AACA,gBAAKhC,aAAL,GAAqB,MAAM,CAAC,MAAK6K,aAAZ,GAA4BzO,IAAI,CAACC,GAAL,CAAS0F,SAAT,EAAoB,CAApB,CAA5B,GAAqD6I,EAAE,GAAG7I,SAA1D,GAAsE,CAA3F;;AACA,gBAAKzE,oBAAL,CAA0B,MAAK4D,MAAL,CAAYmB,YAAZ,EAA0B,MAAKrC,aAA/B,CAA1B;;AACA,gBAAKxI,aAAL,CAAmB1B,YAAnB;;AACA,cAAMoM,IAAI,gCAAV;;AACA,gBAAK/C,YAAL,GAAoBrG,MAAM,CAACqJ,qBAAP,CAA6B,UAAUC,CAAV,EAAa;AAC5DF,YAAAA,IAAI,CAACI,cAAL,CAAoBF,CAApB,EAAuBC,YAAvB,EAAqCuI,EAArC;AACD,WAFmB,CAApB;AAGD,SATD,MASO;AACL,gBAAKzL,YAAL,GAAoB,CAAC,CAArB;AACA,gBAAKE,UAAL,GAAkB,CAAC,CAAnB;;AACA,gBAAKlD,aAAL,CAAmB9H,KAAK,CAACC,IAAzB,EAA+B,KAA/B;;AACA,gBAAKgL,cAAL,CAAoB,KAApB;;AACA,gBAAK9H,aAAL,CAAmB1B,YAAnB;AACD;AACF,OArBD,MAqBO;AACL;AACA,cAAKqJ,YAAL,GAAoB,CAAC,CAArB;AACA,cAAKE,UAAL,GAAkB,CAAC,CAAnB;;AAEA,YAAI,MAAKsB,MAAL,IAAetM,KAAK,CAACG,MAAzB,EAAiC;AAC/B,gBAAK8K,cAAL,CAAoB,KAApB;;AACA,gBAAK9H,aAAL,CAAmB1B,YAAnB;AACD;AACF;AACF,KAvCc,CAAf;;AAyCA5C,IAAAA,eAAe,gCAAO,KAAP,EAAc,UAACsR,EAAD,EAAKJ,EAAL,EAA4B;AAAA,UAAnB0G,MAAmB,uEAAV,KAAU;;AACvD,UAAI,MAAKlV,MAAL,KAAgB,IAApB,EAA0B;AACxB,YAAMmE,QAAQ,GAAGyK,EAAE,CAAC9C,KAAH,GAAWC,GAAX,CAAeyC,EAAf,CAAjB;;AAEA,YAAI,MAAKxO,MAAL,YAAuBlC,kBAAvB,IAA6C,MAAKkC,MAAL,CAAY6G,oBAA7D,EAAmF;AACjF;AACA1C,UAAAA,QAAQ,CAACiD,cAAT,CAAwB,IAAI,MAAKpH,MAAL,CAAYqH,IAAxC;AACD,SAHD,MAGO,IAAI,MAAKrH,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,CAAYwH,mBAAxD,IAA+E0N,MAAnF,EAA2F;AAChG;AACA,gBAAKlN,KAAL,CAAWC,qBAAX,CAAiC,MAAKyK,mBAAtC,EAFgG,CAEpC;;;AAG5D,gBAAK/G,KAAL,CAAW1D,qBAAX,CAAiC,MAAKmM,kBAAtC,EALgG,CAKrC;;;AAG3D,cAAMe,cAAc,GAAG,MAAKnN,KAAL,CAAWG,UAAX,CAAsB,MAAKwD,KAA3B,IAAoC,MAAK3L,MAAL,CAAYuH,QAAZ,CAAqBY,UAArB,CAAgC,MAAKxH,OAAL,CAAa4G,QAA7C,CAA3D;;AACApD,UAAAA,QAAQ,CAACiD,cAAT,CAAwB,IAAI+N,cAA5B;AACD;;AAED,cAAKnN,KAAL,CAAWoN,GAAX,CAAejR,QAAQ,CAACtE,CAAxB,EAA2BsE,QAAQ,CAACrE,CAApC,EAAuC,CAAvC,EAA0CoH,eAA1C,CAA0D,MAAKlH,MAAL,CAAYmH,UAAtE;;AAEA,cAAK8E,KAAL,CAAWC,eAAX,CAA2B,MAAKlE,KAAL,CAAWnI,CAAtC,EAAyC,MAAKmI,KAAL,CAAWlI,CAApD,EAAuD,MAAKkI,KAAL,CAAWpH,CAAlE;;AAEA,cAAKyU,yBAAL,CAA+B,MAAKpJ,KAApC,EAA2C,MAAKA,KAAhD;AACD;;AAED,aAAOlM,eAAP;AACD,KA3Bc,CAAf;;AA6BAzC,IAAAA,eAAe,gCAAO,OAAP,EAAgB,YAAM;AACnC,UAAI,MAAK0C,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,YAAuBlC,kBAAvE,EAA2F;AACzF,cAAKkC,MAAL,CAAYqH,IAAZ,GAAmB,MAAKyL,MAAxB;;AAEA,YAAI,MAAK9S,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,CAAYwH,mBAA5D,EAAiF;AAC/E,gBAAKxH,MAAL,CAAY0I,GAAZ,GAAkB,MAAK+J,KAAvB;AACD;;AAED,cAAKzS,MAAL,CAAYiT,IAAZ,GAAmB,MAAKE,QAAxB;AACA,cAAKnT,MAAL,CAAYqT,GAAZ,GAAkB,MAAKE,OAAvB;;AAEA,cAAKrL,kBAAL,CAAwB2B,IAAxB,CAA6B,MAAK6I,mBAAlC;;AAEA,cAAKxK,kBAAL,CAAwBiI,SAAxB,CAAkC,MAAKnQ,MAAL,CAAYuH,QAA9C,EAAwD,MAAKvH,MAAL,CAAYmH,UAApE,EAAgF,MAAKnH,MAAL,CAAYU,KAA5F;;AAEA,cAAKV,MAAL,CAAYyT,EAAZ,CAAe5J,IAAf,CAAoB,MAAK2J,IAAzB;;AACA,cAAKxT,MAAL,CAAYwS,YAAZ;;AACA,cAAKxS,MAAL,CAAY2T,sBAAZ;;AAEA,cAAK/H,iBAAL,CAAuB/B,IAAvB,CAA4B,MAAKuK,kBAAjC;;AAEA,cAAKA,kBAAL,CAAwBjE,SAAxB,CAAkC,MAAKxP,OAAL,CAAa4G,QAA/C,EAAyD,MAAK5G,OAAL,CAAawG,UAAtE,EAAkF,MAAKxG,OAAL,CAAaD,KAA/F;;AAEA,cAAKC,OAAL,CAAa6R,YAAb;;AAEA,YAAM3R,QAAQ,GAAG,MAAKC,iBAAL,CAAuB,MAAKd,MAA5B,CAAjB;;AAEA,YAAIa,QAAQ,KAAKE,SAAjB,EAA4B;AAC1B,gBAAKC,SAAL,GAAiBH,QAAjB;AACD;;AAED,cAAK+S,UAAL,CAAgB,MAAKjT,OAAL,CAAa4G,QAA7B,EAAuC,MAAKvG,SAA5C;;AACA,cAAKhB,MAAL,CAAYsS,MAAZ,CAAmB,MAAK3R,OAAL,CAAa4G,QAAhC;;AACA,cAAKhB,aAAL,CAAmB9H,KAAK,CAACC,IAAzB,EAA+B,KAA/B;;AACA,cAAKkD,aAAL,CAAmB1B,YAAnB;AACD;AACF,KApCc,CAAf;;AAsCA5C,IAAAA,eAAe,gCAAO,QAAP,EAAiB,UAACgY,IAAD,EAAOpK,KAAP,EAAiB;AAC/C,UAAM4E,KAAK,GAAG,MAAKnP,OAAL,CAAa4G,QAA3B,CAD+C,CACV;;AAErC,YAAKyI,kBAAL,CAAwB9D,eAAxB,CAAwC,CAAC4D,KAAK,CAACjQ,CAA/C,EAAkD,CAACiQ,KAAK,CAAChQ,CAAzD,EAA4D,CAACgQ,KAAK,CAAClP,CAAnE;;AAEA,YAAKuO,eAAL,CAAqBoG,gBAArB,CAAsCD,IAAtC,EAA4C,CAACpK,KAA7C,EAL+C,CAKM;;;AAGrD,YAAKe,KAAL,CAAWC,eAAX,CAA2B4D,KAAK,CAACjQ,CAAjC,EAAoCiQ,KAAK,CAAChQ,CAA1C,EAA6CgQ,KAAK,CAAClP,CAAnD;;AAEA,YAAKqL,KAAL,CAAWuJ,QAAX,CAAoB,MAAKrG,eAAzB;;AAEA,YAAKlD,KAAL,CAAWuJ,QAAX,CAAoB,MAAKxF,kBAAzB;;AAEA,YAAKqF,yBAAL,CAA+B,MAAKpJ,KAApC;;AACA,aAAOlM,eAAP;AACD,KAhBc,CAAf;;AAkBAzC,IAAAA,eAAe,gCAAO,WAAP,EAAoB,YAAM;AACvC,UAAI+Q,KAAJ;;AAEA,UAAI,MAAKrO,MAAL,YAAuBlC,kBAAvB,IAA6C,MAAKkC,MAAL,CAAY6G,oBAA7D,EAAmF;AACjFwH,QAAAA,KAAK,GAAGoH,IAAI,CAACC,SAAL,CAAe;AACrBC,UAAAA,YAAY,EAAE;AACZC,YAAAA,SAAS,EAAE,MAAK5V,MAAL,CAAYqT,GADX;AAEZsB,YAAAA,YAAY,EAAE,MAAK3U,MAAL,CAAY2S,MAFd;AAGZkD,YAAAA,UAAU,EAAE,MAAK7V,MAAL,CAAYiT,IAHZ;AAIZ6C,YAAAA,QAAQ,EAAE,MAAK9V,MAAL,CAAYyT,EAJV;AAKZsC,YAAAA,UAAU,EAAE,MAAK/V,MAAL,CAAYqH,IALZ;AAMZuN,YAAAA,WAAW,EAAE,MAAKjU,OAAL,CAAagS;AANd;AADO,SAAf,CAAR;AAUD,OAXD,MAWO,IAAI,MAAK3S,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,CAAYwH,mBAA5D,EAAiF;AACtF6G,QAAAA,KAAK,GAAGoH,IAAI,CAACC,SAAL,CAAe;AACrBC,UAAAA,YAAY,EAAE;AACZC,YAAAA,SAAS,EAAE,MAAK5V,MAAL,CAAYqT,GADX;AAEZ2C,YAAAA,SAAS,EAAE,MAAKhW,MAAL,CAAY0I,GAFX;AAGZiM,YAAAA,YAAY,EAAE,MAAK3U,MAAL,CAAY2S,MAHd;AAIZkD,YAAAA,UAAU,EAAE,MAAK7V,MAAL,CAAYiT,IAJZ;AAKZ6C,YAAAA,QAAQ,EAAE,MAAK9V,MAAL,CAAYyT,EALV;AAMZsC,YAAAA,UAAU,EAAE,MAAK/V,MAAL,CAAYqH,IANZ;AAOZuN,YAAAA,WAAW,EAAE,MAAKjU,OAAL,CAAagS;AAPd;AADO,SAAf,CAAR;AAWD;;AAED,UAAItE,KAAK,KAAKtN,SAAd,EAAyB;AACvBkV,QAAAA,SAAS,CAACC,SAAV,CAAoBC,SAApB,CAA8B9H,KAA9B;AACD;AACF,KA/Bc,CAAf;;AAiCA/Q,IAAAA,eAAe,gCAAO,YAAP,EAAqB,YAAM;AACxC,UAAMgP,IAAI,gCAAV;;AACA2J,MAAAA,SAAS,CAACC,SAAV,CAAoBE,QAApB,GAA+BC,IAA/B,CAAoC,SAASC,QAAT,CAAkBC,KAAlB,EAAyB;AAC3DjK,QAAAA,IAAI,CAACkK,gBAAL,CAAsBD,KAAtB;AACD,OAFD;AAGD,KALc,CAAf;;AAOAjZ,IAAAA,eAAe,gCAAO,WAAP,EAAoB,YAAM;AACvC,UAAI,MAAK0C,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,YAAuBlC,kBAAvE,EAA2F;AACzF,cAAK4U,mBAAL,CAAyB7I,IAAzB,CAA8B,MAAK7J,MAAL,CAAY2S,MAA1C;;AAEA,cAAKyB,kBAAL,CAAwBvK,IAAxB,CAA6B,MAAKlJ,OAAL,CAAagS,MAA1C;;AAEA,cAAKQ,QAAL,GAAgB,MAAKnT,MAAL,CAAYiT,IAA5B;AACA,cAAKM,OAAL,GAAe,MAAKvT,MAAL,CAAYqT,GAA3B;AACA,cAAKP,MAAL,GAAc,MAAK9S,MAAL,CAAYqH,IAA1B;;AAEA,cAAKmM,IAAL,CAAU3J,IAAV,CAAe,MAAK7J,MAAL,CAAYyT,EAA3B;;AAEA,YAAI,MAAKzT,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,CAAYwH,mBAA5D,EAAiF;AAC/E,gBAAKiL,KAAL,GAAa,MAAKzS,MAAL,CAAY0I,GAAzB;AACD;AACF;AACF,KAhBc,CAAf;;AAkBApL,IAAAA,eAAe,gCAAO,YAAP,EAAqB,UAAC+I,IAAD,EAAOyJ,KAAP,EAAqC;AAAA,UAAvB2G,WAAuB,uEAAT,IAAS;AACvE,UAAM7P,UAAU,GAAGkJ,KAAK,CAAChE,KAAN,EAAnB;AACA,UAAI4K,WAAW,GAAG,IAAIrQ,IAAtB;;AAEA,UAAI,MAAKrG,MAAL,YAAuBlC,kBAAvB,IAA6C,MAAKkC,MAAL,CAAY6G,oBAA7D,EAAmF;AACjF;AACA,cAAK7G,MAAL,CAAYqH,IAAZ,GAAmB,MAAK0L,UAAxB;AACA,cAAK/S,MAAL,CAAYqH,IAAZ,IAAoBhB,IAApB,CAHiF,CAGvD;;AAE1B,YAAI,MAAKrG,MAAL,CAAYqH,IAAZ,GAAmB,MAAKsP,OAA5B,EAAqC;AACnC,gBAAK3W,MAAL,CAAYqH,IAAZ,GAAmB,MAAKsP,OAAxB;AACAD,UAAAA,WAAW,GAAG,MAAK3D,UAAL,GAAkB,MAAK4D,OAArC;AACD,SAHD,MAGO,IAAI,MAAK3W,MAAL,CAAYqH,IAAZ,GAAmB,MAAKuP,OAA5B,EAAqC;AAC1C,gBAAK5W,MAAL,CAAYqH,IAAZ,GAAmB,MAAKuP,OAAxB;AACAF,UAAAA,WAAW,GAAG,MAAK3D,UAAL,GAAkB,MAAK6D,OAArC;AACD;;AAED,cAAK5W,MAAL,CAAY2T,sBAAZ;;AAEA,cAAK3L,KAAL,CAAWC,qBAAX,CAAiC,MAAK2D,iBAAtC,EAfiF,CAevB;AAC1D;;;AAGA,cAAK2I,YAAL,CAAkBC,SAAlB,CAA4BkC,WAA5B,EAAyCA,WAAzC,EAAsDA,WAAtD;;AAEA,cAAK1G,kBAAL,CAAwB9D,eAAxB,CAAwC,CAAC,MAAKlE,KAAL,CAAWnI,CAApD,EAAuD,CAAC,MAAKmI,KAAL,CAAWlI,CAAnE,EAAsE,CAAC,MAAKkI,KAAL,CAAWpH,CAAlF;;AAEA,cAAKiW,KAAL,CAAW3K,eAAX,CAA2B,MAAKlE,KAAL,CAAWnI,CAAtC,EAAyC,MAAKmI,KAAL,CAAWlI,CAApD,EAAuD,MAAKkI,KAAL,CAAWpH,CAAlE,EAAqE4U,QAArE,CAA8E,MAAKjB,YAAnF;;AAEA,cAAKsC,KAAL,CAAWrB,QAAX,CAAoB,MAAKxF,kBAAzB,EAzBiF,CAyBnC;;;AAG9CpJ,QAAAA,UAAU,CAACmF,GAAX,CAAe,MAAK/D,KAApB;AACA,YAAMoD,MAAM,GAAGxE,UAAU,CAACkF,KAAX,GAAmB1E,cAAnB,CAAkCsP,WAAlC,CAAf;AACA9P,QAAAA,UAAU,CAACmF,GAAX,CAAeX,MAAf;;AAEA,cAAKa,KAAL,CAAWC,eAAX,CAA2BtF,UAAU,CAAC/G,CAAtC,EAAyC+G,UAAU,CAAC9G,CAApD,EAAuD8G,UAAU,CAAChG,CAAlE;;AAEA,cAAKiW,KAAL,CAAW3G,WAAX,CAAuB,MAAKjE,KAA5B;;AAEA,cAAKoJ,yBAAL,CAA+B,MAAKpJ,KAApC,EAA2C,MAAK4K,KAAhD;;AACA,eAAO9W,eAAP;AACD,OAtCD,MAsCO,IAAI,MAAKC,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,CAAYwH,mBAA5D,EAAiF;AACtF,cAAKQ,KAAL,CAAWC,qBAAX,CAAiC,MAAKC,kBAAtC;;AAEA,cAAKyD,KAAL,CAAW1D,qBAAX,CAAiC,MAAK2D,iBAAtC,EAHsF,CAG5B;;;AAG1D,YAAIX,QAAQ,GAAG,MAAKjD,KAAL,CAAWG,UAAX,CAAsBvB,UAAtB,CAAf;;AAEA,YAAIwE,OAAM,GAAGH,QAAQ,GAAGA,QAAQ,GAAGyL,WAAnC,CARsF,CAQtC;;;AAEhD,YAAM1N,WAAW,GAAGiC,QAAQ,GAAGG,OAA/B;;AAEA,YAAIpC,WAAW,GAAG,MAAKV,WAAvB,EAAoC;AAClCoO,UAAAA,WAAW,GAAG,MAAKpO,WAAL,GAAmB2C,QAAjC;AACAG,UAAAA,OAAM,GAAGH,QAAQ,GAAGA,QAAQ,GAAGyL,WAA/B;AACD,SAHD,MAGO,IAAI1N,WAAW,GAAG,MAAKT,WAAvB,EAAoC;AACzCmO,UAAAA,WAAW,GAAG,MAAKnO,WAAL,GAAmB0C,QAAjC;AACAG,UAAAA,OAAM,GAAGH,QAAQ,GAAGA,QAAQ,GAAGyL,WAA/B;AACD;;AAED,YAAI7K,SAAS,GAAGjF,UAAU,CAACkF,KAAX,GAAmBC,GAAnB,CAAuB,MAAK/D,KAA5B,EAAmCgE,SAAnC,GAA+C5E,cAA/C,CAA8DgE,OAA9D,CAAhB;;AAEA,cAAKa,KAAL,CAAWC,eAAX,CAA2BL,SAAS,CAAChM,CAArC,EAAwCgM,SAAS,CAAC/L,CAAlD,EAAqD+L,SAAS,CAACjL,CAA/D;;AAEA,YAAI6V,WAAJ,EAAiB;AACf;AACA,cAAMK,GAAG,GAAG,MAAKnL,KAAjB;AACAV,UAAAA,QAAQ,GAAG6L,GAAG,CAAC3O,UAAJ,CAAevB,UAAf,CAAX;AACAwE,UAAAA,OAAM,GAAGH,QAAQ,GAAGA,QAAQ,GAAGyL,WAA/B;AACA7K,UAAAA,SAAS,GAAGjF,UAAU,CAACkF,KAAX,GAAmBC,GAAnB,CAAuB,MAAKJ,KAA5B,EAAmCK,SAAnC,GAA+C5E,cAA/C,CAA8DgE,OAA9D,CAAZ;;AAEA,gBAAK4E,kBAAL,CAAwB9D,eAAxB,CAAwC4K,GAAG,CAACjX,CAA5C,EAA+CiX,GAAG,CAAChX,CAAnD,EAAsDgX,GAAG,CAAClW,CAA1D;;AAEA,gBAAK2T,YAAL,CAAkBC,SAAlB,CAA4BkC,WAA5B,EAAyCA,WAAzC,EAAsDA,WAAtD;;AAEA,gBAAKG,KAAL,CAAW3K,eAAX,CAA2BL,SAAS,CAAChM,CAArC,EAAwCgM,SAAS,CAAC/L,CAAlD,EAAqD+L,SAAS,CAACjL,CAA/D,EAAkE4U,QAAlE,CAA2E,MAAKxF,kBAAhF;;AAEA,gBAAK6G,KAAL,CAAWrB,QAAX,CAAoB,MAAKjB,YAAzB;;AAEA,gBAAKvE,kBAAL,CAAwB9D,eAAxB,CAAwC,CAAC4K,GAAG,CAACjX,CAA7C,EAAgD,CAACiX,GAAG,CAAChX,CAArD,EAAwD,CAACgX,GAAG,CAAClW,CAA7D;;AAEA,gBAAKiW,KAAL,CAAWrB,QAAX,CAAoB,MAAKxF,kBAAzB;;AAEA,gBAAKqF,yBAAL,CAA+B,MAAKpJ,KAApC,EAA2C,MAAK4K,KAAhD;AACD,SApBD,MAoBO;AACL,gBAAKxB,yBAAL,CAA+B,MAAKpJ,KAApC;AACD;;AAED,eAAOlM,eAAP;AACD;AACF,KA5Fc,CAAf;;AA8FAzC,IAAAA,eAAe,gCAAO,QAAP,EAAiB,UAAAiZ,KAAK,EAAI;AACvC,UAAI,MAAKvW,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,CAAYwH,mBAA5D,EAAiF;AAC/E,cAAKxH,MAAL,CAAY0I,GAAZ,GAAkB7K,SAAS,CAACwK,KAAV,CAAgBkO,KAAhB,EAAuB,MAAKxN,MAA5B,EAAoC,MAAKD,MAAzC,CAAlB;;AACA,cAAK9I,MAAL,CAAY2T,sBAAZ;AACD;AACF,KALc,CAAf;;AAOArW,IAAAA,eAAe,gCAAO,WAAP,EAAoB,UAACuC,CAAD,EAAIC,CAAJ,EAAOc,CAAP,EAAa;AAC9C,UAAI,MAAKZ,MAAL,KAAgB,IAApB,EAA0B;AACxB,cAAKuS,MAAL,CAAY6C,GAAZ,CAAgBvV,CAAhB,EAAmBC,CAAnB,EAAsBc,CAAtB;;AAEA,cAAKD,OAAL,CAAa4G,QAAb,CAAsB6N,GAAtB,CAA0BvV,CAA1B,EAA6BC,CAA7B,EAAgCc,CAAhC,EAHwB,CAGY;;;AAGpC,YAAMC,QAAQ,GAAG,MAAKC,iBAAL,CAAuB,MAAKd,MAA5B,CAAjB;;AAEA,YAAIa,QAAQ,KAAKE,SAAjB,EAA4B;AAC1B,gBAAKC,SAAL,GAAiBH,QAAjB;AACD;;AAED,cAAK+S,UAAL,CAAgB,MAAKrB,MAArB,EAA6B,MAAKvR,SAAlC;;AACA,cAAKhB,MAAL,CAAYsS,MAAZ,CAAmB,MAAKC,MAAxB;AACD;AACF,KAhBc,CAAf;;AAkBAjV,IAAAA,eAAe,gCAAO,SAAP,EAAkB,UAACwS,KAAD,EAAQ5E,KAAR,EAAkB;AACjD,YAAKiE,eAAL,CAAqBoG,gBAArB,CAAsC,MAAKjI,aAA3C,EAA0DpC,KAA1D;;AAEA,YAAK8E,kBAAL,CAAwB9D,eAAxB,CAAwC,CAAC4D,KAAK,CAACjQ,CAA/C,EAAkD,CAACiQ,KAAK,CAAChQ,CAAzD,EAA4D,CAACgQ,KAAK,CAAClP,CAAnE;;AAEA,YAAKqL,KAAL,CAAWC,eAAX,CAA2B4D,KAAK,CAACjQ,CAAjC,EAAoCiQ,KAAK,CAAChQ,CAA1C,EAA6CgQ,KAAK,CAAClP,CAAnD;;AAEA,YAAKqL,KAAL,CAAWuJ,QAAX,CAAoB,MAAKrG,eAAzB;;AAEA,YAAKlD,KAAL,CAAWuJ,QAAX,CAAoB,MAAKxF,kBAAzB;;AAEA,YAAKhI,KAAL,CAAWC,qBAAX,CAAiC,MAAK2D,iBAAtC,EAAyDG,GAAzD,CAA6D+D,KAA7D,EAXiD,CAWoB;;;AAGrE,YAAKnE,KAAL,CAAW9B,IAAX,CAAgB,MAAK7B,KAArB,EAA4B+O,cAA5B,CAA2C,MAAKzJ,aAAhD,EAA+DpC,KAA/D,EAdiD,CAcsB;;;AAGvE,YAAKS,KAAL,CAAWI,GAAX,CAAe,MAAK/D,KAApB;;AAEA,YAAK6O,KAAL,CAAW3K,eAAX,CAA2B,MAAKP,KAAL,CAAW9L,CAAtC,EAAyC,MAAK8L,KAAL,CAAW7L,CAApD,EAAuD,MAAK6L,KAAL,CAAW/K,CAAlE;;AAEA,YAAKyU,yBAAL,CAA+B,MAAKpJ,KAApC,EAA2C,MAAK4K,KAAhD;;AACA,aAAO9W,eAAP;AACD,KAvBc,CAAf;;AAyBAzC,IAAAA,eAAe,gCAAO,gBAAP,EAAyB,UAAC0Z,MAAD,EAAShX,MAAT,EAAoB;AAC1D,UAAI,CAACA,MAAM,YAAYpC,iBAAlB,IAAuCoC,MAAM,YAAYlC,kBAA1D,KAAiF,MAAK2C,KAAL,IAAc,IAAnG,EAAyG;AACvG,YAAMwW,SAAS,GAAG,IAAI9Y,SAAJ,EAAlB;AACA8Y,QAAAA,SAAS,CAAChE,IAAV,GAAiBjT,MAAM,CAACiT,IAAxB;AACAgE,QAAAA,SAAS,CAAC5D,GAAV,GAAgBrT,MAAM,CAACqT,GAAvB;AACA4D,QAAAA,SAAS,CAACC,aAAV,CAAwBF,MAAxB,EAAgChX,MAAhC;AACA,YAAMmX,SAAS,GAAGF,SAAS,CAACG,gBAAV,CAA2B,MAAK3W,KAAL,CAAWgB,QAAtC,EAAgD,IAAhD,CAAlB;;AAEA,aAAK,IAAIM,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGoV,SAAS,CAAClV,MAA9B,EAAsCF,CAAC,EAAvC,EAA2C;AACzC,cAAIoV,SAAS,CAACpV,CAAD,CAAT,CAAasV,MAAb,CAAoBC,IAApB,IAA4B,MAAK3W,OAAL,CAAa2W,IAAzC,IAAiDH,SAAS,CAACpV,CAAD,CAAT,CAAawV,IAAb,IAAqB,IAA1E,EAAgF;AAC9E,mBAAOJ,SAAS,CAACpV,CAAD,CAAT,CAAa+N,KAAb,CAAmBhE,KAAnB,EAAP;AACD;AACF;AACF;;AAED,aAAO,IAAP;AACD,KAhBc,CAAf;;AAkBAxO,IAAAA,eAAe,gCAAO,sBAAP,EAA+B,UAAC0C,MAAD,EAAS+R,OAAT,EAAkBC,OAAlB,EAA2BC,MAA3B,EAAmCpR,QAAnC,EAAgD;AAC5F,UAAIb,MAAM,CAACG,IAAP,IAAe,oBAAnB,EAAyC;AACvC,cAAKiS,KAAL,CAAWvI,IAAX,CAAgB,MAAK2N,iBAAL,CAAuBzF,OAAvB,EAAgCC,OAAhC,EAAyCC,MAAzC,CAAhB;;AAEA,cAAKjK,KAAL,CAAWoN,GAAX,CAAe,MAAKhD,KAAL,CAAWvS,CAA1B,EAA6B,MAAKuS,KAAL,CAAWtS,CAAxC,EAA2C,CAA3C;;AAEA,YAAM2X,EAAE,GAAGjR,IAAI,CAACC,GAAL,CAAS,MAAK2L,KAAL,CAAWvS,CAApB,EAAuB,CAAvB,CAAX;AACA,YAAM6X,EAAE,GAAGlR,IAAI,CAACC,GAAL,CAAS,MAAK2L,KAAL,CAAWtS,CAApB,EAAuB,CAAvB,CAAX;AACA,YAAM6X,EAAE,GAAGnR,IAAI,CAACC,GAAL,CAAS,MAAKzF,SAAd,EAAyB,CAAzB,CAAX;;AAEA,YAAIyW,EAAE,GAAGC,EAAL,IAAWC,EAAE,GAAG,GAApB,EAAyB;AACvB;AACA,gBAAK3P,KAAL,CAAW4P,IAAX,CAAgBpR,IAAI,CAACwI,IAAL,CAAU2I,EAAE,IAAIF,EAAE,GAAGC,EAAT,CAAZ,CAAhB;AACD,SAHD,MAGO;AACL;AACA,gBAAK1P,KAAL,CAAW4P,IAAX,CAAgBD,EAAE,GAAG,GAAL,GAAWnR,IAAI,CAACwI,IAAL,CAAUyI,EAAE,GAAGC,EAAf,CAA3B;AACD;;AAED,eAAO,MAAK1P,KAAZ;AACD,OAlBD,MAkBO,IAAIhI,MAAM,CAACG,IAAP,IAAe,mBAAnB,EAAwC;AAC7C;AACA,cAAKiS,KAAL,CAAWvI,IAAX,CAAgB,MAAKc,YAAL,CAAkBoH,OAAlB,EAA2BC,OAA3B,EAAoCC,MAApC,CAAhB;;AAEA,cAAKjK,KAAL,CAAWoN,GAAX,CAAe,MAAKhD,KAAL,CAAWvS,CAA1B,EAA6B,MAAKuS,KAAL,CAAWtS,CAAxC,EAA2C,CAAC,CAA5C;;AAEA,cAAKkI,KAAL,CAAW6P,YAAX,CAAwB7X,MAAM,CAAC8X,uBAA/B;;AAEA,YAAMnO,MAAM,GAAG,MAAK3B,KAAL,CAAW8D,KAAX,GAAmBE,SAAnB,EAAf,CAR6C,CAQE;;;AAG/C,YAAM+L,mBAAmB,GAAG/X,MAAM,CAACuH,QAAP,CAAgBY,UAAhB,CAA2B,MAAKxH,OAAL,CAAa4G,QAAxC,CAA5B;AACA,YAAMyQ,OAAO,GAAGxR,IAAI,CAACC,GAAL,CAAS5F,QAAT,EAAmB,CAAnB,CAAhB,CAZ6C,CAYN;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,YAAMoX,CAAC,GAAG,MAAKjQ,KAAL,CAAWpH,CAArB;AACA,YAAMsX,CAAC,GAAG1R,IAAI,CAACwI,IAAL,CAAUxI,IAAI,CAACC,GAAL,CAAS,MAAKuB,KAAL,CAAWnI,CAApB,EAAuB,CAAvB,IAA4B2G,IAAI,CAACC,GAAL,CAAS,MAAKuB,KAAL,CAAWlI,CAApB,EAAuB,CAAvB,CAAtC,CAAV;;AAEA,YAAIoY,CAAC,IAAI,CAAT,EAAY;AACV;AACAvO,UAAAA,MAAM,CAACyL,GAAP,CAAW,MAAKpN,KAAL,CAAWnI,CAAtB,EAAyB,MAAKmI,KAAL,CAAWlI,CAApC,EAAuCe,QAAvC;AACA,iBAAO8I,MAAP;AACD;;AAED,YAAMwO,CAAC,GAAGF,CAAC,GAAGC,CAAd;AACA,YAAME,CAAC,GAAGL,mBAAV;AACA;AACR;AACA;AACA;AACA;AACA;AACA;;AAEQ,YAAIM,CAAC,GAAG7R,IAAI,CAACC,GAAL,CAAS0R,CAAT,EAAY,CAAZ,IAAiB,CAAzB;AACA,YAAIG,CAAC,GAAG,IAAIH,CAAJ,GAAQC,CAAhB;AACA,YAAIG,CAAC,GAAG/R,IAAI,CAACC,GAAL,CAAS2R,CAAT,EAAY,CAAZ,IAAiBJ,OAAzB;AACA,YAAIQ,KAAK,GAAGhS,IAAI,CAACC,GAAL,CAAS6R,CAAT,EAAY,CAAZ,IAAiB,IAAID,CAAJ,GAAQE,CAArC;;AAEA,YAAIC,KAAK,IAAI,CAAb,EAAgB;AACd;AACA,gBAAKpG,KAAL,CAAWC,IAAX,CAAgB,CAAC,CAACiG,CAAD,GAAK9R,IAAI,CAACwI,IAAL,CAAUwJ,KAAV,CAAN,KAA2B,IAAIH,CAA/B,CAAhB;;AAEA,gBAAKjG,KAAL,CAAW1H,IAAX,CAAgByN,CAAC,GAAG,MAAK/F,KAAL,CAAWvS,CAAf,GAAmBuY,CAAnC;;AAEA,cAAMlN,KAAK,GAAGrN,SAAS,CAAC+K,OAAV,GAAoB,MAAKwJ,KAAL,CAAWlH,KAAX,EAAlC;;AAEA,cAAIA,KAAK,IAAI,EAAb,EAAiB;AACf;AACA;AACA,gBAAMuN,UAAS,GAAGjS,IAAI,CAACwI,IAAL,CAAUxI,IAAI,CAACC,GAAL,CAAS,MAAK2L,KAAL,CAAWvS,CAApB,EAAuB,CAAvB,IAA4B2G,IAAI,CAACC,GAAL,CAASsR,mBAAmB,GAAG,MAAK3F,KAAL,CAAWtS,CAA1C,EAA6C,CAA7C,CAAtC,CAAlB;;AACA6J,YAAAA,MAAM,CAACvC,cAAP,CAAsBqR,UAAtB;AACA9O,YAAAA,MAAM,CAAC/I,CAAP,IAAYmX,mBAAZ;AACA,mBAAOpO,MAAP;AACD;AACF,SA9D4C,CA8D3C;;AAEF;AACR;AACA;AACA;AACA;AACA;;;AAGQ0O,QAAAA,CAAC,GAAGF,CAAJ;AACAG,QAAAA,CAAC,GAAGF,CAAJ;AACAG,QAAAA,CAAC,GAAG,CAACP,OAAD,GAAW,GAAf;AACAQ,QAAAA,KAAK,GAAGhS,IAAI,CAACC,GAAL,CAAS6R,CAAT,EAAY,CAAZ,IAAiB,IAAID,CAAJ,GAAQE,CAAjC;;AAEA,cAAKnG,KAAL,CAAWC,IAAX,CAAgB,CAAC,CAACiG,CAAD,GAAK9R,IAAI,CAACwI,IAAL,CAAUwJ,KAAV,CAAN,KAA2B,IAAIH,CAA/B,CAAhB;;AAEA,cAAKjG,KAAL,CAAW1H,IAAX,CAAgByN,CAAC,GAAG,MAAK/F,KAAL,CAAWvS,CAAf,GAAmBuY,CAAnC;;AAEA,YAAMK,SAAS,GAAGjS,IAAI,CAACwI,IAAL,CAAUxI,IAAI,CAACC,GAAL,CAAS,MAAK2L,KAAL,CAAWvS,CAApB,EAAuB,CAAvB,IAA4B2G,IAAI,CAACC,GAAL,CAASsR,mBAAmB,GAAG,MAAK3F,KAAL,CAAWtS,CAA1C,EAA6C,CAA7C,CAAtC,CAAlB;AACA6J,QAAAA,MAAM,CAACvC,cAAP,CAAsBqR,SAAtB;AACA9O,QAAAA,MAAM,CAAC/I,CAAP,IAAYmX,mBAAZ;AACA,eAAOpO,MAAP;AACD;AACF,KAzGc,CAAf;;AA2GArM,IAAAA,eAAe,gCAAO,oBAAP,EAA6B,UAAC0C,MAAD,EAAS+R,OAAT,EAAkBC,OAAlB,EAA2BC,MAA3B,EAA+D;AAAA,UAA5ByG,eAA4B,uEAAV,KAAU;;AACzG,UAAI1Y,MAAM,CAACG,IAAP,IAAe,oBAAnB,EAAyC;AACvC,cAAKiS,KAAL,CAAWvI,IAAX,CAAgB,MAAK2N,iBAAL,CAAuBzF,OAAvB,EAAgCC,OAAhC,EAAyCC,MAAzC,CAAhB;;AAEA,cAAKjK,KAAL,CAAWoN,GAAX,CAAe,MAAKhD,KAAL,CAAWvS,CAA1B,EAA6B,MAAKuS,KAAL,CAAWtS,CAAxC,EAA2C,CAA3C;;AAEA,eAAO,MAAKkI,KAAL,CAAW8D,KAAX,EAAP;AACD,OAND,MAMO,IAAI9L,MAAM,CAACG,IAAP,IAAe,mBAAnB,EAAwC;AAC7C,cAAKiS,KAAL,CAAWvI,IAAX,CAAgB,MAAKc,YAAL,CAAkBoH,OAAlB,EAA2BC,OAA3B,EAAoCC,MAApC,CAAhB,EAD6C,CACiB;;;AAG9D,cAAKjK,KAAL,CAAWoN,GAAX,CAAe,MAAKhD,KAAL,CAAWvS,CAA1B,EAA6B,MAAKuS,KAAL,CAAWtS,CAAxC,EAA2C,CAAC,CAA5C;;AAEA,cAAKkI,KAAL,CAAW6P,YAAX,CAAwB7X,MAAM,CAAC8X,uBAA/B;;AAEA,YAAMnO,MAAM,GAAG,MAAK3B,KAAL,CAAW8D,KAAX,GAAmBE,SAAnB,EAAf,CAR6C,CAQE;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA,YAAMiM,CAAC,GAAG,MAAKjQ,KAAL,CAAWpH,CAArB;AACA,YAAMsX,CAAC,GAAG1R,IAAI,CAACwI,IAAL,CAAUxI,IAAI,CAACC,GAAL,CAAS,MAAKuB,KAAL,CAAWnI,CAApB,EAAuB,CAAvB,IAA4B2G,IAAI,CAACC,GAAL,CAAS,MAAKuB,KAAL,CAAWlI,CAApB,EAAuB,CAAvB,CAAtC,CAAV;AACA,YAAIiY,mBAAJ;;AAEA,YAAIW,eAAJ,EAAqB;AACnBX,UAAAA,mBAAmB,GAAG,MAAK/P,KAAL,CAAWC,qBAAX,CAAiC,MAAKyK,mBAAtC,EAA2DvK,UAA3D,CAAsE,MAAKwD,KAAL,CAAW1D,qBAAX,CAAiC,MAAKmM,kBAAtC,CAAtE,CAAtB;AACD,SAFD,MAEO;AACL2D,UAAAA,mBAAmB,GAAG/X,MAAM,CAACuH,QAAP,CAAgBY,UAAhB,CAA2B,MAAKxH,OAAL,CAAa4G,QAAxC,CAAtB;AACD;AACD;AACR;AACA;AACA;AACA;AACA;AACA;;;AAGQ,YAAI2Q,CAAC,IAAI,CAAT,EAAY;AACV;AACAvO,UAAAA,MAAM,CAACyL,GAAP,CAAW,CAAX,EAAc,CAAd,EAAiB,CAAjB;AACA,iBAAOzL,MAAP;AACD;;AAED,YAAMwO,CAAC,GAAGF,CAAC,GAAGC,CAAd;AACA,YAAME,CAAC,GAAGL,mBAAV;AACA,YAAMlY,CAAC,GAAG,CAACuY,CAAD,GAAKD,CAAf;AACA,YAAMM,SAAS,GAAGjS,IAAI,CAACwI,IAAL,CAAUxI,IAAI,CAACC,GAAL,CAAS2R,CAAT,EAAY,CAAZ,IAAiB5R,IAAI,CAACC,GAAL,CAAS5G,CAAT,EAAY,CAAZ,CAA3B,CAAlB;AACA8J,QAAAA,MAAM,CAACvC,cAAP,CAAsBqR,SAAtB;AACA9O,QAAAA,MAAM,CAAC/I,CAAP,GAAW,CAAX;AACA,eAAO+I,MAAP;AACD;AACF,KA3Dc,CAAf;;AA6DArM,IAAAA,eAAe,gCAAO,mBAAP,EAA4B,YAAM;AAC/C,UAAI,MAAK0C,MAAL,KAAgB,IAApB,EAA0B;AACxB;AACA,cAAKkI,kBAAL,CAAwB2B,IAAxB,CAA6B,MAAK7J,MAAL,CAAY2S,MAAzC;;AAEA,cAAK/G,iBAAL,CAAuB/B,IAAvB,CAA4B,MAAKlJ,OAAL,CAAagS,MAAzC;;AAEA,YAAI,MAAK3S,MAAL,YAAuBlC,kBAAvB,IAA6C,MAAKkC,MAAL,CAAY6G,oBAA7D,EAAmF;AACjF,gBAAK+L,sBAAL,CAA4B/I,IAA5B,CAAiC,MAAK7J,MAAL,CAAY6S,gBAA7C;;AAEA,gBAAK7S,MAAL,CAAY2T,sBAAZ;;AACA,gBAAKZ,UAAL,GAAkB,MAAK/S,MAAL,CAAYqH,IAA9B;AACD,SALD,MAKO,IAAI,MAAKrH,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,CAAYwH,mBAA5D,EAAiF;AACtF,gBAAKkE,SAAL,GAAiB,MAAK1L,MAAL,CAAY0I,GAA7B;AACD;AACF;AACF,KAhBc,CAAf;;AAkBApL,IAAAA,eAAe,gCAAO,eAAP,EAAwB,UAACqb,QAAD,EAAWC,cAAX,EAA8B;AACnE,YAAK7N,MAAL,GAAc4N,QAAd;;AAEA,UAAIC,cAAJ,EAAoB;AAClB,cAAKC,iBAAL;AACD;AACF,KANc,CAAf;;AAQAvb,IAAAA,eAAe,gCAAO,QAAP,EAAiB,YAAM;AACpC,UAAIwb,aAAJ;;AAEA,UAAMC,GAAG,GAAG,QAAZ,CAHoC,CAGd;;AAEtB,UAAI,CAAC,MAAKxG,MAAL,CAAYyG,MAAZ,CAAmB,MAAKC,cAAxB,CAAD,IAA4C,MAAKjZ,MAAL,KAAgB,IAAhE,EAAsE;AACpE,cAAKW,OAAL,CAAa4G,QAAb,CAAsB6N,GAAtB,CAA0B,MAAK7C,MAAL,CAAY1S,CAAtC,EAAyC,MAAK0S,MAAL,CAAYzS,CAArD,EAAwD,MAAKyS,MAAL,CAAY3R,CAApE,EADoE,CACI;;;AAGxE,YAAMC,QAAQ,GAAG,MAAKC,iBAAL,CAAuB,MAAKd,MAA5B,CAAjB;;AAEA,YAAIa,QAAQ,KAAKE,SAAjB,EAA4B;AAC1B,gBAAKC,SAAL,GAAiBH,QAAjB;AACD;;AAED,cAAK+S,UAAL,CAAgB,MAAKrB,MAArB,EAA6B,MAAKvR,SAAlC;;AAEA,cAAKiY,cAAL,CAAoBpP,IAApB,CAAyB,MAAK0I,MAA9B;AACD,OAlBmC,CAkBlC;;;AAGF,UAAI,MAAKvS,MAAL,YAAuBlC,kBAAvB,IAA6C,MAAKkC,MAAL,CAAY6G,oBAA7D,EAAmF;AACjF;AACA,YAAI,MAAK7G,MAAL,CAAYqH,IAAZ,GAAmB,MAAKsP,OAAxB,IAAmC,MAAK3W,MAAL,CAAYqH,IAAZ,GAAmB,MAAKuP,OAA/D,EAAwE;AACtE,cAAMsC,OAAO,GAAGrb,SAAS,CAACwK,KAAV,CAAgB,MAAKrI,MAAL,CAAYqH,IAA5B,EAAkC,MAAKuP,OAAvC,EAAgD,MAAKD,OAArD,CAAhB;;AACA,gBAAKjP,oBAAL,CAA0B,MAAKC,UAAL,CAAgBuR,OAAO,GAAG,MAAKlZ,MAAL,CAAYqH,IAAtC,EAA4C,MAAK1G,OAAL,CAAa4G,QAAzD,EAAmE,IAAnE,CAA1B;AACD;AACF,OAND,MAMO,IAAI,MAAKvH,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,CAAYwH,mBAA5D,EAAiF;AACtF;AACA,YAAMyD,QAAQ,GAAG,MAAKjL,MAAL,CAAYuH,QAAZ,CAAqBY,UAArB,CAAgC,MAAKxH,OAAL,CAAa4G,QAA7C,CAAjB;;AAEA,YAAI0D,QAAQ,GAAG,MAAK1C,WAAL,GAAmBwQ,GAA9B,IAAqC9N,QAAQ,GAAG,MAAK3C,WAAL,GAAmByQ,GAAvE,EAA4E;AAC1E,cAAM/P,WAAW,GAAGnL,SAAS,CAACwK,KAAV,CAAgB4C,QAAhB,EAA0B,MAAK3C,WAA/B,EAA4C,MAAKC,WAAjD,CAApB;;AACA,gBAAKb,oBAAL,CAA0B,MAAKC,UAAL,CAAgBqB,WAAW,GAAGiC,QAA9B,EAAwC,MAAKtK,OAAL,CAAa4G,QAArD,CAA1B;;AACA,gBAAKsR,iBAAL;AACD,SARqF,CAQpF;;;AAGF,YAAI,MAAK7Y,MAAL,CAAY0I,GAAZ,GAAkB,MAAKK,MAAvB,IAAiC,MAAK/I,MAAL,CAAY0I,GAAZ,GAAkB,MAAKI,MAA5D,EAAoE;AAClE,gBAAK9I,MAAL,CAAY0I,GAAZ,GAAkB7K,SAAS,CAACwK,KAAV,CAAgB,MAAKrI,MAAL,CAAY0I,GAA5B,EAAiC,MAAKK,MAAtC,EAA8C,MAAKD,MAAnD,CAAlB;;AACA,gBAAK9I,MAAL,CAAY2T,sBAAZ;AACD;;AAED,YAAMwF,SAAS,GAAG,MAAKnY,SAAvB;;AACA,YAAMH,SAAQ,GAAG,MAAKC,iBAAL,CAAuB,MAAKd,MAA5B,CAAjB;;AAEA,YAAIa,SAAQ,KAAKE,SAAjB,EAA4B;AAC1B,gBAAKC,SAAL,GAAiBH,SAAjB;AACD;;AAED,YAAIsY,SAAS,GAAG,MAAKnY,SAAL,GAAiB+X,GAA7B,IAAoCI,SAAS,GAAG,MAAKnY,SAAL,GAAiB+X,GAArE,EAA0E;AACxE,cAAMrY,KAAK,GAAG,CAAC,MAAKC,OAAL,CAAaD,KAAb,CAAmBb,CAAnB,GAAuB,MAAKc,OAAL,CAAaD,KAAb,CAAmBZ,CAA1C,GAA8C,MAAKa,OAAL,CAAaD,KAAb,CAAmBE,CAAlE,IAAuE,CAArF;AACA,cAAMK,SAAS,GAAG,MAAKD,SAAL,GAAiBN,KAAnC,CAFwE,CAE9B;;AAE1C,cAAMQ,KAAK,GAAG,IAAIzD,YAAJ,CAAiB,CAAjB,EAAoB,CAApB,EAAuBwD,SAAvB,EAAkCA,SAAlC,CAAd;AACA,cAAME,MAAM,GAAGD,KAAK,CAACE,SAAN,CAAgB,MAAKC,SAArB,CAAf;AACA,cAAMC,aAAa,GAAG,IAAI5D,cAAJ,GAAqB6D,aAArB,CAAmCJ,MAAnC,CAAtB;;AAEA,eAAK,IAAMK,KAAX,IAAoB,MAAKb,OAAL,CAAac,QAAjC,EAA2C;AACzC,gBAAMC,KAAK,GAAG,MAAKf,OAAL,CAAac,QAAb,CAAsBD,KAAtB,CAAd;;AAEA,gBAAIE,KAAK,YAAY/D,IAArB,EAA2B;AACzB+D,cAAAA,KAAK,CAACC,QAAN,GAAiBL,aAAjB;AACD;AACF;AACF;AACF;;AAED,OAACwX,aAAa,GAAG,MAAK9Y,MAAtB,MAAkC,IAAlC,IAA0C8Y,aAAa,KAAK,KAAK,CAAjE,GAAqE,KAAK,CAA1E,GAA8EA,aAAa,CAACxG,MAAd,CAAqB,MAAK3R,OAAL,CAAa4G,QAAlC,CAA9E;AACD,KArEc,CAAf;;AAuEAjK,IAAAA,eAAe,gCAAO,kBAAP,EAA2B,UAAA8b,IAAI,EAAI;AAChD,UAAM/K,KAAK,GAAGoH,IAAI,CAAC4D,KAAL,CAAWD,IAAX,CAAd;;AAEA,UAAI/K,KAAK,CAACsH,YAAN,IAAsB5U,SAAtB,KAAoC,MAAKf,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,YAAuBlC,kBAAvG,CAAJ,EAAgI;AAC9H,cAAKoK,kBAAL,CAAwBoR,SAAxB,CAAkCjL,KAAK,CAACsH,YAAN,CAAmBhB,YAAnB,CAAgC4E,QAAlE;;AAEA,cAAKrR,kBAAL,CAAwBiI,SAAxB,CAAkC,MAAKnQ,MAAL,CAAYuH,QAA9C,EAAwD,MAAKvH,MAAL,CAAYmH,UAApE,EAAgF,MAAKnH,MAAL,CAAYU,KAA5F;;AAEA,cAAKV,MAAL,CAAYyT,EAAZ,CAAe5J,IAAf,CAAoBwE,KAAK,CAACsH,YAAN,CAAmBG,QAAvC;;AACA,cAAK9V,MAAL,CAAYiT,IAAZ,GAAmB5E,KAAK,CAACsH,YAAN,CAAmBE,UAAtC;AACA,cAAK7V,MAAL,CAAYqT,GAAZ,GAAkBhF,KAAK,CAACsH,YAAN,CAAmBC,SAArC;AACA,cAAK5V,MAAL,CAAYqH,IAAZ,GAAmBgH,KAAK,CAACsH,YAAN,CAAmBI,UAAtC;;AAEA,YAAI,MAAK/V,MAAL,YAAuBpC,iBAAvB,IAA4C,MAAKoC,MAAL,CAAYwH,mBAA5D,EAAiF;AAC/E,gBAAKxH,MAAL,CAAY0I,GAAZ,GAAkB2F,KAAK,CAACsH,YAAN,CAAmBK,SAArC;AACD;;AAED,cAAKpK,iBAAL,CAAuB0N,SAAvB,CAAiCjL,KAAK,CAACsH,YAAN,CAAmBf,WAAnB,CAA+B2E,QAAhE;;AAEA,cAAK3N,iBAAL,CAAuBuE,SAAvB,CAAiC,MAAKxP,OAAL,CAAa4G,QAA9C,EAAwD,MAAK5G,OAAL,CAAawG,UAArE,EAAiF,MAAKxG,OAAL,CAAaD,KAA9F;;AAEA,cAAKV,MAAL,CAAYwS,YAAZ;;AACA,cAAKxS,MAAL,CAAY2T,sBAAZ;;AAEA,cAAKhT,OAAL,CAAa6R,YAAb;;AAEA,YAAM3R,QAAQ,GAAG,MAAKC,iBAAL,CAAuB,MAAKd,MAA5B,CAAjB;;AAEA,YAAIa,QAAQ,KAAKE,SAAjB,EAA4B;AAC1B,gBAAKC,SAAL,GAAiBH,QAAjB;AACD;;AAED,YAAM2Y,QAAQ,GAAG,IAAIjc,OAAJ,GAAcsM,IAAd,CAAmB,MAAKuK,kBAAxB,CAAjB;;AACA,cAAKR,UAAL,CAAgB,MAAKjT,OAAL,CAAa4G,QAA7B,EAAuC,MAAKvG,SAA5C;;AAEA,cAAKoT,kBAAL,CAAwBvK,IAAxB,CAA6B2P,QAA7B;;AAEA,cAAKxZ,MAAL,CAAYsS,MAAZ,CAAmB,MAAK3R,OAAL,CAAa4G,QAAhC;;AACA,cAAKhB,aAAL,CAAmB9H,KAAK,CAACC,IAAzB,EAA+B,KAA/B;;AACA,cAAKkD,aAAL,CAAmB1B,YAAnB;AACD;AACF,KAzCc,CAAf;;AA2CA,UAAKF,MAAL,GAAc,IAAd;AACA,UAAKQ,UAAL,GAAkBA,UAAlB;AACA,UAAKC,KAAL,GAAaA,KAAb;AACA,UAAKuB,YAAL,GAAoB,EAApB;AACA,UAAK8B,QAAL,GAAgB,IAAhB,CA5zE6C,CA4zEvB;;AAEtB,UAAKsO,KAAL,GAAa,IAAIhU,OAAJ,EAAb;AACA,UAAK4J,KAAL,GAAa,IAAIjK,OAAJ,EAAb;AACA,UAAK4N,KAAL,GAAa,IAAI5N,OAAJ,EAAb;AACA,UAAKkO,KAAL,GAAa,IAAI1O,OAAJ,EAAb;AACA,UAAKsZ,KAAL,GAAa,IAAItZ,OAAJ,EAAb;AACA,UAAK8R,KAAL,GAAa,IAAIhR,UAAJ,EAAb,CAn0E6C,CAm0Ed;;AAE/B,UAAK2R,kBAAL,GAA0B,IAAIzS,OAAJ,EAA1B,CAr0E6C,CAq0EJ;;AAEzC,UAAK4R,eAAL,GAAuB,IAAI5R,OAAJ,EAAvB,CAv0E6C,CAu0EP;;AAEtC,UAAKgX,YAAL,GAAoB,IAAIhX,OAAJ,EAApB,CAz0E6C,CAy0EV;;AAEnC,UAAK+P,aAAL,GAAqB,IAAIvP,OAAJ,EAArB,CA30E6C,CA20ET;AACpC;;AAEA,UAAKmK,kBAAL,GAA0B,IAAI3K,OAAJ,EAA1B;AACA,UAAKqV,sBAAL,GAA8B,IAAIrV,OAAJ,EAA9B;AACA,UAAKmO,SAAL,GAAiB,CAAjB;AACA,UAAKgI,QAAL,GAAgB,IAAI3V,OAAJ,EAAhB;AACA,UAAKgV,UAAL,GAAkB,CAAlB;AACA,UAAKI,QAAL,GAAgB,CAAhB;AACA,UAAKI,OAAL,GAAe,CAAf;AACA,UAAK3H,iBAAL,GAAyB,IAAIrO,OAAJ,EAAzB,CAr1E6C,CAq1EL;;AAExC,UAAKiW,IAAL,GAAY,IAAIzV,OAAJ,EAAZ;AACA,UAAK+U,MAAL,GAAc,CAAd;AACA,UAAKL,KAAL,GAAa,CAAb;AACA,UAAKO,YAAL,GAAoB,CAApB;AACA,UAAKE,SAAL,GAAiB,CAAjB;AACA,UAAKE,WAAL,GAAmB,CAAnB;AACA,UAAKE,QAAL,GAAgB,CAAhB;AACA,UAAKZ,mBAAL,GAA2B,IAAInV,OAAJ,EAA3B;AACA,UAAK6W,kBAAL,GAA0B,IAAI7W,OAAJ,EAA1B,CA/1E6C,CA+1EJ;;AAEzC,UAAKyG,OAAL,GAAe,CAAC,CAAhB;AACA,UAAK5B,WAAL,GAAmB,EAAnB;AACA,UAAKE,aAAL,GAAqB,EAArB;AACA,UAAKC,MAAL,GAAclD,KAAK,CAACC,IAApB,CAp2E6C,CAo2EnB;;AAE1B,UAAKgF,kBAAL,GAA0B,EAA1B,CAt2E6C,CAs2Ef;;AAE9B,UAAKoJ,oBAAL,GAA4B,CAA5B,CAx2E6C,CAw2Ed;;AAE/B,UAAKC,sBAAL,GAA8B,CAA9B;AACA,UAAKT,oBAAL,GAA4B,CAA5B,CA32E6C,CA22Ed;;AAE/B,UAAKE,sBAAL,GAA8B,CAA9B,CA72E6C,CA62EZ;;AAEjC,UAAK/I,WAAL,GAAmB,CAAnB;AACA,UAAK3B,UAAL,GAAkB,IAAlB;AACA,UAAK+C,QAAL,GAAgB,CAAhB;AACA,UAAK9C,WAAL,GAAmB,EAAnB;AACA,UAAKE,UAAL,GAAkB,CAAlB,CAn3E6C,CAm3ExB;;AAErB,UAAK6C,WAAL,GAAmB,CAAnB,CAr3E6C,CAq3EvB;;AAEtB,UAAKF,YAAL,GAAoB,GAApB;AACA,UAAKI,YAAL,GAAoB,GAApB;AACA,UAAKC,aAAL,GAAqB,EAArB;AACA,UAAKhB,kBAAL,GAA0B,EAA1B,CA13E6C,CA03Ef;;AAE9B,UAAK+F,sBAAL,GAA8B,IAAI7M,OAAJ,EAA9B;AACA,UAAK6L,oBAAL,GAA4B,IAAI7L,OAAJ,EAA5B,CA73E6C,CA63EF;;AAE3C,UAAK6J,KAAL,GAAa,IAAb,CA/3E6C,CA+3E1B;;AAEnB,UAAKkJ,aAAL,GAAqB,IAAI/S,OAAJ,EAArB,CAj4E6C,CAi4ET;;AAEpC,UAAK4C,OAAL,GAAe,IAAIrC,KAAJ,EAAf;AACA,UAAK+C,SAAL,GAAiB,GAAjB,CAp4E6C,CAo4EvB;;AAEtB,UAAKoI,UAAL,GAAkB,CAAC,CAAnB,CAt4E6C,CAs4EvB;;AAEtB,UAAKF,YAAL,GAAoB,CAAC,CAArB,CAx4E6C,CAw4ErB;;AAExB,UAAKuL,kBAAL,GAA0B,GAA1B,CA14E6C,CA04Ed;AAC/B;;AAEA,UAAK5K,SAAL,GAAiB,CAAjB,CA74E6C,CA64EzB;;AAEpB,UAAKC,YAAL,GAAoB,CAApB,CA/4E6C,CA+4EtB;;AAEvB,UAAKE,UAAL,GAAkB,CAAlB,CAj5E6C,CAi5ExB;;AAErB,UAAKD,aAAL,GAAqB,CAArB,CAn5E6C,CAm5ErB;;AAExB,UAAKE,cAAL,GAAsB,IAAIvM,OAAJ,EAAtB,CAr5E6C,CAq5ER;;AAErC,UAAKwM,cAAL,GAAsB,IAAIxM,OAAJ,EAAtB,CAv5E6C,CAu5ER;;AAErC,UAAK0M,MAAL,GAAc,CAAd,CAz5E6C,CAy5E5B;;AAEjB,UAAKD,MAAL,GAAc,CAAd,CA35E6C,CA25E5B;AACjB;;AAEA,UAAKiP,aAAL,GAAqB,KAArB;AACA,UAAKnT,WAAL,GAAmB,GAAnB,CA/5E6C,CA+5ErB;;AAExB,UAAK2O,aAAL,GAAqB,EAArB;AACA,UAAKrI,IAAL,GAAY,EAAZ,CAl6E6C,CAk6E7B;;AAEhB,UAAK3C,gBAAL,GAAwB,IAAxB,CAp6E6C,CAo6Ef;;AAE9B,UAAKH,UAAL,GAAkB,KAAlB,CAt6E6C,CAs6EpB;;AAEzB,UAAKpD,UAAL,GAAkB,KAAlB,CAx6E6C,CAw6EpB;;AAEzB,UAAKqC,MAAL,GAAc,CAAd;AACA,UAAKD,MAAL,GAAc,EAAd;AACA,UAAKhH,OAAL,GAAe,IAAf;AACA,UAAK6E,SAAL,GAAiB,IAAjB;AACA,UAAKoD,YAAL,GAAoB,IAApB;AACA,UAAK/D,UAAL,GAAkB,IAAlB;AACA,UAAK0T,YAAL,GAAoB,IAApB;AACA,UAAKpR,WAAL,GAAmB,CAAnB;AACA,UAAKC,WAAL,GAAmBoR,QAAnB;AACA,UAAK/C,OAAL,GAAe,CAAf;AACA,UAAKD,OAAL,GAAegD,QAAf,CAp7E6C,CAo7EpB;;AAEzB,UAAKpH,MAAL,GAAc,IAAIxU,OAAJ,CAAY,CAAZ,EAAe,CAAf,EAAkB,CAAlB,CAAd;AACA,UAAKkb,cAAL,GAAsB,IAAIlb,OAAJ,CAAY,CAAZ,EAAe,CAAf,EAAkB,CAAlB,CAAtB;AACA,UAAKiD,SAAL,GAAiB,CAAjB,CAx7E6C,CAw7EzB;;AAEpB,UAAK+J,MAAL,GAActM,KAAK,CAACC,IAApB;;AACA,UAAKkb,SAAL,CAAerZ,OAAf;;AAEA,QAAI,MAAKE,KAAL,IAAc,IAAlB,EAAwB;AACtB,YAAKA,KAAL,CAAW6G,GAAX,CAAe,MAAK3G,OAApB;AACD;;AAED,UAAKH,UAAL,CAAgBqZ,KAAhB,CAAsBC,WAAtB,GAAoC,MAApC;AACA,UAAKzV,WAAL,GAAmBnB,MAAM,CAAC6W,gBAA1B;;AACA,UAAKC,sBAAL;;AACA,UAAKxZ,UAAL,CAAgB2C,gBAAhB,CAAiC,aAAjC,EAAgD,MAAKiO,aAArD;;AACA,UAAK5Q,UAAL,CAAgB2C,gBAAhB,CAAiC,OAAjC,EAA0C,MAAKgO,OAA/C;;AACA,UAAK3Q,UAAL,CAAgB2C,gBAAhB,CAAiC,aAAjC,EAAgD,MAAK8N,aAArD;;AACA,UAAKzQ,UAAL,CAAgB2C,gBAAhB,CAAiC,eAAjC,EAAkD,MAAK+N,eAAvD;;AACAhO,IAAAA,MAAM,CAACC,gBAAP,CAAwB,SAAxB,EAAmC,MAAKmO,SAAxC;AACApO,IAAAA,MAAM,CAACC,gBAAP,CAAwB,QAAxB,EAAkC,MAAKkO,cAAvC;AAz8E6C;AA08E9C,G,CAAC;;AAGF;AACF;AACA;AACA;;;;;WACE,8BAAqB4I,cAArB,EAAqC;AACnC,UAAI,CAACA,cAAc,KAAK,IAAnB,IAA2BA,cAAc,KAAK,KAAK,CAAnD,GAAuD,KAAK,CAA5D,GAAgEA,cAAc,CAACja,MAAhF,KAA2F,IAA3F,IAAmG,KAAKA,MAAL,KAAgB,IAAvH,EAA6H;AAC3H,aAAKiM,KAAL,CAAWpC,IAAX,CAAgB,KAAK3B,kBAArB,EAAyCgI,WAAzC,CAAqD+J,cAAc,CAACja,MAApE;;AAEA,aAAKiM,KAAL,CAAWkE,SAAX,CAAqB,KAAKnQ,MAAL,CAAYuH,QAAjC,EAA2C,KAAKvH,MAAL,CAAYmH,UAAvD,EAAmE,KAAKnH,MAAL,CAAYU,KAA/E;;AAEA,aAAKV,MAAL,CAAYwS,YAAZ,GAL2H,CAK/F;;AAE5B,YAAI,KAAKzH,MAAL,IAAetM,KAAK,CAACG,MAArB,IAA+B,KAAKmM,MAAL,IAAetM,KAAK,CAACQ,OAApD,IAA+D,KAAK8L,MAAL,IAAetM,KAAK,CAACW,gBAAxF,EAA0G;AACxG,eAAKY,MAAL,CAAYyT,EAAZ,CAAe5J,IAAf,CAAoB,KAAK6J,QAAzB,EAAmCxM,eAAnC,CAAmD,KAAKlH,MAAL,CAAYmH,UAA/D;AACD;AACF;;AAED,UAAI,CAAC8S,cAAc,KAAK,IAAnB,IAA2BA,cAAc,KAAK,KAAK,CAAnD,GAAuD,KAAK,CAA5D,GAAgEA,cAAc,CAACha,MAAhF,KAA2F,IAA/F,EAAqG;AACnG,aAAKgM,KAAL,CAAWpC,IAAX,CAAgB,KAAK+B,iBAArB,EAAwCsE,WAAxC,CAAoD+J,cAAc,CAACha,MAAnE;;AAEA,aAAKgM,KAAL,CAAWkE,SAAX,CAAqB,KAAKxP,OAAL,CAAa4G,QAAlC,EAA4C,KAAK5G,OAAL,CAAawG,UAAzD,EAAqE,KAAKxG,OAAL,CAAaD,KAAlF;;AAEA,aAAKC,OAAL,CAAa6R,YAAb;AACD;;AAED,UAAI,CAAC,KAAKzH,MAAL,IAAetM,KAAK,CAACK,KAArB,IAA8B,KAAKiM,MAAL,IAAetM,KAAK,CAACO,KAAnD,IAA4D,KAAK+L,MAAL,IAAetM,KAAK,CAACU,eAAlF,MAAuG,KAAKa,MAAL,YAAuBpC,iBAAvB,IAA4C,KAAKoC,MAAL,YAAuBlC,kBAA1K,CAAJ,EAAmM;AACjM,YAAM+C,QAAQ,GAAG,KAAKC,iBAAL,CAAuB,KAAKd,MAA5B,CAAjB;;AAEA,YAAIa,QAAQ,KAAKE,SAAjB,EAA4B;AAC1B,eAAKC,SAAL,GAAiBH,QAAjB;AACD;;AAED,YAAI,KAAK4Y,aAAT,EAAwB;AACtB,cAAMS,cAAc,GAAG,KAAKla,MAAL,CAAYuH,QAAZ,CAAqBY,UAArB,CAAgC,KAAKxH,OAAL,CAAa4G,QAA7C,CAAvB;AACA,cAAM4S,EAAE,GAAG,IAAI5b,IAAJ,EAAX;AACA4b,UAAAA,EAAE,CAACC,aAAH,CAAiB,KAAKzZ,OAAtB;AACA,cAAM0Z,MAAM,GAAG,IAAI7b,MAAJ,EAAf;AACA2b,UAAAA,EAAE,CAACG,iBAAH,CAAqBD,MAArB;AACA,cAAME,oBAAoB,GAAG/T,IAAI,CAAC6E,GAAL,CAAS,KAAK6H,SAAd,EAAyBmH,MAAM,CAACG,MAAP,GAAgBH,MAAM,CAACI,MAAP,CAAcxY,MAAd,EAAzC,CAA7B;AACA,cAAMyY,mBAAmB,GAAGR,cAAc,GAAG,KAAKlH,YAAlD;AACA,cAAM2H,UAAU,GAAGnU,IAAI,CAACmG,GAAL,CAAS4N,oBAAT,EAA+BG,mBAA/B,CAAnB;AACA,eAAK1a,MAAL,CAAYiT,IAAZ,GAAmBiH,cAAc,GAAGS,UAApC;AACA,cAAMC,mBAAmB,GAAGpU,IAAI,CAACmG,GAAL,CAAS,KAAK2G,QAAd,EAAwB,CAAC+G,MAAM,CAACG,MAAR,GAAiBH,MAAM,CAACI,MAAP,CAAcxY,MAAd,EAAzC,CAA5B;AACA,cAAM4Y,kBAAkB,GAAGX,cAAc,GAAG,KAAK9G,WAAjD;AACA,cAAM0H,SAAS,GAAGtU,IAAI,CAACmG,GAAL,CAASiO,mBAAT,EAA8BC,kBAA9B,CAAlB;AACA,eAAK7a,MAAL,CAAYqT,GAAZ,GAAkB6G,cAAc,GAAGY,SAAnC;AACA,eAAK9a,MAAL,CAAY2T,sBAAZ;AACD,SAfD,MAeO;AACL,cAAIoH,MAAM,GAAG,KAAb;;AAEA,cAAI,KAAK/a,MAAL,CAAYiT,IAAZ,IAAoB,KAAKD,YAA7B,EAA2C;AACzC,iBAAKhT,MAAL,CAAYiT,IAAZ,GAAmB,KAAKD,YAAxB;AACA+H,YAAAA,MAAM,GAAG,IAAT;AACD;;AAED,cAAI,KAAK/a,MAAL,CAAYqT,GAAZ,IAAmB,KAAKD,WAA5B,EAAyC;AACvC,iBAAKpT,MAAL,CAAYqT,GAAZ,GAAkB,KAAKD,WAAvB;AACA2H,YAAAA,MAAM,GAAG,IAAT;AACD;;AAED,cAAIA,MAAJ,EAAY;AACV,iBAAK/a,MAAL,CAAY2T,sBAAZ;AACD;AACF;AACF;AACF;AACD;AACF;AACA;AACA;AACA;AACA;AACA;;AAGE;AACF;AACA;AACA;;;;WACE,0BAAiB4C,KAAjB,EAAwB;AACtB,WAAK5V,OAAL,CAAaqa,OAAb,GAAuBzE,KAAvB;AACA,WAAK3U,aAAL,CAAmB1B,YAAnB;AACD;AACD;AACF;AACA;AACA;AACA;;AAGE;AACF;AACA;AACA;AACA;;;;WACE,qCAAwD;AAAA,UAA9BF,MAA8B,uEAArB,IAAqB;AAAA,UAAfC,MAAe,uEAAN,IAAM;;AACtD,UAAID,MAAM,IAAI,IAAd,EAAoB;AAClB,YAAID,eAAe,CAACC,MAAhB,IAA0B,IAA9B,EAAoC;AAClCD,UAAAA,eAAe,CAACC,MAAhB,CAAuB6J,IAAvB,CAA4B7J,MAA5B;AACD,SAFD,MAEO;AACLD,UAAAA,eAAe,CAACC,MAAhB,GAAyBA,MAAM,CAAC8L,KAAP,EAAzB;AACD;AACF,OAND,MAMO;AACL/L,QAAAA,eAAe,CAACC,MAAhB,GAAyB,IAAzB;AACD;;AAED,UAAIC,MAAM,IAAI,IAAd,EAAoB;AAClB,YAAIF,eAAe,CAACE,MAAhB,IAA0B,IAA9B,EAAoC;AAClCF,UAAAA,eAAe,CAACE,MAAhB,CAAuB4J,IAAvB,CAA4B5J,MAA5B;AACD,SAFD,MAEO;AACLF,UAAAA,eAAe,CAACE,MAAhB,GAAyBA,MAAM,CAAC6L,KAAP,EAAzB;AACD;AACF,OAND,MAMO;AACL/L,QAAAA,eAAe,CAACE,MAAhB,GAAyB,IAAzB;AACD;AACF;AACD;AACF;AACA;AACA;AACA;AACA;;;;;EAvkF8BzC,e;;AA4kF9B,SAAS8C,eAAT","sourcesContent":["import _defineProperty from '@babel/runtime/helpers/esm/defineProperty';\nimport { Matrix4, EventDispatcher, EllipseCurve, BufferGeometry, Mesh, PerspectiveCamera, MathUtils, OrthographicCamera, Vector3, GridHelper, LineBasicMaterial, Line, Raycaster, Vector2, Quaternion, Group, Box3, Sphere } from 'three';\n\n//trackball state\nconst STATE = {\n  IDLE: Symbol(),\n  ROTATE: Symbol(),\n  PAN: Symbol(),\n  SCALE: Symbol(),\n  FOV: Symbol(),\n  FOCUS: Symbol(),\n  ZROTATE: Symbol(),\n  TOUCH_MULTI: Symbol(),\n  ANIMATION_FOCUS: Symbol(),\n  ANIMATION_ROTATE: Symbol()\n};\nconst INPUT = {\n  NONE: Symbol(),\n  ONE_FINGER: Symbol(),\n  ONE_FINGER_SWITCHED: Symbol(),\n  TWO_FINGER: Symbol(),\n  MULT_FINGER: Symbol(),\n  CURSOR: Symbol()\n}; //cursor center coordinates\n\nconst _center = {\n  x: 0,\n  y: 0\n}; //transformation matrices for gizmos and camera\n\nconst _transformation = {\n  camera: new Matrix4(),\n  gizmos: new Matrix4()\n}; //events\n\nconst _changeEvent = {\n  type: 'change'\n};\nconst _startEvent = {\n  type: 'start'\n};\nconst _endEvent = {\n  type: 'end'\n};\n/**\n *\n * @param {Camera} camera Virtual camera used in the scene\n * @param {HTMLElement} domElement Renderer's dom element\n * @param {Scene} scene The scene to be rendered\n */\n\nclass ArcballControls extends EventDispatcher {\n  constructor(_camera, domElement, scene = null) {\n    super();\n\n    _defineProperty(this, \"camera\", void 0);\n\n    _defineProperty(this, \"domElement\", void 0);\n\n    _defineProperty(this, \"scene\", void 0);\n\n    _defineProperty(this, \"mouseActions\", void 0);\n\n    _defineProperty(this, \"_mouseOp\", void 0);\n\n    _defineProperty(this, \"_v2_1\", void 0);\n\n    _defineProperty(this, \"_v3_1\", void 0);\n\n    _defineProperty(this, \"_v3_2\", void 0);\n\n    _defineProperty(this, \"_m4_1\", void 0);\n\n    _defineProperty(this, \"_m4_2\", void 0);\n\n    _defineProperty(this, \"_quat\", void 0);\n\n    _defineProperty(this, \"_translationMatrix\", void 0);\n\n    _defineProperty(this, \"_rotationMatrix\", void 0);\n\n    _defineProperty(this, \"_scaleMatrix\", void 0);\n\n    _defineProperty(this, \"_rotationAxis\", void 0);\n\n    _defineProperty(this, \"_cameraMatrixState\", void 0);\n\n    _defineProperty(this, \"_cameraProjectionState\", void 0);\n\n    _defineProperty(this, \"_fovState\", void 0);\n\n    _defineProperty(this, \"_upState\", void 0);\n\n    _defineProperty(this, \"_zoomState\", void 0);\n\n    _defineProperty(this, \"_nearPos\", void 0);\n\n    _defineProperty(this, \"_farPos\", void 0);\n\n    _defineProperty(this, \"_gizmoMatrixState\", void 0);\n\n    _defineProperty(this, \"_up0\", void 0);\n\n    _defineProperty(this, \"_zoom0\", void 0);\n\n    _defineProperty(this, \"_fov0\", void 0);\n\n    _defineProperty(this, \"_initialNear\", void 0);\n\n    _defineProperty(this, \"_nearPos0\", void 0);\n\n    _defineProperty(this, \"_initialFar\", void 0);\n\n    _defineProperty(this, \"_farPos0\", void 0);\n\n    _defineProperty(this, \"_cameraMatrixState0\", void 0);\n\n    _defineProperty(this, \"_gizmoMatrixState0\", void 0);\n\n    _defineProperty(this, \"_button\", void 0);\n\n    _defineProperty(this, \"_touchStart\", void 0);\n\n    _defineProperty(this, \"_touchCurrent\", void 0);\n\n    _defineProperty(this, \"_input\", void 0);\n\n    _defineProperty(this, \"_switchSensibility\", void 0);\n\n    _defineProperty(this, \"_startFingerDistance\", void 0);\n\n    _defineProperty(this, \"_currentFingerDistance\", void 0);\n\n    _defineProperty(this, \"_startFingerRotation\", void 0);\n\n    _defineProperty(this, \"_currentFingerRotation\", void 0);\n\n    _defineProperty(this, \"_devPxRatio\", void 0);\n\n    _defineProperty(this, \"_downValid\", void 0);\n\n    _defineProperty(this, \"_nclicks\", void 0);\n\n    _defineProperty(this, \"_downEvents\", void 0);\n\n    _defineProperty(this, \"_downStart\", void 0);\n\n    _defineProperty(this, \"_clickStart\", void 0);\n\n    _defineProperty(this, \"_maxDownTime\", void 0);\n\n    _defineProperty(this, \"_maxInterval\", void 0);\n\n    _defineProperty(this, \"_posThreshold\", void 0);\n\n    _defineProperty(this, \"_movementThreshold\", void 0);\n\n    _defineProperty(this, \"_currentCursorPosition\", void 0);\n\n    _defineProperty(this, \"_startCursorPosition\", void 0);\n\n    _defineProperty(this, \"_grid\", void 0);\n\n    _defineProperty(this, \"_gridPosition\", void 0);\n\n    _defineProperty(this, \"_gizmos\", void 0);\n\n    _defineProperty(this, \"_curvePts\", void 0);\n\n    _defineProperty(this, \"_timeStart\", void 0);\n\n    _defineProperty(this, \"_animationId\", void 0);\n\n    _defineProperty(this, \"focusAnimationTime\", void 0);\n\n    _defineProperty(this, \"_timePrev\", void 0);\n\n    _defineProperty(this, \"_timeCurrent\", void 0);\n\n    _defineProperty(this, \"_anglePrev\", void 0);\n\n    _defineProperty(this, \"_angleCurrent\", void 0);\n\n    _defineProperty(this, \"_cursorPosPrev\", void 0);\n\n    _defineProperty(this, \"_cursorPosCurr\", void 0);\n\n    _defineProperty(this, \"_wPrev\", void 0);\n\n    _defineProperty(this, \"_wCurr\", void 0);\n\n    _defineProperty(this, \"adjustNearFar\", void 0);\n\n    _defineProperty(this, \"scaleFactor\", void 0);\n\n    _defineProperty(this, \"dampingFactor\", void 0);\n\n    _defineProperty(this, \"wMax\", void 0);\n\n    _defineProperty(this, \"enableAnimations\", void 0);\n\n    _defineProperty(this, \"enableGrid\", void 0);\n\n    _defineProperty(this, \"cursorZoom\", void 0);\n\n    _defineProperty(this, \"minFov\", void 0);\n\n    _defineProperty(this, \"maxFov\", void 0);\n\n    _defineProperty(this, \"enabled\", void 0);\n\n    _defineProperty(this, \"enablePan\", void 0);\n\n    _defineProperty(this, \"enableRotate\", void 0);\n\n    _defineProperty(this, \"enableZoom\", void 0);\n\n    _defineProperty(this, \"enableGizmos\", void 0);\n\n    _defineProperty(this, \"minDistance\", void 0);\n\n    _defineProperty(this, \"maxDistance\", void 0);\n\n    _defineProperty(this, \"minZoom\", void 0);\n\n    _defineProperty(this, \"maxZoom\", void 0);\n\n    _defineProperty(this, \"target\", void 0);\n\n    _defineProperty(this, \"_currentTarget\", void 0);\n\n    _defineProperty(this, \"_tbRadius\", void 0);\n\n    _defineProperty(this, \"_state\", void 0);\n\n    _defineProperty(this, \"onWindowResize\", () => {\n      const scale = (this._gizmos.scale.x + this._gizmos.scale.y + this._gizmos.scale.z) / 3;\n\n      if (this.camera !== null) {\n        const tbRadius = this.calculateTbRadius(this.camera);\n\n        if (tbRadius !== undefined) {\n          this._tbRadius = tbRadius;\n        }\n      }\n\n      const newRadius = this._tbRadius / scale; // @ts-expect-error\n\n      const curve = new EllipseCurve(0, 0, newRadius, newRadius);\n      const points = curve.getPoints(this._curvePts);\n      const curveGeometry = new BufferGeometry().setFromPoints(points);\n\n      for (const gizmo in this._gizmos.children) {\n        const child = this._gizmos.children[gizmo];\n\n        if (child instanceof Mesh) {\n          child.geometry = curveGeometry;\n        }\n      }\n\n      this.dispatchEvent(_changeEvent);\n    });\n\n    _defineProperty(this, \"onContextMenu\", event => {\n      if (!this.enabled) {\n        return;\n      }\n\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        if (this.mouseActions[i].mouse == 2) {\n          //prevent only if button 2 is actually used\n          event.preventDefault();\n          break;\n        }\n      }\n    });\n\n    _defineProperty(this, \"onPointerCancel\", () => {\n      this._touchStart.splice(0, this._touchStart.length);\n\n      this._touchCurrent.splice(0, this._touchCurrent.length);\n\n      this._input = INPUT.NONE;\n    });\n\n    _defineProperty(this, \"onPointerDown\", event => {\n      if (event.button == 0 && event.isPrimary) {\n        this._downValid = true;\n\n        this._downEvents.push(event);\n\n        this._downStart = performance.now();\n      } else {\n        this._downValid = false;\n      }\n\n      if (event.pointerType == 'touch' && this._input != INPUT.CURSOR) {\n        this._touchStart.push(event);\n\n        this._touchCurrent.push(event);\n\n        switch (this._input) {\n          case INPUT.NONE:\n            //singleStart\n            this._input = INPUT.ONE_FINGER;\n            this.onSinglePanStart(event, 'ROTATE');\n            window.addEventListener('pointermove', this.onPointerMove);\n            window.addEventListener('pointerup', this.onPointerUp);\n            break;\n\n          case INPUT.ONE_FINGER:\n          case INPUT.ONE_FINGER_SWITCHED:\n            //doubleStart\n            this._input = INPUT.TWO_FINGER;\n            this.onRotateStart();\n            this.onPinchStart();\n            this.onDoublePanStart();\n            break;\n\n          case INPUT.TWO_FINGER:\n            //multipleStart\n            this._input = INPUT.MULT_FINGER;\n            this.onTriplePanStart();\n            break;\n        }\n      } else if (event.pointerType != 'touch' && this._input == INPUT.NONE) {\n        let modifier = null;\n\n        if (event.ctrlKey || event.metaKey) {\n          modifier = 'CTRL';\n        } else if (event.shiftKey) {\n          modifier = 'SHIFT';\n        }\n\n        this._mouseOp = this.getOpFromAction(event.button, modifier);\n\n        if (this._mouseOp != null) {\n          window.addEventListener('pointermove', this.onPointerMove);\n          window.addEventListener('pointerup', this.onPointerUp); //singleStart\n\n          this._input = INPUT.CURSOR;\n          this._button = event.button;\n          this.onSinglePanStart(event, this._mouseOp);\n        }\n      }\n    });\n\n    _defineProperty(this, \"onPointerMove\", event => {\n      if (event.pointerType == 'touch' && this._input != INPUT.CURSOR) {\n        switch (this._input) {\n          case INPUT.ONE_FINGER:\n            //singleMove\n            this.updateTouchEvent(event);\n            this.onSinglePanMove(event, STATE.ROTATE);\n            break;\n\n          case INPUT.ONE_FINGER_SWITCHED:\n            const movement = this.calculatePointersDistance(this._touchCurrent[0], event) * this._devPxRatio;\n\n            if (movement >= this._switchSensibility) {\n              //singleMove\n              this._input = INPUT.ONE_FINGER;\n              this.updateTouchEvent(event);\n              this.onSinglePanStart(event, 'ROTATE');\n              break;\n            }\n\n            break;\n\n          case INPUT.TWO_FINGER:\n            //rotate/pan/pinchMove\n            this.updateTouchEvent(event);\n            this.onRotateMove();\n            this.onPinchMove();\n            this.onDoublePanMove();\n            break;\n\n          case INPUT.MULT_FINGER:\n            //multMove\n            this.updateTouchEvent(event);\n            this.onTriplePanMove();\n            break;\n        }\n      } else if (event.pointerType != 'touch' && this._input == INPUT.CURSOR) {\n        let modifier = null;\n\n        if (event.ctrlKey || event.metaKey) {\n          modifier = 'CTRL';\n        } else if (event.shiftKey) {\n          modifier = 'SHIFT';\n        }\n\n        const mouseOpState = this.getOpStateFromAction(this._button, modifier);\n\n        if (mouseOpState != null) {\n          this.onSinglePanMove(event, mouseOpState);\n        }\n      } //checkDistance\n\n\n      if (this._downValid) {\n        const movement = this.calculatePointersDistance(this._downEvents[this._downEvents.length - 1], event) * this._devPxRatio;\n\n        if (movement > this._movementThreshold) {\n          this._downValid = false;\n        }\n      }\n    });\n\n    _defineProperty(this, \"onPointerUp\", event => {\n      if (event.pointerType == 'touch' && this._input != INPUT.CURSOR) {\n        const nTouch = this._touchCurrent.length;\n\n        for (let i = 0; i < nTouch; i++) {\n          if (this._touchCurrent[i].pointerId == event.pointerId) {\n            this._touchCurrent.splice(i, 1);\n\n            this._touchStart.splice(i, 1);\n\n            break;\n          }\n        }\n\n        switch (this._input) {\n          case INPUT.ONE_FINGER:\n          case INPUT.ONE_FINGER_SWITCHED:\n            //singleEnd\n            window.removeEventListener('pointermove', this.onPointerMove);\n            window.removeEventListener('pointerup', this.onPointerUp);\n            this._input = INPUT.NONE;\n            this.onSinglePanEnd();\n            break;\n\n          case INPUT.TWO_FINGER:\n            //doubleEnd\n            this.onDoublePanEnd();\n            this.onPinchEnd();\n            this.onRotateEnd(); //switching to singleStart\n\n            this._input = INPUT.ONE_FINGER_SWITCHED;\n            break;\n\n          case INPUT.MULT_FINGER:\n            if (this._touchCurrent.length == 0) {\n              window.removeEventListener('pointermove', this.onPointerMove);\n              window.removeEventListener('pointerup', this.onPointerUp); //multCancel\n\n              this._input = INPUT.NONE;\n              this.onTriplePanEnd();\n            }\n\n            break;\n        }\n      } else if (event.pointerType != 'touch' && this._input == INPUT.CURSOR) {\n        window.removeEventListener('pointermove', this.onPointerMove);\n        window.removeEventListener('pointerup', this.onPointerUp);\n        this._input = INPUT.NONE;\n        this.onSinglePanEnd();\n        this._button = -1;\n      }\n\n      if (event.isPrimary) {\n        if (this._downValid) {\n          const downTime = event.timeStamp - this._downEvents[this._downEvents.length - 1].timeStamp;\n\n          if (downTime <= this._maxDownTime) {\n            if (this._nclicks == 0) {\n              //first valid click detected\n              this._nclicks = 1;\n              this._clickStart = performance.now();\n            } else {\n              const clickInterval = event.timeStamp - this._clickStart;\n\n              const movement = this.calculatePointersDistance(this._downEvents[1], this._downEvents[0]) * this._devPxRatio;\n\n              if (clickInterval <= this._maxInterval && movement <= this._posThreshold) {\n                //second valid click detected\n                //fire double tap and reset values\n                this._nclicks = 0;\n\n                this._downEvents.splice(0, this._downEvents.length);\n\n                this.onDoubleTap(event);\n              } else {\n                //new 'first click'\n                this._nclicks = 1;\n\n                this._downEvents.shift();\n\n                this._clickStart = performance.now();\n              }\n            }\n          } else {\n            this._downValid = false;\n            this._nclicks = 0;\n\n            this._downEvents.splice(0, this._downEvents.length);\n          }\n        } else {\n          this._nclicks = 0;\n\n          this._downEvents.splice(0, this._downEvents.length);\n        }\n      }\n    });\n\n    _defineProperty(this, \"onWheel\", event => {\n      if (this.enabled && this.enableZoom) {\n        let modifier = null;\n\n        if (event.ctrlKey || event.metaKey) {\n          modifier = 'CTRL';\n        } else if (event.shiftKey) {\n          modifier = 'SHIFT';\n        }\n\n        const mouseOp = this.getOpFromAction('WHEEL', modifier);\n\n        if (mouseOp != null) {\n          event.preventDefault();\n          this.dispatchEvent(_startEvent);\n          const notchDeltaY = 125; //distance of one notch of mouse wheel\n\n          let sgn = event.deltaY / notchDeltaY;\n          let size = 1;\n\n          if (sgn > 0) {\n            size = 1 / this.scaleFactor;\n          } else if (sgn < 0) {\n            size = this.scaleFactor;\n          }\n\n          switch (mouseOp) {\n            case 'ZOOM':\n              this.updateTbState(STATE.SCALE, true);\n\n              if (sgn > 0) {\n                size = 1 / Math.pow(this.scaleFactor, sgn);\n              } else if (sgn < 0) {\n                size = Math.pow(this.scaleFactor, -sgn);\n              }\n\n              if (this.cursorZoom && this.enablePan) {\n                let scalePoint;\n\n                if (this.camera instanceof OrthographicCamera && this.camera.isOrthographicCamera) {\n                  var _this$unprojectOnTbPl;\n\n                  scalePoint = (_this$unprojectOnTbPl = this.unprojectOnTbPlane(this.camera, event.clientX, event.clientY, this.domElement)) === null || _this$unprojectOnTbPl === void 0 ? void 0 : _this$unprojectOnTbPl.applyQuaternion(this.camera.quaternion).multiplyScalar(1 / this.camera.zoom).add(this._gizmos.position);\n                } else if (this.camera instanceof PerspectiveCamera && this.camera.isPerspectiveCamera) {\n                  var _this$unprojectOnTbPl2;\n\n                  scalePoint = (_this$unprojectOnTbPl2 = this.unprojectOnTbPlane(this.camera, event.clientX, event.clientY, this.domElement)) === null || _this$unprojectOnTbPl2 === void 0 ? void 0 : _this$unprojectOnTbPl2.applyQuaternion(this.camera.quaternion).add(this._gizmos.position);\n                }\n\n                if (scalePoint !== undefined) this.applyTransformMatrix(this.applyScale(size, scalePoint));\n              } else {\n                this.applyTransformMatrix(this.applyScale(size, this._gizmos.position));\n              }\n\n              if (this._grid != null) {\n                this.disposeGrid();\n                this.drawGrid();\n              }\n\n              this.updateTbState(STATE.IDLE, false);\n              this.dispatchEvent(_changeEvent);\n              this.dispatchEvent(_endEvent);\n              break;\n\n            case 'FOV':\n              if (this.camera instanceof PerspectiveCamera && this.camera.isPerspectiveCamera) {\n                this.updateTbState(STATE.FOV, true); //Vertigo effect\n                //\t  fov / 2\n                //\t\t|\\\n                //\t\t| \\\n                //\t\t|  \\\n                //\tx\t|\t\\\n                //\t\t| \t \\\n                //\t\t| \t  \\\n                //\t\t| _ _ _\\\n                //\t\t\ty\n                //check for iOs shift shortcut\n\n                if (event.deltaX != 0) {\n                  sgn = event.deltaX / notchDeltaY;\n                  size = 1;\n\n                  if (sgn > 0) {\n                    size = 1 / Math.pow(this.scaleFactor, sgn);\n                  } else if (sgn < 0) {\n                    size = Math.pow(this.scaleFactor, -sgn);\n                  }\n                }\n\n                this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n\n                const x = this._v3_1.distanceTo(this._gizmos.position);\n\n                let xNew = x / size; //distance between camera and gizmos if scale(size, scalepoint) would be performed\n                //check min and max distance\n\n                xNew = MathUtils.clamp(xNew, this.minDistance, this.maxDistance);\n                const y = x * Math.tan(MathUtils.DEG2RAD * this.camera.fov * 0.5); //calculate new fov\n\n                let newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2); //check min and max fov\n\n                if (newFov > this.maxFov) {\n                  newFov = this.maxFov;\n                } else if (newFov < this.minFov) {\n                  newFov = this.minFov;\n                }\n\n                const newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n                size = x / newDistance;\n                this.setFov(newFov);\n                this.applyTransformMatrix(this.applyScale(size, this._gizmos.position, false));\n              }\n\n              if (this._grid != null) {\n                this.disposeGrid();\n                this.drawGrid();\n              }\n\n              this.updateTbState(STATE.IDLE, false);\n              this.dispatchEvent(_changeEvent);\n              this.dispatchEvent(_endEvent);\n              break;\n          }\n        }\n      }\n    });\n\n    _defineProperty(this, \"onKeyDown\", event => {\n      if (event.key == 'c') {\n        if (event.ctrlKey || event.metaKey) {\n          this.copyState();\n        }\n      } else if (event.key == 'v') {\n        if (event.ctrlKey || event.metaKey) {\n          this.pasteState();\n        }\n      }\n    });\n\n    _defineProperty(this, \"onSinglePanStart\", (event, operation) => {\n      if (this.enabled) {\n        this.dispatchEvent(_startEvent);\n        this.setCenter(event.clientX, event.clientY);\n\n        switch (operation) {\n          case 'PAN':\n            if (!this.enablePan) {\n              return;\n            }\n\n            if (this._animationId != -1) {\n              cancelAnimationFrame(this._animationId);\n              this._animationId = -1;\n              this._timeStart = -1;\n              this.activateGizmos(false);\n              this.dispatchEvent(_changeEvent);\n            }\n\n            if (this.camera !== null) {\n              this.updateTbState(STATE.PAN, true);\n              const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement);\n\n              if (rayDir !== undefined) {\n                this._startCursorPosition.copy(rayDir);\n              }\n\n              if (this.enableGrid) {\n                this.drawGrid();\n                this.dispatchEvent(_changeEvent);\n              }\n            }\n\n            break;\n\n          case 'ROTATE':\n            if (!this.enableRotate) {\n              return;\n            }\n\n            if (this._animationId != -1) {\n              cancelAnimationFrame(this._animationId);\n              this._animationId = -1;\n              this._timeStart = -1;\n            }\n\n            if (this.camera !== null) {\n              this.updateTbState(STATE.ROTATE, true);\n              const rayDir = this.unprojectOnTbSurface(this.camera, _center.x, _center.y, this.domElement, this._tbRadius);\n\n              if (rayDir !== undefined) {\n                this._startCursorPosition.copy(rayDir);\n              }\n\n              this.activateGizmos(true);\n\n              if (this.enableAnimations) {\n                this._timePrev = this._timeCurrent = performance.now();\n                this._angleCurrent = this._anglePrev = 0;\n\n                this._cursorPosPrev.copy(this._startCursorPosition);\n\n                this._cursorPosCurr.copy(this._cursorPosPrev);\n\n                this._wCurr = 0;\n                this._wPrev = this._wCurr;\n              }\n            }\n\n            this.dispatchEvent(_changeEvent);\n            break;\n\n          case 'FOV':\n            if (!(this.camera instanceof PerspectiveCamera && this.camera.isPerspectiveCamera) || !this.enableZoom) {\n              return;\n            }\n\n            if (this._animationId != -1) {\n              cancelAnimationFrame(this._animationId);\n              this._animationId = -1;\n              this._timeStart = -1;\n              this.activateGizmos(false);\n              this.dispatchEvent(_changeEvent);\n            }\n\n            this.updateTbState(STATE.FOV, true);\n\n            this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n\n            this._currentCursorPosition.copy(this._startCursorPosition);\n\n            break;\n\n          case 'ZOOM':\n            if (!this.enableZoom) {\n              return;\n            }\n\n            if (this._animationId != -1) {\n              cancelAnimationFrame(this._animationId);\n              this._animationId = -1;\n              this._timeStart = -1;\n              this.activateGizmos(false);\n              this.dispatchEvent(_changeEvent);\n            }\n\n            this.updateTbState(STATE.SCALE, true);\n\n            this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n\n            this._currentCursorPosition.copy(this._startCursorPosition);\n\n            break;\n        }\n      }\n    });\n\n    _defineProperty(this, \"onSinglePanMove\", (event, opState) => {\n      if (this.enabled) {\n        const restart = opState != this._state;\n        this.setCenter(event.clientX, event.clientY);\n\n        switch (opState) {\n          case STATE.PAN:\n            if (this.enablePan && this.camera !== null) {\n              if (restart) {\n                //switch to pan operation\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n                const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement);\n\n                if (rayDir !== undefined) {\n                  this._startCursorPosition.copy(rayDir);\n                }\n\n                if (this.enableGrid) {\n                  this.drawGrid();\n                }\n\n                this.activateGizmos(false);\n              } else {\n                //continue with pan operation\n                const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement);\n\n                if (rayDir !== undefined) {\n                  this._currentCursorPosition.copy(rayDir);\n                }\n\n                this.applyTransformMatrix(this.pan(this._startCursorPosition, this._currentCursorPosition));\n              }\n            }\n\n            break;\n\n          case STATE.ROTATE:\n            if (this.enableRotate && this.camera !== null) {\n              if (restart) {\n                //switch to rotate operation\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n                const rayDir = this.unprojectOnTbSurface(this.camera, _center.x, _center.y, this.domElement, this._tbRadius);\n\n                if (rayDir !== undefined) {\n                  this._startCursorPosition.copy(rayDir);\n                }\n\n                if (this.enableGrid) {\n                  this.disposeGrid();\n                }\n\n                this.activateGizmos(true);\n              } else {\n                //continue with rotate operation\n                const rayDir = this.unprojectOnTbSurface(this.camera, _center.x, _center.y, this.domElement, this._tbRadius);\n\n                if (rayDir !== undefined) {\n                  this._currentCursorPosition.copy(rayDir);\n                }\n\n                const distance = this._startCursorPosition.distanceTo(this._currentCursorPosition);\n\n                const angle = this._startCursorPosition.angleTo(this._currentCursorPosition);\n\n                const amount = Math.max(distance / this._tbRadius, angle); //effective rotation angle\n\n                this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition, this._currentCursorPosition), amount));\n\n                if (this.enableAnimations) {\n                  this._timePrev = this._timeCurrent;\n                  this._timeCurrent = performance.now();\n                  this._anglePrev = this._angleCurrent;\n                  this._angleCurrent = amount;\n\n                  this._cursorPosPrev.copy(this._cursorPosCurr);\n\n                  this._cursorPosCurr.copy(this._currentCursorPosition);\n\n                  this._wPrev = this._wCurr;\n                  this._wCurr = this.calculateAngularSpeed(this._anglePrev, this._angleCurrent, this._timePrev, this._timeCurrent);\n                }\n              }\n            }\n\n            break;\n\n          case STATE.SCALE:\n            if (this.enableZoom) {\n              if (restart) {\n                //switch to zoom operation\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n\n                this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n\n                this._currentCursorPosition.copy(this._startCursorPosition);\n\n                if (this.enableGrid) {\n                  this.disposeGrid();\n                }\n\n                this.activateGizmos(false);\n              } else {\n                //continue with zoom operation\n                const screenNotches = 8; //how many wheel notches corresponds to a full screen pan\n\n                this._currentCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n\n                const movement = this._currentCursorPosition.y - this._startCursorPosition.y;\n                let size = 1;\n\n                if (movement < 0) {\n                  size = 1 / Math.pow(this.scaleFactor, -movement * screenNotches);\n                } else if (movement > 0) {\n                  size = Math.pow(this.scaleFactor, movement * screenNotches);\n                }\n\n                this.applyTransformMatrix(this.applyScale(size, this._gizmos.position));\n              }\n            }\n\n            break;\n\n          case STATE.FOV:\n            if (this.enableZoom && this.camera instanceof PerspectiveCamera && this.camera.isPerspectiveCamera) {\n              if (restart) {\n                //switch to fov operation\n                this.dispatchEvent(_endEvent);\n                this.dispatchEvent(_startEvent);\n                this.updateTbState(opState, true);\n\n                this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n\n                this._currentCursorPosition.copy(this._startCursorPosition);\n\n                if (this.enableGrid) {\n                  this.disposeGrid();\n                }\n\n                this.activateGizmos(false);\n              } else {\n                //continue with fov operation\n                const screenNotches = 8; //how many wheel notches corresponds to a full screen pan\n\n                this._currentCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n\n                const movement = this._currentCursorPosition.y - this._startCursorPosition.y;\n                let size = 1;\n\n                if (movement < 0) {\n                  size = 1 / Math.pow(this.scaleFactor, -movement * screenNotches);\n                } else if (movement > 0) {\n                  size = Math.pow(this.scaleFactor, movement * screenNotches);\n                }\n\n                this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n\n                const x = this._v3_1.distanceTo(this._gizmos.position);\n\n                let xNew = x / size; //distance between camera and gizmos if scale(size, scalepoint) would be performed\n                //check min and max distance\n\n                xNew = MathUtils.clamp(xNew, this.minDistance, this.maxDistance);\n                const y = x * Math.tan(MathUtils.DEG2RAD * this._fovState * 0.5); //calculate new fov\n\n                let newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2); //check min and max fov\n\n                newFov = MathUtils.clamp(newFov, this.minFov, this.maxFov);\n                const newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n                size = x / newDistance;\n\n                this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);\n\n                this.setFov(newFov);\n                this.applyTransformMatrix(this.applyScale(size, this._v3_2, false)); //adjusting distance\n\n                const direction = this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(newDistance / x);\n\n                this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n              }\n            }\n\n            break;\n        }\n\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _defineProperty(this, \"onSinglePanEnd\", () => {\n      if (this._state == STATE.ROTATE) {\n        if (!this.enableRotate) {\n          return;\n        }\n\n        if (this.enableAnimations) {\n          //perform rotation animation\n          const deltaTime = performance.now() - this._timeCurrent;\n\n          if (deltaTime < 120) {\n            const w = Math.abs((this._wPrev + this._wCurr) / 2);\n            const self = this;\n            this._animationId = window.requestAnimationFrame(function (t) {\n              self.updateTbState(STATE.ANIMATION_ROTATE, true);\n              const rotationAxis = self.calculateRotationAxis(self._cursorPosPrev, self._cursorPosCurr);\n              self.onRotationAnim(t, rotationAxis, Math.min(w, self.wMax));\n            });\n          } else {\n            //cursor has been standing still for over 120 ms since last movement\n            this.updateTbState(STATE.IDLE, false);\n            this.activateGizmos(false);\n            this.dispatchEvent(_changeEvent);\n          }\n        } else {\n          this.updateTbState(STATE.IDLE, false);\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        }\n      } else if (this._state == STATE.PAN || this._state == STATE.IDLE) {\n        this.updateTbState(STATE.IDLE, false);\n\n        if (this.enableGrid) {\n          this.disposeGrid();\n        }\n\n        this.activateGizmos(false);\n        this.dispatchEvent(_changeEvent);\n      }\n\n      this.dispatchEvent(_endEvent);\n    });\n\n    _defineProperty(this, \"onDoubleTap\", event => {\n      if (this.enabled && this.enablePan && this.scene != null && this.camera !== null) {\n        this.dispatchEvent(_startEvent);\n        this.setCenter(event.clientX, event.clientY);\n        const hitP = this.unprojectOnObj(this.getCursorNDC(_center.x, _center.y, this.domElement), this.camera);\n\n        if (hitP != null && this.enableAnimations) {\n          const self = this;\n\n          if (this._animationId != -1) {\n            window.cancelAnimationFrame(this._animationId);\n          }\n\n          this._timeStart = -1;\n          this._animationId = window.requestAnimationFrame(function (t) {\n            self.updateTbState(STATE.ANIMATION_FOCUS, true);\n            self.onFocusAnim(t, hitP, self._cameraMatrixState, self._gizmoMatrixState);\n          });\n        } else if (hitP != null && !this.enableAnimations) {\n          this.updateTbState(STATE.FOCUS, true);\n          this.focus(hitP, this.scaleFactor);\n          this.updateTbState(STATE.IDLE, false);\n          this.dispatchEvent(_changeEvent);\n        }\n      }\n\n      this.dispatchEvent(_endEvent);\n    });\n\n    _defineProperty(this, \"onDoublePanStart\", () => {\n      if (this.enabled && this.enablePan && this.camera !== null) {\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.PAN, true);\n        this.setCenter((this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2, (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2);\n        const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement, true);\n\n        if (rayDir !== undefined) {\n          this._startCursorPosition.copy(rayDir);\n        }\n\n        this._currentCursorPosition.copy(this._startCursorPosition);\n\n        this.activateGizmos(false);\n      }\n    });\n\n    _defineProperty(this, \"onDoublePanMove\", () => {\n      if (this.enabled && this.enablePan && this.camera !== null) {\n        this.setCenter((this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2, (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2);\n\n        if (this._state != STATE.PAN) {\n          this.updateTbState(STATE.PAN, true);\n\n          this._startCursorPosition.copy(this._currentCursorPosition);\n        }\n\n        const rayDir = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement, true);\n        if (rayDir !== undefined) this._currentCursorPosition.copy(rayDir);\n        this.applyTransformMatrix(this.pan(this._startCursorPosition, this._currentCursorPosition, true));\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _defineProperty(this, \"onDoublePanEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.dispatchEvent(_endEvent);\n    });\n\n    _defineProperty(this, \"onRotateStart\", () => {\n      if (this.enabled && this.enableRotate) {\n        var _this$camera;\n\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.ZROTATE, true); //this._startFingerRotation = event.rotation;\n\n        this._startFingerRotation = this.getAngle(this._touchCurrent[1], this._touchCurrent[0]) + this.getAngle(this._touchStart[1], this._touchStart[0]);\n        this._currentFingerRotation = this._startFingerRotation;\n        (_this$camera = this.camera) === null || _this$camera === void 0 ? void 0 : _this$camera.getWorldDirection(this._rotationAxis); //rotation axis\n\n        if (!this.enablePan && !this.enableZoom) {\n          this.activateGizmos(true);\n        }\n      }\n    });\n\n    _defineProperty(this, \"onRotateMove\", () => {\n      if (this.enabled && this.enableRotate && this.camera !== null) {\n        this.setCenter((this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2, (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2);\n        let rotationPoint;\n\n        if (this._state != STATE.ZROTATE) {\n          this.updateTbState(STATE.ZROTATE, true);\n          this._startFingerRotation = this._currentFingerRotation;\n        } //this._currentFingerRotation = event.rotation;\n\n\n        this._currentFingerRotation = this.getAngle(this._touchCurrent[1], this._touchCurrent[0]) + this.getAngle(this._touchStart[1], this._touchStart[0]);\n\n        if (!this.enablePan) {\n          rotationPoint = new Vector3().setFromMatrixPosition(this._gizmoMatrixState);\n        } else if (this.camera instanceof PerspectiveCamera || this.camera instanceof OrthographicCamera) {\n          var _this$unprojectOnTbPl3;\n\n          this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);\n\n          rotationPoint = (_this$unprojectOnTbPl3 = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement)) === null || _this$unprojectOnTbPl3 === void 0 ? void 0 : _this$unprojectOnTbPl3.applyQuaternion(this.camera.quaternion).multiplyScalar(1 / this.camera.zoom).add(this._v3_2);\n        }\n\n        const amount = MathUtils.DEG2RAD * (this._startFingerRotation - this._currentFingerRotation);\n\n        if (rotationPoint !== undefined) {\n          this.applyTransformMatrix(this.zRotate(rotationPoint, amount));\n        }\n\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _defineProperty(this, \"onRotateEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.activateGizmos(false);\n      this.dispatchEvent(_endEvent);\n    });\n\n    _defineProperty(this, \"onPinchStart\", () => {\n      if (this.enabled && this.enableZoom) {\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.SCALE, true);\n        this._startFingerDistance = this.calculatePointersDistance(this._touchCurrent[0], this._touchCurrent[1]);\n        this._currentFingerDistance = this._startFingerDistance;\n        this.activateGizmos(false);\n      }\n    });\n\n    _defineProperty(this, \"onPinchMove\", () => {\n      if (this.enabled && this.enableZoom) {\n        this.setCenter((this._touchCurrent[0].clientX + this._touchCurrent[1].clientX) / 2, (this._touchCurrent[0].clientY + this._touchCurrent[1].clientY) / 2);\n        const minDistance = 12; //minimum distance between fingers (in css pixels)\n\n        if (this._state != STATE.SCALE) {\n          this._startFingerDistance = this._currentFingerDistance;\n          this.updateTbState(STATE.SCALE, true);\n        }\n\n        this._currentFingerDistance = Math.max(this.calculatePointersDistance(this._touchCurrent[0], this._touchCurrent[1]), minDistance * this._devPxRatio);\n        const amount = this._currentFingerDistance / this._startFingerDistance;\n        let scalePoint;\n\n        if (!this.enablePan) {\n          scalePoint = this._gizmos.position;\n        } else {\n          if (this.camera instanceof OrthographicCamera && this.camera.isOrthographicCamera) {\n            var _this$unprojectOnTbPl4;\n\n            scalePoint = (_this$unprojectOnTbPl4 = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement)) === null || _this$unprojectOnTbPl4 === void 0 ? void 0 : _this$unprojectOnTbPl4.applyQuaternion(this.camera.quaternion).multiplyScalar(1 / this.camera.zoom).add(this._gizmos.position);\n          } else if (this.camera instanceof PerspectiveCamera && this.camera.isPerspectiveCamera) {\n            var _this$unprojectOnTbPl5;\n\n            scalePoint = (_this$unprojectOnTbPl5 = this.unprojectOnTbPlane(this.camera, _center.x, _center.y, this.domElement)) === null || _this$unprojectOnTbPl5 === void 0 ? void 0 : _this$unprojectOnTbPl5.applyQuaternion(this.camera.quaternion).add(this._gizmos.position);\n          }\n        }\n\n        if (scalePoint !== undefined) {\n          this.applyTransformMatrix(this.applyScale(amount, scalePoint));\n        }\n\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _defineProperty(this, \"onPinchEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.dispatchEvent(_endEvent);\n    });\n\n    _defineProperty(this, \"onTriplePanStart\", () => {\n      if (this.enabled && this.enableZoom) {\n        this.dispatchEvent(_startEvent);\n        this.updateTbState(STATE.SCALE, true); //const center = event.center;\n\n        let clientX = 0;\n        let clientY = 0;\n        const nFingers = this._touchCurrent.length;\n\n        for (let i = 0; i < nFingers; i++) {\n          clientX += this._touchCurrent[i].clientX;\n          clientY += this._touchCurrent[i].clientY;\n        }\n\n        this.setCenter(clientX / nFingers, clientY / nFingers);\n\n        this._startCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n\n        this._currentCursorPosition.copy(this._startCursorPosition);\n      }\n    });\n\n    _defineProperty(this, \"onTriplePanMove\", () => {\n      if (this.enabled && this.enableZoom && this.camera !== null) {\n        //\t  fov / 2\n        //\t\t|\\\n        //\t\t| \\\n        //\t\t|  \\\n        //\tx\t|\t\\\n        //\t\t| \t \\\n        //\t\t| \t  \\\n        //\t\t| _ _ _\\\n        //\t\t\ty\n        //const center = event.center;\n        let clientX = 0;\n        let clientY = 0;\n        const nFingers = this._touchCurrent.length;\n\n        for (let i = 0; i < nFingers; i++) {\n          clientX += this._touchCurrent[i].clientX;\n          clientY += this._touchCurrent[i].clientY;\n        }\n\n        this.setCenter(clientX / nFingers, clientY / nFingers);\n        const screenNotches = 8; //how many wheel notches corresponds to a full screen pan\n\n        this._currentCursorPosition.setY(this.getCursorNDC(_center.x, _center.y, this.domElement).y * 0.5);\n\n        const movement = this._currentCursorPosition.y - this._startCursorPosition.y;\n        let size = 1;\n\n        if (movement < 0) {\n          size = 1 / Math.pow(this.scaleFactor, -movement * screenNotches);\n        } else if (movement > 0) {\n          size = Math.pow(this.scaleFactor, movement * screenNotches);\n        }\n\n        this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n\n        const x = this._v3_1.distanceTo(this._gizmos.position);\n\n        let xNew = x / size; //distance between camera and gizmos if scale(size, scalepoint) would be performed\n        //check min and max distance\n\n        xNew = MathUtils.clamp(xNew, this.minDistance, this.maxDistance);\n        const y = x * Math.tan(MathUtils.DEG2RAD * this._fovState * 0.5); //calculate new fov\n\n        let newFov = MathUtils.RAD2DEG * (Math.atan(y / xNew) * 2); //check min and max fov\n\n        newFov = MathUtils.clamp(newFov, this.minFov, this.maxFov);\n        const newDistance = y / Math.tan(MathUtils.DEG2RAD * (newFov / 2));\n        size = x / newDistance;\n\n        this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);\n\n        this.setFov(newFov);\n        this.applyTransformMatrix(this.applyScale(size, this._v3_2, false)); //adjusting distance\n\n        const direction = this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(newDistance / x);\n\n        this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _defineProperty(this, \"onTriplePanEnd\", () => {\n      this.updateTbState(STATE.IDLE, false);\n      this.dispatchEvent(_endEvent); //this.dispatchEvent( _changeEvent );\n    });\n\n    _defineProperty(this, \"setCenter\", (clientX, clientY) => {\n      _center.x = clientX;\n      _center.y = clientY;\n    });\n\n    _defineProperty(this, \"initializeMouseActions\", () => {\n      this.setMouseAction('PAN', 0, 'CTRL');\n      this.setMouseAction('PAN', 2);\n      this.setMouseAction('ROTATE', 0);\n      this.setMouseAction('ZOOM', 'WHEEL');\n      this.setMouseAction('ZOOM', 1);\n      this.setMouseAction('FOV', 'WHEEL', 'SHIFT');\n      this.setMouseAction('FOV', 1, 'SHIFT');\n    });\n\n    _defineProperty(this, \"compareMouseAction\", (action1, action2) => {\n      if (action1.operation == action2.operation) {\n        if (action1.mouse == action2.mouse && action1.key == action2.key) {\n          return true;\n        } else {\n          return false;\n        }\n      } else {\n        return false;\n      }\n    });\n\n    _defineProperty(this, \"setMouseAction\", (operation, mouse, key = null) => {\n      const operationInput = ['PAN', 'ROTATE', 'ZOOM', 'FOV'];\n      const mouseInput = [0, 1, 2, 'WHEEL'];\n      const keyInput = ['CTRL', 'SHIFT', null];\n      let state;\n\n      if (!operationInput.includes(operation) || !mouseInput.includes(mouse) || !keyInput.includes(key)) {\n        //invalid parameters\n        return false;\n      }\n\n      if (mouse == 'WHEEL') {\n        if (operation != 'ZOOM' && operation != 'FOV') {\n          //cannot associate 2D operation to 1D input\n          return false;\n        }\n      }\n\n      switch (operation) {\n        case 'PAN':\n          state = STATE.PAN;\n          break;\n\n        case 'ROTATE':\n          state = STATE.ROTATE;\n          break;\n\n        case 'ZOOM':\n          state = STATE.SCALE;\n          break;\n\n        case 'FOV':\n          state = STATE.FOV;\n          break;\n      }\n\n      const action = {\n        operation: operation,\n        mouse: mouse,\n        key: key,\n        state: state\n      };\n\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        if (this.mouseActions[i].mouse == action.mouse && this.mouseActions[i].key == action.key) {\n          this.mouseActions.splice(i, 1, action);\n          return true;\n        }\n      }\n\n      this.mouseActions.push(action);\n      return true;\n    });\n\n    _defineProperty(this, \"unsetMouseAction\", (mouse, key = null) => {\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        if (this.mouseActions[i].mouse == mouse && this.mouseActions[i].key == key) {\n          this.mouseActions.splice(i, 1);\n          return true;\n        }\n      }\n\n      return false;\n    });\n\n    _defineProperty(this, \"getOpFromAction\", (mouse, key) => {\n      let action;\n\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        action = this.mouseActions[i];\n\n        if (action.mouse == mouse && action.key == key) {\n          return action.operation;\n        }\n      }\n\n      if (key != null) {\n        for (let i = 0; i < this.mouseActions.length; i++) {\n          action = this.mouseActions[i];\n\n          if (action.mouse == mouse && action.key == null) {\n            return action.operation;\n          }\n        }\n      }\n\n      return null;\n    });\n\n    _defineProperty(this, \"getOpStateFromAction\", (mouse, key) => {\n      let action;\n\n      for (let i = 0; i < this.mouseActions.length; i++) {\n        action = this.mouseActions[i];\n\n        if (action.mouse == mouse && action.key == key) {\n          return action.state;\n        }\n      }\n\n      if (key != null) {\n        for (let i = 0; i < this.mouseActions.length; i++) {\n          action = this.mouseActions[i];\n\n          if (action.mouse == mouse && action.key == null) {\n            return action.state;\n          }\n        }\n      }\n\n      return null;\n    });\n\n    _defineProperty(this, \"getAngle\", (p1, p2) => {\n      return Math.atan2(p2.clientY - p1.clientY, p2.clientX - p1.clientX) * 180 / Math.PI;\n    });\n\n    _defineProperty(this, \"updateTouchEvent\", event => {\n      for (let i = 0; i < this._touchCurrent.length; i++) {\n        if (this._touchCurrent[i].pointerId == event.pointerId) {\n          this._touchCurrent.splice(i, 1, event);\n\n          break;\n        }\n      }\n    });\n\n    _defineProperty(this, \"calculateAngularSpeed\", (p0, p1, t0, t1) => {\n      const s = p1 - p0;\n      const t = (t1 - t0) / 1000;\n\n      if (t == 0) {\n        return 0;\n      }\n\n      return s / t;\n    });\n\n    _defineProperty(this, \"calculatePointersDistance\", (p0, p1) => {\n      return Math.sqrt(Math.pow(p1.clientX - p0.clientX, 2) + Math.pow(p1.clientY - p0.clientY, 2));\n    });\n\n    _defineProperty(this, \"calculateRotationAxis\", (vec1, vec2) => {\n      this._rotationMatrix.extractRotation(this._cameraMatrixState);\n\n      this._quat.setFromRotationMatrix(this._rotationMatrix);\n\n      this._rotationAxis.crossVectors(vec1, vec2).applyQuaternion(this._quat);\n\n      return this._rotationAxis.normalize().clone();\n    });\n\n    _defineProperty(this, \"calculateTbRadius\", camera => {\n      const factor = 0.67;\n      const distance = camera.position.distanceTo(this._gizmos.position);\n\n      if (camera.type == 'PerspectiveCamera' && camera instanceof PerspectiveCamera) {\n        const halfFovV = MathUtils.DEG2RAD * camera.fov * 0.5; //vertical fov/2 in radians\n\n        const halfFovH = Math.atan(camera.aspect * Math.tan(halfFovV)); //horizontal fov/2 in radians\n\n        return Math.tan(Math.min(halfFovV, halfFovH)) * distance * factor;\n      } else if (camera.type == 'OrthographicCamera' && camera instanceof OrthographicCamera) {\n        return Math.min(camera.top, camera.right) * factor;\n      }\n    });\n\n    _defineProperty(this, \"focus\", (point, size, amount = 1) => {\n      if (this.camera !== null) {\n        const focusPoint = point.clone(); //move center of camera (along with gizmos) towards point of interest\n\n        focusPoint.sub(this._gizmos.position).multiplyScalar(amount);\n\n        this._translationMatrix.makeTranslation(focusPoint.x, focusPoint.y, focusPoint.z);\n\n        const gizmoStateTemp = this._gizmoMatrixState.clone();\n\n        this._gizmoMatrixState.premultiply(this._translationMatrix);\n\n        this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n\n        const cameraStateTemp = this._cameraMatrixState.clone();\n\n        this._cameraMatrixState.premultiply(this._translationMatrix);\n\n        this._cameraMatrixState.decompose(this.camera.position, this.camera.quaternion, this.camera.scale); //apply zoom\n\n\n        if (this.enableZoom) {\n          this.applyTransformMatrix(this.applyScale(size, this._gizmos.position));\n        }\n\n        this._gizmoMatrixState.copy(gizmoStateTemp);\n\n        this._cameraMatrixState.copy(cameraStateTemp);\n      }\n    });\n\n    _defineProperty(this, \"drawGrid\", () => {\n      if (this.scene != null) {\n        const color = 0x888888;\n        const multiplier = 3;\n        let size, divisions, maxLength, tick;\n\n        if (this.camera instanceof OrthographicCamera && this.camera.isOrthographicCamera) {\n          const width = this.camera.right - this.camera.left;\n          const height = this.camera.bottom - this.camera.top;\n          maxLength = Math.max(width, height);\n          tick = maxLength / 20;\n          size = maxLength / this.camera.zoom * multiplier;\n          divisions = size / tick * this.camera.zoom;\n        } else if (this.camera instanceof PerspectiveCamera && this.camera.isPerspectiveCamera) {\n          const distance = this.camera.position.distanceTo(this._gizmos.position);\n          const halfFovV = MathUtils.DEG2RAD * this.camera.fov * 0.5;\n          const halfFovH = Math.atan(this.camera.aspect * Math.tan(halfFovV));\n          maxLength = Math.tan(Math.max(halfFovV, halfFovH)) * distance * 2;\n          tick = maxLength / 20;\n          size = maxLength * multiplier;\n          divisions = size / tick;\n        }\n\n        if (this._grid == null && this.camera !== null) {\n          this._grid = new GridHelper(size, divisions, color, color);\n\n          this._grid.position.copy(this._gizmos.position);\n\n          this._gridPosition.copy(this._grid.position);\n\n          this._grid.quaternion.copy(this.camera.quaternion);\n\n          this._grid.rotateX(Math.PI * 0.5);\n\n          this.scene.add(this._grid);\n        }\n      }\n    });\n\n    _defineProperty(this, \"dispose\", () => {\n      var _this$scene;\n\n      if (this._animationId != -1) {\n        window.cancelAnimationFrame(this._animationId);\n      }\n\n      this.domElement.removeEventListener('pointerdown', this.onPointerDown);\n      this.domElement.removeEventListener('pointercancel', this.onPointerCancel);\n      this.domElement.removeEventListener('wheel', this.onWheel);\n      this.domElement.removeEventListener('contextmenu', this.onContextMenu);\n      window.removeEventListener('pointermove', this.onPointerMove);\n      window.removeEventListener('pointerup', this.onPointerUp);\n      window.removeEventListener('resize', this.onWindowResize);\n      window.addEventListener('keydown', this.onKeyDown);\n      (_this$scene = this.scene) === null || _this$scene === void 0 ? void 0 : _this$scene.remove(this._gizmos);\n      this.disposeGrid();\n    });\n\n    _defineProperty(this, \"disposeGrid\", () => {\n      if (this._grid != null && this.scene != null) {\n        this.scene.remove(this._grid);\n        this._grid = null;\n      }\n    });\n\n    _defineProperty(this, \"easeOutCubic\", t => {\n      return 1 - Math.pow(1 - t, 3);\n    });\n\n    _defineProperty(this, \"activateGizmos\", isActive => {\n      const gizmoX = this._gizmos.children[0];\n      const gizmoY = this._gizmos.children[1];\n      const gizmoZ = this._gizmos.children[2];\n\n      if (isActive) {\n        gizmoX.material.setValues({\n          opacity: 1\n        });\n        gizmoY.material.setValues({\n          opacity: 1\n        });\n        gizmoZ.material.setValues({\n          opacity: 1\n        });\n      } else {\n        gizmoX.material.setValues({\n          opacity: 0.6\n        });\n        gizmoY.material.setValues({\n          opacity: 0.6\n        });\n        gizmoZ.material.setValues({\n          opacity: 0.6\n        });\n      }\n    });\n\n    _defineProperty(this, \"getCursorNDC\", (cursorX, cursorY, canvas) => {\n      const canvasRect = canvas.getBoundingClientRect();\n\n      this._v2_1.setX((cursorX - canvasRect.left) / canvasRect.width * 2 - 1);\n\n      this._v2_1.setY((canvasRect.bottom - cursorY) / canvasRect.height * 2 - 1);\n\n      return this._v2_1.clone();\n    });\n\n    _defineProperty(this, \"getCursorPosition\", (cursorX, cursorY, canvas) => {\n      this._v2_1.copy(this.getCursorNDC(cursorX, cursorY, canvas));\n\n      if (this.camera instanceof OrthographicCamera) {\n        this._v2_1.x *= (this.camera.right - this.camera.left) * 0.5;\n        this._v2_1.y *= (this.camera.top - this.camera.bottom) * 0.5;\n      }\n\n      return this._v2_1.clone();\n    });\n\n    _defineProperty(this, \"setCamera\", camera => {\n      if (camera instanceof PerspectiveCamera || camera instanceof OrthographicCamera) {\n        camera.lookAt(this.target);\n        camera.updateMatrix(); //setting state\n\n        if ((camera === null || camera === void 0 ? void 0 : camera.type) == 'PerspectiveCamera' && camera instanceof PerspectiveCamera) {\n          this._fov0 = camera.fov;\n          this._fovState = camera.fov;\n        }\n\n        this._cameraMatrixState0.copy(camera.matrix);\n\n        this._cameraMatrixState.copy(this._cameraMatrixState0);\n\n        this._cameraProjectionState.copy(camera.projectionMatrix);\n\n        this._zoom0 = camera.zoom;\n        this._zoomState = this._zoom0;\n        this._initialNear = camera.near;\n        this._nearPos0 = camera.position.distanceTo(this.target) - camera.near;\n        this._nearPos = this._initialNear;\n        this._initialFar = camera.far;\n        this._farPos0 = camera.position.distanceTo(this.target) - camera.far;\n        this._farPos = this._initialFar;\n\n        this._up0.copy(camera.up);\n\n        this._upState.copy(camera.up);\n\n        this.camera = camera;\n\n        if (this.camera instanceof PerspectiveCamera || this.camera instanceof OrthographicCamera) {\n          this.camera.updateProjectionMatrix();\n        } //making gizmos\n\n\n        const tbRadius = this.calculateTbRadius(camera);\n\n        if (tbRadius !== undefined) {\n          this._tbRadius = tbRadius;\n        }\n\n        this.makeGizmos(this.target, this._tbRadius);\n      }\n    });\n\n    _defineProperty(this, \"makeGizmos\", (tbCenter, tbRadius) => {\n      // @ts-expect-error\n      const curve = new EllipseCurve(0, 0, tbRadius, tbRadius);\n      const points = curve.getPoints(this._curvePts); //geometry\n\n      const curveGeometry = new BufferGeometry().setFromPoints(points); //material\n\n      const curveMaterialX = new LineBasicMaterial({\n        color: 0xff8080,\n        fog: false,\n        transparent: true,\n        opacity: 0.6\n      });\n      const curveMaterialY = new LineBasicMaterial({\n        color: 0x80ff80,\n        fog: false,\n        transparent: true,\n        opacity: 0.6\n      });\n      const curveMaterialZ = new LineBasicMaterial({\n        color: 0x8080ff,\n        fog: false,\n        transparent: true,\n        opacity: 0.6\n      }); //line\n\n      const gizmoX = new Line(curveGeometry, curveMaterialX);\n      const gizmoY = new Line(curveGeometry, curveMaterialY);\n      const gizmoZ = new Line(curveGeometry, curveMaterialZ);\n      const rotation = Math.PI * 0.5;\n      gizmoX.rotation.x = rotation;\n      gizmoY.rotation.y = rotation; //setting state\n\n      this._gizmoMatrixState0.identity().setPosition(tbCenter);\n\n      this._gizmoMatrixState.copy(this._gizmoMatrixState0);\n\n      if ((this.camera instanceof PerspectiveCamera || this.camera instanceof OrthographicCamera) && this.camera.zoom != 1) {\n        //adapt gizmos size to camera zoom\n        const size = 1 / this.camera.zoom;\n\n        this._scaleMatrix.makeScale(size, size, size);\n\n        this._translationMatrix.makeTranslation(-tbCenter.x, -tbCenter.y, -tbCenter.z);\n\n        this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix);\n\n        this._translationMatrix.makeTranslation(tbCenter.x, tbCenter.y, tbCenter.z);\n\n        this._gizmoMatrixState.premultiply(this._translationMatrix);\n      }\n\n      this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n\n      this._gizmos.clear();\n\n      this._gizmos.add(gizmoX);\n\n      this._gizmos.add(gizmoY);\n\n      this._gizmos.add(gizmoZ);\n    });\n\n    _defineProperty(this, \"onFocusAnim\", (time, point, cameraMatrix, gizmoMatrix) => {\n      if (this._timeStart == -1) {\n        //animation start\n        this._timeStart = time;\n      }\n\n      if (this._state == STATE.ANIMATION_FOCUS) {\n        const deltaTime = time - this._timeStart;\n        const animTime = deltaTime / this.focusAnimationTime;\n\n        this._gizmoMatrixState.copy(gizmoMatrix);\n\n        if (animTime >= 1) {\n          //animation end\n          this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n\n          this.focus(point, this.scaleFactor);\n          this._timeStart = -1;\n          this.updateTbState(STATE.IDLE, false);\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        } else {\n          const amount = this.easeOutCubic(animTime);\n          const size = 1 - amount + this.scaleFactor * amount;\n\n          this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n\n          this.focus(point, size, amount);\n          this.dispatchEvent(_changeEvent);\n          const self = this;\n          this._animationId = window.requestAnimationFrame(function (t) {\n            self.onFocusAnim(t, point, cameraMatrix, gizmoMatrix.clone());\n          });\n        }\n      } else {\n        //interrupt animation\n        this._animationId = -1;\n        this._timeStart = -1;\n      }\n    });\n\n    _defineProperty(this, \"onRotationAnim\", (time, rotationAxis, w0) => {\n      if (this._timeStart == -1) {\n        //animation start\n        this._anglePrev = 0;\n        this._angleCurrent = 0;\n        this._timeStart = time;\n      }\n\n      if (this._state == STATE.ANIMATION_ROTATE) {\n        //w = w0 + alpha * t\n        const deltaTime = (time - this._timeStart) / 1000;\n        const w = w0 + -this.dampingFactor * deltaTime;\n\n        if (w > 0) {\n          //tetha = 0.5 * alpha * t^2 + w0 * t + tetha0\n          this._angleCurrent = 0.5 * -this.dampingFactor * Math.pow(deltaTime, 2) + w0 * deltaTime + 0;\n          this.applyTransformMatrix(this.rotate(rotationAxis, this._angleCurrent));\n          this.dispatchEvent(_changeEvent);\n          const self = this;\n          this._animationId = window.requestAnimationFrame(function (t) {\n            self.onRotationAnim(t, rotationAxis, w0);\n          });\n        } else {\n          this._animationId = -1;\n          this._timeStart = -1;\n          this.updateTbState(STATE.IDLE, false);\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        }\n      } else {\n        //interrupt animation\n        this._animationId = -1;\n        this._timeStart = -1;\n\n        if (this._state != STATE.ROTATE) {\n          this.activateGizmos(false);\n          this.dispatchEvent(_changeEvent);\n        }\n      }\n    });\n\n    _defineProperty(this, \"pan\", (p0, p1, adjust = false) => {\n      if (this.camera !== null) {\n        const movement = p0.clone().sub(p1);\n\n        if (this.camera instanceof OrthographicCamera && this.camera.isOrthographicCamera) {\n          //adjust movement amount\n          movement.multiplyScalar(1 / this.camera.zoom);\n        } else if (this.camera instanceof PerspectiveCamera && this.camera.isPerspectiveCamera && adjust) {\n          //adjust movement amount\n          this._v3_1.setFromMatrixPosition(this._cameraMatrixState0); //camera's initial position\n\n\n          this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0); //gizmo's initial position\n\n\n          const distanceFactor = this._v3_1.distanceTo(this._v3_2) / this.camera.position.distanceTo(this._gizmos.position);\n          movement.multiplyScalar(1 / distanceFactor);\n        }\n\n        this._v3_1.set(movement.x, movement.y, 0).applyQuaternion(this.camera.quaternion);\n\n        this._m4_1.makeTranslation(this._v3_1.x, this._v3_1.y, this._v3_1.z);\n\n        this.setTransformationMatrices(this._m4_1, this._m4_1);\n      }\n\n      return _transformation;\n    });\n\n    _defineProperty(this, \"reset\", () => {\n      if (this.camera instanceof PerspectiveCamera || this.camera instanceof OrthographicCamera) {\n        this.camera.zoom = this._zoom0;\n\n        if (this.camera instanceof PerspectiveCamera && this.camera.isPerspectiveCamera) {\n          this.camera.fov = this._fov0;\n        }\n\n        this.camera.near = this._nearPos;\n        this.camera.far = this._farPos;\n\n        this._cameraMatrixState.copy(this._cameraMatrixState0);\n\n        this._cameraMatrixState.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n\n        this.camera.up.copy(this._up0);\n        this.camera.updateMatrix();\n        this.camera.updateProjectionMatrix();\n\n        this._gizmoMatrixState.copy(this._gizmoMatrixState0);\n\n        this._gizmoMatrixState0.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n\n        this._gizmos.updateMatrix();\n\n        const tbRadius = this.calculateTbRadius(this.camera);\n\n        if (tbRadius !== undefined) {\n          this._tbRadius = tbRadius;\n        }\n\n        this.makeGizmos(this._gizmos.position, this._tbRadius);\n        this.camera.lookAt(this._gizmos.position);\n        this.updateTbState(STATE.IDLE, false);\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    _defineProperty(this, \"rotate\", (axis, angle) => {\n      const point = this._gizmos.position; //rotation center\n\n      this._translationMatrix.makeTranslation(-point.x, -point.y, -point.z);\n\n      this._rotationMatrix.makeRotationAxis(axis, -angle); //rotate camera\n\n\n      this._m4_1.makeTranslation(point.x, point.y, point.z);\n\n      this._m4_1.multiply(this._rotationMatrix);\n\n      this._m4_1.multiply(this._translationMatrix);\n\n      this.setTransformationMatrices(this._m4_1);\n      return _transformation;\n    });\n\n    _defineProperty(this, \"copyState\", () => {\n      let state;\n\n      if (this.camera instanceof OrthographicCamera && this.camera.isOrthographicCamera) {\n        state = JSON.stringify({\n          arcballState: {\n            cameraFar: this.camera.far,\n            cameraMatrix: this.camera.matrix,\n            cameraNear: this.camera.near,\n            cameraUp: this.camera.up,\n            cameraZoom: this.camera.zoom,\n            gizmoMatrix: this._gizmos.matrix\n          }\n        });\n      } else if (this.camera instanceof PerspectiveCamera && this.camera.isPerspectiveCamera) {\n        state = JSON.stringify({\n          arcballState: {\n            cameraFar: this.camera.far,\n            cameraFov: this.camera.fov,\n            cameraMatrix: this.camera.matrix,\n            cameraNear: this.camera.near,\n            cameraUp: this.camera.up,\n            cameraZoom: this.camera.zoom,\n            gizmoMatrix: this._gizmos.matrix\n          }\n        });\n      }\n\n      if (state !== undefined) {\n        navigator.clipboard.writeText(state);\n      }\n    });\n\n    _defineProperty(this, \"pasteState\", () => {\n      const self = this;\n      navigator.clipboard.readText().then(function resolved(value) {\n        self.setStateFromJSON(value);\n      });\n    });\n\n    _defineProperty(this, \"saveState\", () => {\n      if (this.camera instanceof PerspectiveCamera || this.camera instanceof OrthographicCamera) {\n        this._cameraMatrixState0.copy(this.camera.matrix);\n\n        this._gizmoMatrixState0.copy(this._gizmos.matrix);\n\n        this._nearPos = this.camera.near;\n        this._farPos = this.camera.far;\n        this._zoom0 = this.camera.zoom;\n\n        this._up0.copy(this.camera.up);\n\n        if (this.camera instanceof PerspectiveCamera && this.camera.isPerspectiveCamera) {\n          this._fov0 = this.camera.fov;\n        }\n      }\n    });\n\n    _defineProperty(this, \"applyScale\", (size, point, scaleGizmos = true) => {\n      const scalePoint = point.clone();\n      let sizeInverse = 1 / size;\n\n      if (this.camera instanceof OrthographicCamera && this.camera.isOrthographicCamera) {\n        //camera zoom\n        this.camera.zoom = this._zoomState;\n        this.camera.zoom *= size; //check min and max zoom\n\n        if (this.camera.zoom > this.maxZoom) {\n          this.camera.zoom = this.maxZoom;\n          sizeInverse = this._zoomState / this.maxZoom;\n        } else if (this.camera.zoom < this.minZoom) {\n          this.camera.zoom = this.minZoom;\n          sizeInverse = this._zoomState / this.minZoom;\n        }\n\n        this.camera.updateProjectionMatrix();\n\n        this._v3_1.setFromMatrixPosition(this._gizmoMatrixState); //gizmos position\n        //scale gizmos so they appear in the same spot having the same dimension\n\n\n        this._scaleMatrix.makeScale(sizeInverse, sizeInverse, sizeInverse);\n\n        this._translationMatrix.makeTranslation(-this._v3_1.x, -this._v3_1.y, -this._v3_1.z);\n\n        this._m4_2.makeTranslation(this._v3_1.x, this._v3_1.y, this._v3_1.z).multiply(this._scaleMatrix);\n\n        this._m4_2.multiply(this._translationMatrix); //move camera and gizmos to obtain pinch effect\n\n\n        scalePoint.sub(this._v3_1);\n        const amount = scalePoint.clone().multiplyScalar(sizeInverse);\n        scalePoint.sub(amount);\n\n        this._m4_1.makeTranslation(scalePoint.x, scalePoint.y, scalePoint.z);\n\n        this._m4_2.premultiply(this._m4_1);\n\n        this.setTransformationMatrices(this._m4_1, this._m4_2);\n        return _transformation;\n      } else if (this.camera instanceof PerspectiveCamera && this.camera.isPerspectiveCamera) {\n        this._v3_1.setFromMatrixPosition(this._cameraMatrixState);\n\n        this._v3_2.setFromMatrixPosition(this._gizmoMatrixState); //move camera\n\n\n        let distance = this._v3_1.distanceTo(scalePoint);\n\n        let amount = distance - distance * sizeInverse; //check min and max distance\n\n        const newDistance = distance - amount;\n\n        if (newDistance < this.minDistance) {\n          sizeInverse = this.minDistance / distance;\n          amount = distance - distance * sizeInverse;\n        } else if (newDistance > this.maxDistance) {\n          sizeInverse = this.maxDistance / distance;\n          amount = distance - distance * sizeInverse;\n        }\n\n        let direction = scalePoint.clone().sub(this._v3_1).normalize().multiplyScalar(amount);\n\n        this._m4_1.makeTranslation(direction.x, direction.y, direction.z);\n\n        if (scaleGizmos) {\n          //scale gizmos so they appear in the same spot having the same dimension\n          const pos = this._v3_2;\n          distance = pos.distanceTo(scalePoint);\n          amount = distance - distance * sizeInverse;\n          direction = scalePoint.clone().sub(this._v3_2).normalize().multiplyScalar(amount);\n\n          this._translationMatrix.makeTranslation(pos.x, pos.y, pos.z);\n\n          this._scaleMatrix.makeScale(sizeInverse, sizeInverse, sizeInverse);\n\n          this._m4_2.makeTranslation(direction.x, direction.y, direction.z).multiply(this._translationMatrix);\n\n          this._m4_2.multiply(this._scaleMatrix);\n\n          this._translationMatrix.makeTranslation(-pos.x, -pos.y, -pos.z);\n\n          this._m4_2.multiply(this._translationMatrix);\n\n          this.setTransformationMatrices(this._m4_1, this._m4_2);\n        } else {\n          this.setTransformationMatrices(this._m4_1);\n        }\n\n        return _transformation;\n      }\n    });\n\n    _defineProperty(this, \"setFov\", value => {\n      if (this.camera instanceof PerspectiveCamera && this.camera.isPerspectiveCamera) {\n        this.camera.fov = MathUtils.clamp(value, this.minFov, this.maxFov);\n        this.camera.updateProjectionMatrix();\n      }\n    });\n\n    _defineProperty(this, \"setTarget\", (x, y, z) => {\n      if (this.camera !== null) {\n        this.target.set(x, y, z);\n\n        this._gizmos.position.set(x, y, z); //for correct radius calculation\n\n\n        const tbRadius = this.calculateTbRadius(this.camera);\n\n        if (tbRadius !== undefined) {\n          this._tbRadius = tbRadius;\n        }\n\n        this.makeGizmos(this.target, this._tbRadius);\n        this.camera.lookAt(this.target);\n      }\n    });\n\n    _defineProperty(this, \"zRotate\", (point, angle) => {\n      this._rotationMatrix.makeRotationAxis(this._rotationAxis, angle);\n\n      this._translationMatrix.makeTranslation(-point.x, -point.y, -point.z);\n\n      this._m4_1.makeTranslation(point.x, point.y, point.z);\n\n      this._m4_1.multiply(this._rotationMatrix);\n\n      this._m4_1.multiply(this._translationMatrix);\n\n      this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(point); //vector from rotation center to gizmos position\n\n\n      this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis, angle); //apply rotation\n\n\n      this._v3_2.sub(this._v3_1);\n\n      this._m4_2.makeTranslation(this._v3_2.x, this._v3_2.y, this._v3_2.z);\n\n      this.setTransformationMatrices(this._m4_1, this._m4_2);\n      return _transformation;\n    });\n\n    _defineProperty(this, \"unprojectOnObj\", (cursor, camera) => {\n      if ((camera instanceof PerspectiveCamera || camera instanceof OrthographicCamera) && this.scene != null) {\n        const raycaster = new Raycaster();\n        raycaster.near = camera.near;\n        raycaster.far = camera.far;\n        raycaster.setFromCamera(cursor, camera);\n        const intersect = raycaster.intersectObjects(this.scene.children, true);\n\n        for (let i = 0; i < intersect.length; i++) {\n          if (intersect[i].object.uuid != this._gizmos.uuid && intersect[i].face != null) {\n            return intersect[i].point.clone();\n          }\n        }\n      }\n\n      return null;\n    });\n\n    _defineProperty(this, \"unprojectOnTbSurface\", (camera, cursorX, cursorY, canvas, tbRadius) => {\n      if (camera.type == 'OrthographicCamera') {\n        this._v2_1.copy(this.getCursorPosition(cursorX, cursorY, canvas));\n\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, 0);\n\n        const x2 = Math.pow(this._v2_1.x, 2);\n        const y2 = Math.pow(this._v2_1.y, 2);\n        const r2 = Math.pow(this._tbRadius, 2);\n\n        if (x2 + y2 <= r2 * 0.5) {\n          //intersection with sphere\n          this._v3_1.setZ(Math.sqrt(r2 - (x2 + y2)));\n        } else {\n          //intersection with hyperboloid\n          this._v3_1.setZ(r2 * 0.5 / Math.sqrt(x2 + y2));\n        }\n\n        return this._v3_1;\n      } else if (camera.type == 'PerspectiveCamera') {\n        //unproject cursor on the near plane\n        this._v2_1.copy(this.getCursorNDC(cursorX, cursorY, canvas));\n\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, -1);\n\n        this._v3_1.applyMatrix4(camera.projectionMatrixInverse);\n\n        const rayDir = this._v3_1.clone().normalize(); //unprojected ray direction\n\n\n        const cameraGizmoDistance = camera.position.distanceTo(this._gizmos.position);\n        const radius2 = Math.pow(tbRadius, 2); //\t  camera\n        //\t\t|\\\n        //\t\t| \\\n        //\t\t|  \\\n        //\th\t|\t\\\n        //\t\t| \t \\\n        //\t\t| \t  \\\n        //\t_ _ | _ _ _\\ _ _  near plane\n        //\t\t\tl\n\n        const h = this._v3_1.z;\n        const l = Math.sqrt(Math.pow(this._v3_1.x, 2) + Math.pow(this._v3_1.y, 2));\n\n        if (l == 0) {\n          //ray aligned with camera\n          rayDir.set(this._v3_1.x, this._v3_1.y, tbRadius);\n          return rayDir;\n        }\n\n        const m = h / l;\n        const q = cameraGizmoDistance;\n        /*\n         * calculate intersection point between unprojected ray and trackball surface\n         *|y = m * x + q\n         *|x^2 + y^2 = r^2\n         *\n         * (m^2 + 1) * x^2 + (2 * m * q) * x + q^2 - r^2 = 0\n         */\n\n        let a = Math.pow(m, 2) + 1;\n        let b = 2 * m * q;\n        let c = Math.pow(q, 2) - radius2;\n        let delta = Math.pow(b, 2) - 4 * a * c;\n\n        if (delta >= 0) {\n          //intersection with sphere\n          this._v2_1.setX((-b - Math.sqrt(delta)) / (2 * a));\n\n          this._v2_1.setY(m * this._v2_1.x + q);\n\n          const angle = MathUtils.RAD2DEG * this._v2_1.angle();\n\n          if (angle >= 45) {\n            //if angle between intersection point and X' axis is >= 45, return that point\n            //otherwise, calculate intersection point with hyperboloid\n            const rayLength = Math.sqrt(Math.pow(this._v2_1.x, 2) + Math.pow(cameraGizmoDistance - this._v2_1.y, 2));\n            rayDir.multiplyScalar(rayLength);\n            rayDir.z += cameraGizmoDistance;\n            return rayDir;\n          }\n        } //intersection with hyperboloid\n\n        /*\n         *|y = m * x + q\n         *|y = (1 / x) * (r^2 / 2)\n         *\n         * m * x^2 + q * x - r^2 / 2 = 0\n         */\n\n\n        a = m;\n        b = q;\n        c = -radius2 * 0.5;\n        delta = Math.pow(b, 2) - 4 * a * c;\n\n        this._v2_1.setX((-b - Math.sqrt(delta)) / (2 * a));\n\n        this._v2_1.setY(m * this._v2_1.x + q);\n\n        const rayLength = Math.sqrt(Math.pow(this._v2_1.x, 2) + Math.pow(cameraGizmoDistance - this._v2_1.y, 2));\n        rayDir.multiplyScalar(rayLength);\n        rayDir.z += cameraGizmoDistance;\n        return rayDir;\n      }\n    });\n\n    _defineProperty(this, \"unprojectOnTbPlane\", (camera, cursorX, cursorY, canvas, initialDistance = false) => {\n      if (camera.type == 'OrthographicCamera') {\n        this._v2_1.copy(this.getCursorPosition(cursorX, cursorY, canvas));\n\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, 0);\n\n        return this._v3_1.clone();\n      } else if (camera.type == 'PerspectiveCamera') {\n        this._v2_1.copy(this.getCursorNDC(cursorX, cursorY, canvas)); //unproject cursor on the near plane\n\n\n        this._v3_1.set(this._v2_1.x, this._v2_1.y, -1);\n\n        this._v3_1.applyMatrix4(camera.projectionMatrixInverse);\n\n        const rayDir = this._v3_1.clone().normalize(); //unprojected ray direction\n        //\t  camera\n        //\t\t|\\\n        //\t\t| \\\n        //\t\t|  \\\n        //\th\t|\t\\\n        //\t\t| \t \\\n        //\t\t| \t  \\\n        //\t_ _ | _ _ _\\ _ _  near plane\n        //\t\t\tl\n\n\n        const h = this._v3_1.z;\n        const l = Math.sqrt(Math.pow(this._v3_1.x, 2) + Math.pow(this._v3_1.y, 2));\n        let cameraGizmoDistance;\n\n        if (initialDistance) {\n          cameraGizmoDistance = this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0));\n        } else {\n          cameraGizmoDistance = camera.position.distanceTo(this._gizmos.position);\n        }\n        /*\n         * calculate intersection point between unprojected ray and the plane\n         *|y = mx + q\n         *|y = 0\n         *\n         * x = -q/m\n         */\n\n\n        if (l == 0) {\n          //ray aligned with camera\n          rayDir.set(0, 0, 0);\n          return rayDir;\n        }\n\n        const m = h / l;\n        const q = cameraGizmoDistance;\n        const x = -q / m;\n        const rayLength = Math.sqrt(Math.pow(q, 2) + Math.pow(x, 2));\n        rayDir.multiplyScalar(rayLength);\n        rayDir.z = 0;\n        return rayDir;\n      }\n    });\n\n    _defineProperty(this, \"updateMatrixState\", () => {\n      if (this.camera !== null) {\n        //update camera and gizmos state\n        this._cameraMatrixState.copy(this.camera.matrix);\n\n        this._gizmoMatrixState.copy(this._gizmos.matrix);\n\n        if (this.camera instanceof OrthographicCamera && this.camera.isOrthographicCamera) {\n          this._cameraProjectionState.copy(this.camera.projectionMatrix);\n\n          this.camera.updateProjectionMatrix();\n          this._zoomState = this.camera.zoom;\n        } else if (this.camera instanceof PerspectiveCamera && this.camera.isPerspectiveCamera) {\n          this._fovState = this.camera.fov;\n        }\n      }\n    });\n\n    _defineProperty(this, \"updateTbState\", (newState, updateMatrices) => {\n      this._state = newState;\n\n      if (updateMatrices) {\n        this.updateMatrixState();\n      }\n    });\n\n    _defineProperty(this, \"update\", () => {\n      var _this$camera2;\n\n      const EPS = 0.000001; // Update target and gizmos state\n\n      if (!this.target.equals(this._currentTarget) && this.camera !== null) {\n        this._gizmos.position.set(this.target.x, this.target.y, this.target.z); //for correct radius calculation\n\n\n        const tbRadius = this.calculateTbRadius(this.camera);\n\n        if (tbRadius !== undefined) {\n          this._tbRadius = tbRadius;\n        }\n\n        this.makeGizmos(this.target, this._tbRadius);\n\n        this._currentTarget.copy(this.target);\n      } //check min/max parameters\n\n\n      if (this.camera instanceof OrthographicCamera && this.camera.isOrthographicCamera) {\n        //check zoom\n        if (this.camera.zoom > this.maxZoom || this.camera.zoom < this.minZoom) {\n          const newZoom = MathUtils.clamp(this.camera.zoom, this.minZoom, this.maxZoom);\n          this.applyTransformMatrix(this.applyScale(newZoom / this.camera.zoom, this._gizmos.position, true));\n        }\n      } else if (this.camera instanceof PerspectiveCamera && this.camera.isPerspectiveCamera) {\n        //check distance\n        const distance = this.camera.position.distanceTo(this._gizmos.position);\n\n        if (distance > this.maxDistance + EPS || distance < this.minDistance - EPS) {\n          const newDistance = MathUtils.clamp(distance, this.minDistance, this.maxDistance);\n          this.applyTransformMatrix(this.applyScale(newDistance / distance, this._gizmos.position));\n          this.updateMatrixState();\n        } //check fov\n\n\n        if (this.camera.fov < this.minFov || this.camera.fov > this.maxFov) {\n          this.camera.fov = MathUtils.clamp(this.camera.fov, this.minFov, this.maxFov);\n          this.camera.updateProjectionMatrix();\n        }\n\n        const oldRadius = this._tbRadius;\n        const tbRadius = this.calculateTbRadius(this.camera);\n\n        if (tbRadius !== undefined) {\n          this._tbRadius = tbRadius;\n        }\n\n        if (oldRadius < this._tbRadius - EPS || oldRadius > this._tbRadius + EPS) {\n          const scale = (this._gizmos.scale.x + this._gizmos.scale.y + this._gizmos.scale.z) / 3;\n          const newRadius = this._tbRadius / scale; // @ts-expect-error\n\n          const curve = new EllipseCurve(0, 0, newRadius, newRadius);\n          const points = curve.getPoints(this._curvePts);\n          const curveGeometry = new BufferGeometry().setFromPoints(points);\n\n          for (const gizmo in this._gizmos.children) {\n            const child = this._gizmos.children[gizmo];\n\n            if (child instanceof Mesh) {\n              child.geometry = curveGeometry;\n            }\n          }\n        }\n      }\n\n      (_this$camera2 = this.camera) === null || _this$camera2 === void 0 ? void 0 : _this$camera2.lookAt(this._gizmos.position);\n    });\n\n    _defineProperty(this, \"setStateFromJSON\", json => {\n      const state = JSON.parse(json);\n\n      if (state.arcballState != undefined && (this.camera instanceof PerspectiveCamera || this.camera instanceof OrthographicCamera)) {\n        this._cameraMatrixState.fromArray(state.arcballState.cameraMatrix.elements);\n\n        this._cameraMatrixState.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n\n        this.camera.up.copy(state.arcballState.cameraUp);\n        this.camera.near = state.arcballState.cameraNear;\n        this.camera.far = state.arcballState.cameraFar;\n        this.camera.zoom = state.arcballState.cameraZoom;\n\n        if (this.camera instanceof PerspectiveCamera && this.camera.isPerspectiveCamera) {\n          this.camera.fov = state.arcballState.cameraFov;\n        }\n\n        this._gizmoMatrixState.fromArray(state.arcballState.gizmoMatrix.elements);\n\n        this._gizmoMatrixState.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n\n        this.camera.updateMatrix();\n        this.camera.updateProjectionMatrix();\n\n        this._gizmos.updateMatrix();\n\n        const tbRadius = this.calculateTbRadius(this.camera);\n\n        if (tbRadius !== undefined) {\n          this._tbRadius = tbRadius;\n        }\n\n        const gizmoTmp = new Matrix4().copy(this._gizmoMatrixState0);\n        this.makeGizmos(this._gizmos.position, this._tbRadius);\n\n        this._gizmoMatrixState0.copy(gizmoTmp);\n\n        this.camera.lookAt(this._gizmos.position);\n        this.updateTbState(STATE.IDLE, false);\n        this.dispatchEvent(_changeEvent);\n      }\n    });\n\n    this.camera = null;\n    this.domElement = domElement;\n    this.scene = scene;\n    this.mouseActions = [];\n    this._mouseOp = null; //global vectors and matrices that are used in some operations to avoid creating new objects every time (e.g. every time cursor moves)\n\n    this._v2_1 = new Vector2();\n    this._v3_1 = new Vector3();\n    this._v3_2 = new Vector3();\n    this._m4_1 = new Matrix4();\n    this._m4_2 = new Matrix4();\n    this._quat = new Quaternion(); //transformation matrices\n\n    this._translationMatrix = new Matrix4(); //matrix for translation operation\n\n    this._rotationMatrix = new Matrix4(); //matrix for rotation operation\n\n    this._scaleMatrix = new Matrix4(); //matrix for scaling operation\n\n    this._rotationAxis = new Vector3(); //axis for rotate operation\n    //camera state\n\n    this._cameraMatrixState = new Matrix4();\n    this._cameraProjectionState = new Matrix4();\n    this._fovState = 1;\n    this._upState = new Vector3();\n    this._zoomState = 1;\n    this._nearPos = 0;\n    this._farPos = 0;\n    this._gizmoMatrixState = new Matrix4(); //initial values\n\n    this._up0 = new Vector3();\n    this._zoom0 = 1;\n    this._fov0 = 0;\n    this._initialNear = 0;\n    this._nearPos0 = 0;\n    this._initialFar = 0;\n    this._farPos0 = 0;\n    this._cameraMatrixState0 = new Matrix4();\n    this._gizmoMatrixState0 = new Matrix4(); //pointers array\n\n    this._button = -1;\n    this._touchStart = [];\n    this._touchCurrent = [];\n    this._input = INPUT.NONE; //two fingers touch interaction\n\n    this._switchSensibility = 32; //minimum movement to be performed to fire single pan start after the second finger has been released\n\n    this._startFingerDistance = 0; //distance between two fingers\n\n    this._currentFingerDistance = 0;\n    this._startFingerRotation = 0; //amount of rotation performed with two fingers\n\n    this._currentFingerRotation = 0; //double tap\n\n    this._devPxRatio = 0;\n    this._downValid = true;\n    this._nclicks = 0;\n    this._downEvents = [];\n    this._downStart = 0; //pointerDown time\n\n    this._clickStart = 0; //first click time\n\n    this._maxDownTime = 250;\n    this._maxInterval = 300;\n    this._posThreshold = 24;\n    this._movementThreshold = 24; //cursor positions\n\n    this._currentCursorPosition = new Vector3();\n    this._startCursorPosition = new Vector3(); //grid\n\n    this._grid = null; //grid to be visualized during pan operation\n\n    this._gridPosition = new Vector3(); //gizmos\n\n    this._gizmos = new Group();\n    this._curvePts = 128; //animations\n\n    this._timeStart = -1; //initial time\n\n    this._animationId = -1; //focus animation\n\n    this.focusAnimationTime = 500; //duration of focus animation in ms\n    //rotate animation\n\n    this._timePrev = 0; //time at which previous rotate operation has been detected\n\n    this._timeCurrent = 0; //time at which current rotate operation has been detected\n\n    this._anglePrev = 0; //angle of previous rotation\n\n    this._angleCurrent = 0; //angle of current rotation\n\n    this._cursorPosPrev = new Vector3(); //cursor position when previous rotate operation has been detected\n\n    this._cursorPosCurr = new Vector3(); //cursor position when current rotate operation has been detected\n\n    this._wPrev = 0; //angular velocity of the previous rotate operation\n\n    this._wCurr = 0; //angular velocity of the current rotate operation\n    //parameters\n\n    this.adjustNearFar = false;\n    this.scaleFactor = 1.1; //zoom/distance multiplier\n\n    this.dampingFactor = 25;\n    this.wMax = 20; //maximum angular velocity allowed\n\n    this.enableAnimations = true; //if animations should be performed\n\n    this.enableGrid = false; //if grid should be showed during pan operation\n\n    this.cursorZoom = false; //if wheel zoom should be cursor centered\n\n    this.minFov = 5;\n    this.maxFov = 90;\n    this.enabled = true;\n    this.enablePan = true;\n    this.enableRotate = true;\n    this.enableZoom = true;\n    this.enableGizmos = true;\n    this.minDistance = 0;\n    this.maxDistance = Infinity;\n    this.minZoom = 0;\n    this.maxZoom = Infinity; //trackball parameters\n\n    this.target = new Vector3(0, 0, 0);\n    this._currentTarget = new Vector3(0, 0, 0);\n    this._tbRadius = 1; //FSA\n\n    this._state = STATE.IDLE;\n    this.setCamera(_camera);\n\n    if (this.scene != null) {\n      this.scene.add(this._gizmos);\n    }\n\n    this.domElement.style.touchAction = 'none';\n    this._devPxRatio = window.devicePixelRatio;\n    this.initializeMouseActions();\n    this.domElement.addEventListener('contextmenu', this.onContextMenu);\n    this.domElement.addEventListener('wheel', this.onWheel);\n    this.domElement.addEventListener('pointerdown', this.onPointerDown);\n    this.domElement.addEventListener('pointercancel', this.onPointerCancel);\n    window.addEventListener('keydown', this.onKeyDown);\n    window.addEventListener('resize', this.onWindowResize);\n  } //listeners\n\n\n  /**\n   * Apply a transformation matrix, to the camera and gizmos\n   * @param {Object} transformation Object containing matrices to apply to camera and gizmos\n   */\n  applyTransformMatrix(transformation) {\n    if ((transformation === null || transformation === void 0 ? void 0 : transformation.camera) != null && this.camera !== null) {\n      this._m4_1.copy(this._cameraMatrixState).premultiply(transformation.camera);\n\n      this._m4_1.decompose(this.camera.position, this.camera.quaternion, this.camera.scale);\n\n      this.camera.updateMatrix(); //update camera up vector\n\n      if (this._state == STATE.ROTATE || this._state == STATE.ZROTATE || this._state == STATE.ANIMATION_ROTATE) {\n        this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion);\n      }\n    }\n\n    if ((transformation === null || transformation === void 0 ? void 0 : transformation.gizmos) != null) {\n      this._m4_1.copy(this._gizmoMatrixState).premultiply(transformation.gizmos);\n\n      this._m4_1.decompose(this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale);\n\n      this._gizmos.updateMatrix();\n    }\n\n    if ((this._state == STATE.SCALE || this._state == STATE.FOCUS || this._state == STATE.ANIMATION_FOCUS) && (this.camera instanceof PerspectiveCamera || this.camera instanceof OrthographicCamera)) {\n      const tbRadius = this.calculateTbRadius(this.camera);\n\n      if (tbRadius !== undefined) {\n        this._tbRadius = tbRadius;\n      }\n\n      if (this.adjustNearFar) {\n        const cameraDistance = this.camera.position.distanceTo(this._gizmos.position);\n        const bb = new Box3();\n        bb.setFromObject(this._gizmos);\n        const sphere = new Sphere();\n        bb.getBoundingSphere(sphere);\n        const adjustedNearPosition = Math.max(this._nearPos0, sphere.radius + sphere.center.length());\n        const regularNearPosition = cameraDistance - this._initialNear;\n        const minNearPos = Math.min(adjustedNearPosition, regularNearPosition);\n        this.camera.near = cameraDistance - minNearPos;\n        const adjustedFarPosition = Math.min(this._farPos0, -sphere.radius + sphere.center.length());\n        const regularFarPosition = cameraDistance - this._initialFar;\n        const minFarPos = Math.min(adjustedFarPosition, regularFarPosition);\n        this.camera.far = cameraDistance - minFarPos;\n        this.camera.updateProjectionMatrix();\n      } else {\n        let update = false;\n\n        if (this.camera.near != this._initialNear) {\n          this.camera.near = this._initialNear;\n          update = true;\n        }\n\n        if (this.camera.far != this._initialFar) {\n          this.camera.far = this._initialFar;\n          update = true;\n        }\n\n        if (update) {\n          this.camera.updateProjectionMatrix();\n        }\n      }\n    }\n  }\n  /**\n   * Calculate the angular speed\n   * @param {Number} p0 Position at t0\n   * @param {Number} p1 Position at t1\n   * @param {Number} t0 Initial time in milliseconds\n   * @param {Number} t1 Ending time in milliseconds\n   */\n\n\n  /**\n   * Set gizmos visibility\n   * @param {Boolean} value Value of gizmos visibility\n   */\n  setGizmosVisible(value) {\n    this._gizmos.visible = value;\n    this.dispatchEvent(_changeEvent);\n  }\n  /**\n   * Creates the rotation gizmos matching trackball center and radius\n   * @param {Vector3} tbCenter The trackball center\n   * @param {number} tbRadius The trackball radius\n   */\n\n\n  /**\n   * Set values in transformation object\n   * @param {Matrix4} camera Transformation to be applied to the camera\n   * @param {Matrix4} gizmos Transformation to be applied to gizmos\n   */\n  setTransformationMatrices(camera = null, gizmos = null) {\n    if (camera != null) {\n      if (_transformation.camera != null) {\n        _transformation.camera.copy(camera);\n      } else {\n        _transformation.camera = camera.clone();\n      }\n    } else {\n      _transformation.camera = null;\n    }\n\n    if (gizmos != null) {\n      if (_transformation.gizmos != null) {\n        _transformation.gizmos.copy(gizmos);\n      } else {\n        _transformation.gizmos = gizmos.clone();\n      }\n    } else {\n      _transformation.gizmos = null;\n    }\n  }\n  /**\n   * Rotate camera around its direction axis passing by a given point by a given angle\n   * @param {Vector3} point The point where the rotation axis is passing trough\n   * @param {Number} angle Angle in radians\n   * @returns The computed transormation matix\n   */\n\n\n}\n\nexport { ArcballControls };\n"]},"metadata":{},"sourceType":"module"}